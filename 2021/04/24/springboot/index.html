<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>springboot零基础入门篇 | 太阳以西？</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
    <meta name="keywords" content="太阳以西？,Java,javaweb,Spring,SpringBoot" />
  
  <meta name="description" content="从入门使用到各个模块整合">
<meta property="og:type" content="article">
<meta property="og:title" content="springboot零基础入门篇">
<meta property="og:url" content="http://javacoderx.github.io/2021/04/24/springboot/index.html">
<meta property="og:site_name" content="太阳以西？">
<meta property="og:description" content="从入门使用到各个模块整合">
<meta property="og:locale">
<meta property="og:image" content="http://javacoderx.github.io/2021/04/24/springboot/image-20210306195529871.png">
<meta property="og:image" content="http://javacoderx.github.io/2021/04/24/springboot/image-20210306195830630.png">
<meta property="og:image" content="http://javacoderx.github.io/2021/04/24/springboot/image-20210306195815400.png">
<meta property="og:image" content="http://javacoderx.github.io/2021/04/24/springboot/image-20210306195855693.png">
<meta property="og:image" content="http://javacoderx.github.io/2021/04/24/springboot/image-20210306200300482.png">
<meta property="og:image" content="http://javacoderx.github.io/2021/04/24/springboot/image-20210306200632269.png">
<meta property="og:image" content="http://javacoderx.github.io/2021/04/24/springboot/image-20210306200644820.png">
<meta property="og:image" content="http://javacoderx.github.io/2021/04/24/springboot/image-20210323181759473.png">
<meta property="og:image" content="http://javacoderx.github.io/2021/04/24/springboot/image-20210323182229365.png">
<meta property="og:image" content="http://javacoderx.github.io/2021/04/24/springboot/image-20210323182832191.png">
<meta property="og:image" content="http://javacoderx.github.io/2021/04/24/springboot/image-20210323183150672.png">
<meta property="og:image" content="http://javacoderx.github.io/2021/04/24/springboot/image-20210323185034812.png">
<meta property="og:image" content="http://javacoderx.github.io/2021/04/24/springboot/image-20210323191116568.png">
<meta property="og:image" content="http://javacoderx.github.io/2021/04/24/springboot/image-20210323191926000.png">
<meta property="og:image" content="http://javacoderx.github.io/2021/04/24/springboot/image-20210323192146396.png">
<meta property="og:image" content="http://javacoderx.github.io/2021/04/24/springboot/image-20210323193912195.png">
<meta property="og:image" content="http://javacoderx.github.io/2021/04/24/springboot/image-20210323203027958.png">
<meta property="og:image" content="http://javacoderx.github.io/2021/04/24/springboot/image-20210323203610520.png">
<meta property="og:image" content="http://javacoderx.github.io/2021/04/24/springboot/image-20210323203651863.png">
<meta property="og:image" content="http://javacoderx.github.io/2021/04/24/springboot/image-20210323210046313.png">
<meta property="og:image" content="http://javacoderx.github.io/2021/04/24/springboot/image-20210323210102015.png">
<meta property="og:image" content="http://javacoderx.github.io/2021/04/24/springboot/image-20210323210134932.png">
<meta property="og:image" content="http://javacoderx.github.io/2021/04/24/springboot/image-20210323210143957.png">
<meta property="og:image" content="http://javacoderx.github.io/2021/04/24/springboot/image-20210323210207545.png">
<meta property="og:image" content="http://javacoderx.github.io/2021/04/24/springboot/image-20210324152234115.png">
<meta property="og:image" content="http://javacoderx.github.io/2021/04/24/springboot/image-20210324152635216.png">
<meta property="og:image" content="http://javacoderx.github.io/2021/04/24/springboot/image-20210324180046998.png">
<meta property="og:image" content="http://javacoderx.github.io/2021/04/24/springboot/image-20210324180921998.png">
<meta property="og:image" content="http://javacoderx.github.io/2021/04/24/springboot/image-20210324184930095.png">
<meta property="og:image" content="http://javacoderx.github.io/2021/04/24/springboot/image-20210324185014808.png">
<meta property="og:image" content="http://javacoderx.github.io/2021/04/24/springboot/image-20210324185041935.png">
<meta property="og:image" content="http://javacoderx.github.io/2021/04/24/springboot/image-20210324185135154.png">
<meta property="og:image" content="http://javacoderx.github.io/2021/04/24/springboot/image-20210324185224371.png">
<meta property="og:image" content="http://javacoderx.github.io/2021/04/24/springboot/image-20210324185406754.png">
<meta property="og:image" content="http://javacoderx.github.io/2021/04/24/springboot/image-20210324185423207.png">
<meta property="og:image" content="http://javacoderx.github.io/2021/04/24/springboot/image-20210324190705873.png">
<meta property="og:image" content="http://javacoderx.github.io/2021/04/24/springboot/image-20210324190853144.png">
<meta property="og:image" content="http://javacoderx.github.io/2021/04/24/AppData/Roaming/Typora/typora-user-images/image-20200504173857083.png">
<meta property="og:image" content="http://javacoderx.github.io/2021/04/24/springboot/image-20201027210425867.png">
<meta property="og:image" content="http://javacoderx.github.io/2021/04/24/springboot/image-20201027213019929.png">
<meta property="og:image" content="http://javacoderx.github.io/2021/04/24/springboot/image-20201027212925794.png">
<meta property="og:image" content="http://javacoderx.github.io/2021/04/24/springboot/image-20201027212956737.png">
<meta property="og:image" content="http://javacoderx.github.io/2021/04/24/springboot/image-20201020152225743.png">
<meta property="og:image" content="http://javacoderx.github.io/2021/04/24/springboot/image-20201020152351294.png">
<meta property="og:image" content="http://javacoderx.github.io/2021/04/24/springboot/image-20201020152559918.png">
<meta property="og:image" content="http://javacoderx.github.io/2021/04/24/springboot/image-20201028093309916.png">
<meta property="og:image" content="http://javacoderx.github.io/2021/04/24/springboot/image-20201028093459275.png">
<meta property="og:image" content="http://javacoderx.github.io/2021/04/24/springboot/image-20201028110803902.png">
<meta property="og:image" content="http://javacoderx.github.io/2021/04/24/springboot/image-20201028111302552.png">
<meta property="og:image" content="http://javacoderx.github.io/2021/04/24/springboot/image-20201028112836390.png">
<meta property="og:image" content="http://javacoderx.github.io/2021/04/24/springboot/image-20201028113132490.png">
<meta property="og:image" content="http://javacoderx.github.io/2021/04/24/springboot/image-20201028121801004.png">
<meta property="og:image" content="http://javacoderx.github.io/2021/04/24/springboot/image-20201028142620846.png">
<meta property="og:image" content="http://javacoderx.github.io/2021/04/24/springboot/image-20201102165956631.png">
<meta property="og:image" content="http://javacoderx.github.io/2021/04/24/springboot/image-20201102171507628.png">
<meta property="og:image" content="http://javacoderx.github.io/2021/04/24/springboot/image-20201102172730761.png">
<meta property="og:image" content="http://javacoderx.github.io/2021/04/24/springboot/image-20201102172758105.png">
<meta property="og:image" content="http://javacoderx.github.io/2021/04/24/springboot/image-20201102191049473.png">
<meta property="og:image" content="http://javacoderx.github.io/2021/04/24/springboot/image-20201102191302809.png">
<meta property="og:image" content="http://javacoderx.github.io/2021/04/24/springboot/image-20201102173519534.png">
<meta property="og:image" content="http://javacoderx.github.io/2021/04/24/springboot/image-20201102173716577.png">
<meta property="og:image" content="http://javacoderx.github.io/2021/04/24/springboot/image-20201102173809047.png">
<meta property="og:image" content="http://javacoderx.github.io/2021/04/24/springboot/image-20201102174231092.png">
<meta property="og:image" content="http://javacoderx.github.io/2021/04/24/springboot/image-20201102183752293.png">
<meta property="og:image" content="http://javacoderx.github.io/2021/04/24/springboot/image-20201102184737656.png">
<meta property="og:image" content="http://javacoderx.github.io/2021/04/24/springboot/image-20201102185221048.png">
<meta property="og:image" content="http://javacoderx.github.io/2021/04/24/springboot/image-20201102185958957.png">
<meta property="og:image" content="http://javacoderx.github.io/2021/04/24/springboot/image-20201102190143443.png">
<meta property="og:image" content="http://javacoderx.github.io/2021/04/24/springboot/image-20201102185724355.png">
<meta property="og:image" content="http://javacoderx.github.io/2021/04/24/springboot/image-20201102190612502.png">
<meta property="og:image" content="http://javacoderx.github.io/2021/04/24/springboot/image-20201102190649370.png">
<meta property="article:published_time" content="2021-04-23T16:53:11.000Z">
<meta property="article:modified_time" content="2021-04-23T09:13:12.484Z">
<meta property="article:author" content="xyc">
<meta property="article:tag" content="springboot">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://javacoderx.github.io/2021/04/24/springboot/image-20210306195529871.png">
  
  
    <link rel="icon" href="/favicon.ico">
  
  <link href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
  
<link rel="stylesheet" href="/css/style.css">

  
<script src="/js/pace.min.js"></script>

  

  
  

<meta name="generator" content="Hexo 5.4.0"></head>

<body>
  <div id="container">
      <header id="header">
    <div id="banner"></div>
    <div id="header-outer">
        <div id="header-menu" class="header-menu-pos animated">
            <div class="header-menu-container">
                <a href="/" class="left">
                    <span class="site-title">太阳以西？</span>
                </a>
                <nav id="header-menu-nav" class="right">
                    
                    <a  href="/">
                        <i class="fa fa-home"></i>
                        <span>Home</span>
                    </a>
                    
                    <a  href="/archives">
                        <i class="fa fa-archive"></i>
                        <span>Archives</span>
                    </a>
                    
                    <a  href="/about">
                        <i class="fa fa-user"></i>
                        <span>About</span>
                    </a>
                    
                </nav>
                <a class="mobile-header-menu-button">
                    <i class="fa fa-bars"></i>
                </a>
            </div>
        </div>
        <div id="header-row">
            <div id="logo">
                <a href="/">
                    <img src="/images/logo.png" alt="logo">
                </a>
            </div>
            <div class="header-info">
                <div id="header-title">
                    
                    <h2>
                        太阳以西？
                    </h2>
                    
                </div>
                <div id="header-description">
                    
                    <h3>
                        一个专注 WEB 开发的技术博客
                    </h3>
                    
                </div>
            </div>
            <nav class="header-nav">
                <div class="social">
                    
                        <a title="Home" target="_blank" href="//javacoderx.github.io">
                            <i class="fa fa-home fa-2x"></i></a>
                    
                        <a title="Github" target="_blank" href="//github.com/javacoderx">
                            <i class="fa fa-github fa-2x"></i></a>
                    
                        <a title="13072667463"  ">
                            <i class="fa fa-weixin fa-2x"></i></a>
                    
                        <a title="452662481"  ">
                            <i class="fa fa-qq fa-2x"></i></a>
                    
                </div>
            </nav>
        </div>
    </div>
</header>
      <div class="outer">
        <section id="main" class="body-wrap"><article id="post-springboot" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 class="post-title" itemprop="name">
      springboot零基础入门篇
    </h1>
    <div class="post-title-bar">
      <ul>
          
              <li>
                  <i class="fa fa-book"></i>
                  
                      <a href="/categories/springboot/">springboot</a>
                  
              </li>
          
        <li>
          <i class="fa fa-calendar"></i>  2021-04-23
        </li>
        <li>
          <i class="fa fa-eye"></i>
          <span id="busuanzi_value_page_pv"></span>
        </li>
      </ul>
    </div>
  

          
      </header>
    
    <div class="article-entry post-content" itemprop="articleBody">
      
            
            <h2 id="一、SpringBoot入门"><a href="#一、SpringBoot入门" class="headerlink" title="一、SpringBoot入门"></a>一、SpringBoot入门</h2><h3 id="1-1、springboot-简介"><a href="#1-1、springboot-简介" class="headerlink" title="1.1、springboot 简介"></a>1.1、springboot 简介</h3><blockquote>
<p><strong>springboot是什么？</strong></p>
</blockquote>
<p>简化Spring应用开发的框架，spring技术栈的整合，J2EE开发的一站式解决方案</p>
<p>优点：</p>
<ul>
<li>为所有spring开发者快速入门</li>
<li>开箱即用，提供各种默认配置来简化项目配置</li>
<li>内嵌式容器简化Web项目</li>
<li>没有冗余代码生成和XML配置的要求</li>
</ul>
<h3 id="1-2、微服务"><a href="#1-2、微服务" class="headerlink" title="1.2、微服务"></a>1.2、微服务</h3><ul>
<li>是一种架构风格（服务微化）</li>
<li>要求在开发一个应用的时候，这个应用必须构建成一系列小服务的组合；  可以通过http的方式进行互通</li>
<li>单体应用</li>
<li>每一个功能元素最终都是一个可独立替换和独立升级的软件单元；</li>
</ul>
<h3 id="1-3、快速开始"><a href="#1-3、快速开始" class="headerlink" title="1.3、快速开始"></a>1.3、快速开始</h3><ol>
<li>使用Spring Initializr创建一个springboot应用</li>
</ol>
<ol start="2">
<li><p>创建一个主程序类，启动SpringBoot应用</p>
</li>
<li><p>编写Helloworld的Controller （在主程序类的<strong>同级目录</strong>下创建一个controller包，在其中写Controller类）</p>
</li>
<li><p>运行主程序</p>
</li>
<li><p>简化部署</p>
</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;!‐‐ 这个插件，可以将应用打包成一个可执行的jar包；‐‐&gt;</span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring‐boot‐maven‐plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>将这个应用打成jar包，直接使用java -jar的命令进行执行；</p>
<p><strong>彩蛋</strong></p>
<p>到项目下的 resources 目录下新建一个banner.txt文件就可以，将启动时显示的字符更改为自己想要的</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"> /\/\/\                            /  \                   </span><br><span class="line">| \  / |                         /      \                 </span><br><span class="line">|  \/  |                       /          \               </span><br><span class="line">|  /\  |----------------------|     /\     |              </span><br><span class="line">| /  \ |                      |    /  \    |              </span><br><span class="line">|/    \|                      |   /    \   |              </span><br><span class="line">|\    /|                      |  | (  ) |  |              </span><br><span class="line">| \  / |                      |  | (  ) |  |              </span><br><span class="line">|  \/  |                 /\   |  |      |  |   /\         </span><br><span class="line">|  /\  |                /  \  |  |      |  |  /  \        </span><br><span class="line">| /  \ |               |----| |  |      |  | |----|       </span><br><span class="line">|/    \|---------------|    | | /|   .  |\ | |    |       </span><br><span class="line">|\    /|               |    | /  |   .  |  \ |    |       </span><br><span class="line">| \  / |               |    /    |   .  |    \    |       </span><br><span class="line">|  \/  |               |  /      |   .  |      \  |       </span><br><span class="line">|  /\  |---------------|/        |   .  |        \|       </span><br><span class="line">| /  \ |              /   NASA   |   .  |  NASA    \      </span><br><span class="line">|/    \|              (          |      |           )     </span><br><span class="line">|/\/\/\|               |    | |--|      |--| |    |       </span><br><span class="line">------------------------/  \-----/  \/  \-----/  \--------</span><br><span class="line">                        \\//     \\//\\//     \\//        </span><br><span class="line">                         \/       \/  \/       \/      </span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;</span><br><span class="line">&#x2F;&#x2F;                          _ooOoo_                               &#x2F;&#x2F;</span><br><span class="line">&#x2F;&#x2F;                         o8888888o                              &#x2F;&#x2F;</span><br><span class="line">&#x2F;&#x2F;                         88&quot; . &quot;88                              &#x2F;&#x2F;</span><br><span class="line">&#x2F;&#x2F;                         (| ^_^ |)                              &#x2F;&#x2F;</span><br><span class="line">&#x2F;&#x2F;                         O\  &#x3D;  &#x2F;O                              &#x2F;&#x2F;</span><br><span class="line">&#x2F;&#x2F;                      ____&#x2F;&#96;---&#39;\____                           &#x2F;&#x2F;</span><br><span class="line">&#x2F;&#x2F;                    .&#39;  \\|     |&#x2F;&#x2F;  &#96;.                         &#x2F;&#x2F;</span><br><span class="line">&#x2F;&#x2F;                   &#x2F;  \\|||  :  |||&#x2F;&#x2F;  \                        &#x2F;&#x2F;</span><br><span class="line">&#x2F;&#x2F;                  &#x2F;  _||||| -:- |||||-  \                       &#x2F;&#x2F;</span><br><span class="line">&#x2F;&#x2F;                  |   | \\\  -  &#x2F;&#x2F;&#x2F; |   |                       &#x2F;&#x2F;</span><br><span class="line">&#x2F;&#x2F;                  | \_|  &#39;&#39;\---&#x2F;&#39;&#39;  |   |                       &#x2F;&#x2F;</span><br><span class="line">&#x2F;&#x2F;                  \  .-\__  &#96;-&#96;  ___&#x2F;-. &#x2F;                       &#x2F;&#x2F;</span><br><span class="line">&#x2F;&#x2F;                ___&#96;. .&#39;  &#x2F;--.--\  &#96;. . ___                     &#x2F;&#x2F;</span><br><span class="line">&#x2F;&#x2F;              .&quot;&quot; &#39;&lt;  &#96;.___\_&lt;|&gt;_&#x2F;___.&#39;  &gt;&#39;&quot;&quot;.                  &#x2F;&#x2F;</span><br><span class="line">&#x2F;&#x2F;            | | :  &#96;- \&#96;.;&#96;\ _ &#x2F;&#96;;.&#96;&#x2F; - &#96; : | |                 &#x2F;&#x2F;</span><br><span class="line">&#x2F;&#x2F;            \  \ &#96;-.   \_ __\ &#x2F;__ _&#x2F;   .-&#96; &#x2F;  &#x2F;                 &#x2F;&#x2F;</span><br><span class="line">&#x2F;&#x2F;      &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#96;-.____&#96;-.___\_____&#x2F;___.-&#96;____.-&#39;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;         &#x2F;&#x2F;</span><br><span class="line">&#x2F;&#x2F;                           &#96;&#x3D;---&#x3D;&#39;                              &#x2F;&#x2F;</span><br><span class="line">&#x2F;&#x2F;      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^        &#x2F;&#x2F;</span><br><span class="line">&#x2F;&#x2F;             佛祖保佑       永不宕机      永无BUG                  &#x2F;&#x2F;</span><br><span class="line">&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;</span><br></pre></td></tr></table></figure>



<h2 id="二、自动装配原理"><a href="#二、自动装配原理" class="headerlink" title="二、自动装配原理"></a>二、自动装配原理</h2><h3 id="2-1、POM文件分析"><a href="#2-1、POM文件分析" class="headerlink" title="2.1、POM文件分析"></a>2.1、POM文件分析</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">     <span class="comment">&lt;!--parent部分 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.4.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">relativePath</span>/&gt;</span> </span><br><span class="line">        <span class="comment">&lt;!-- lookup parent from repository --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">      <span class="comment">&lt;!--项目元数据信息部分--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.xyc<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springboot-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>springboot-web<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span>Demo project for Spring Boot<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">&lt;!--dependencies部分 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-thymeleaf<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.junit.vintage<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit-vintage-engine<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">&lt;!--build部分 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>如上所示：POM文件分为四部分</p>
<ul>
<li><strong>项目元数据信息</strong> ：创建时候输入的Project Metadata部分，也就是Maven项目的基本元素，包括：groupId、artifactId、version、name、description等</li>
<li><strong>parent</strong>：继承<code>spring-boot-starter-parent</code>的依赖管理，控制版本与打包等内容</li>
<li><strong>dependencies</strong>：项目具体依赖，这里包含了<code>spring-boot-starter-web</code>用于实现HTTP接口（该依赖中包含了Spring MVC），官网对它的描述是：使用Spring MVC构建Web（包括RESTful）应用程序的入门者，使用Tomcat作为默认嵌入式容器。；<code>spring-boot-starter-test</code>用于编写单元测试的依赖包。更多功能模块的使用我们将在后面逐步展开。</li>
<li><strong>build</strong>：构建配置部分。默认使用了<code>spring-boot-maven-plugin</code>，配合<code>spring-boot-starter-parent</code>就可以把Spring Boot应用打包成JAR来直接运行。</li>
</ul>
<p>我们的程序要想运行主要依赖一个父项目</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.4.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">relativePath</span>/&gt;</span> </span><br><span class="line">    <span class="comment">&lt;!-- lookup parent from repository --&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>Ctrl+鼠标左键 进入父项目</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.4.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">relativePath</span>&gt;</span>../../spring-boot-dependencies<span class="tag">&lt;/<span class="name">relativePath</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"> </span><br></pre></td></tr></table></figure>

<p>在这里定义着Spring Boot的版本仲裁中心；</p>
<p>以后我们导入依赖默认是不需要写版本；（没有在dependencies里面管理的依赖自然需要声明版本号）</p>
<h3 id="2-2、启动器"><a href="#2-2、启动器" class="headerlink" title="2.2、启动器"></a>2.2、启动器</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring‐boot‐starter‐web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span>     </span><br></pre></td></tr></table></figure>

<p><strong>springboot-boot-starter</strong>：就是spring-boot的场景启动器</p>
<p>**spring-boot-starter-web **帮我们导入了web模块正常运行所依赖的组件；</p>
<p>Spring Boot将所有的功能场景都抽取出来，做成一个个的starters（启动器），只需要在项目里面引入这些starter相关场景的所有依赖都会导入进来。要用什么功能就导入什么场景的启动器</p>
<h3 id="2-3、主程序类"><a href="#2-3、主程序类" class="headerlink" title="2.3、主程序类"></a>2.3、主程序类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//@SpringBootApplication 来标注一个主程序类 ， 说明这是一个Spring Boot应用</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Springboot01HelloworldApplication</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">     <span class="comment">//将SpringBoot应用启动起来</span></span><br><span class="line">      SpringApplication.run(Springboot01HelloworldApplication.class, args);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>1.   @SpringBootApplication</strong> 注解：来标注一个主程序类 ， 说明这是一个Spring Boot应用,在该类的main方法启动springboot应用</p>
<p>进入这个注解 ：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target(&#123;ElementType.TYPE&#125;)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Inherited</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootConfiguration</span></span><br><span class="line"><span class="meta">@EnableAutoConfiguration</span></span><br><span class="line"><span class="meta">@ComponentScan(</span></span><br><span class="line"><span class="meta">    excludeFilters = &#123;@Filter(</span></span><br><span class="line"><span class="meta">    type = FilterType.CUSTOM,</span></span><br><span class="line"><span class="meta">    classes = &#123;TypeExcludeFilter.class&#125;</span></span><br><span class="line"><span class="meta">), @Filter(</span></span><br><span class="line"><span class="meta">    type = FilterType.CUSTOM,</span></span><br><span class="line"><span class="meta">    classes = &#123;AutoConfigurationExcludeFilter.class&#125;</span></span><br><span class="line"><span class="meta">)&#125;</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> SpringBootApplication &#123;</span><br></pre></td></tr></table></figure>

<p><strong>2.   @ComponentScan 注解</strong></p>
<pre><code>     这个注解在Spring中很重要 ， 它对应XML配置中的元素。                @ComponentScan的功能就是自动扫描并加载符合条件的组件或者bean ， 将这个bean定义加载到IOC容器中 ；
</code></pre>
<p><strong>3.   @SpringBootConfiguration 注解</strong>:</p>
<pre><code>       Spring Boot的配置类；标注在某个类上，表示这是一个Spring Boot的配置类；
</code></pre>
<p>进入这个注解 ：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target(&#123;ElementType.TYPE&#125;)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> SpringBootConfiguration &#123;</span><br></pre></td></tr></table></figure>

<p>@Configuration:配置类上来标注这个注解，说明这是一个配置类。</p>
<pre><code> 配置类 &lt;--&gt; 配置文件；
</code></pre>
<p>进入这个注解：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target(&#123;ElementType.TYPE&#125;)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Configuration &#123;</span><br></pre></td></tr></table></figure>

<p>@Component :配置类也是容器中的一个组件；说明启动类也是容器的一个组件</p>
<p><strong>4.   @EnableAutoConfiguration</strong>：</p>
<pre><code>    开启自动配置功能；
    以前我们需要配置的东西，Spring Boot帮我们自动配置；
</code></pre>
<p>进入这个注解：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target(&#123;ElementType.TYPE&#125;)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Inherited</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@AutoConfigurationPackage</span></span><br><span class="line"><span class="meta">@Import(&#123;AutoConfigurationImportSelector.class&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> EnableAutoConfiguration &#123;</span><br></pre></td></tr></table></figure>

<p>@import ：Spring底层注解 ， 给容器中导入一个组件</p>
<pre><code>  AutoConfigurationImportSelector.class： 自动配置导入选择器， 那么它会导入哪些组件的选择器呢？ 点击进入该类查看源码即可。
</code></pre>
<p>@AutoConfigurationPackage ： 自动配置包</p>
<p>进入这个注解：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target(&#123;ElementType.TYPE&#125;)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Inherited</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Import(&#123;Registrar.class&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> AutoConfigurationPackage &#123;</span><br></pre></td></tr></table></figure>

<p>@import ：Spring底层注解 ， 给容器中导入一个组件</p>
<p><strong>Registrar.class</strong>   <strong>将主配置类 【即@SpringBootApplication标注的类】的所在包及包下面所有子包里面的所有组件扫描到Spring容器 ；</strong></p>
<p>自动配置真正实现是从classpath中搜寻所有的<code>METINF/spring.factories</code>配置文件 ，并将其中对应的 org.springframework.boot.autoconfigure. 包下的配置项，通过反射实例化为对应标注了 @Configuration的JavaConfig形式的IOC容器配置类 ， 然后将这些都汇总成为一个实例并加载到IOC容器中。</p>
<p><strong>结论：</strong></p>
<ol>
<li>SpringBoot在启动的时候从类路径下的META-INF/spring.factories中获取EnableAutoConfiguration指定的值</li>
<li>将这些值作为自动配置类导入容器 ， 自动配置类就生效 ， 帮我们进行自动配置工作；</li>
<li>以前我们需要自己配置的东西 ， 自动配置类都帮我们解决了</li>
<li>整个J2EE的整体解决方案和自动配置都在springboot-autoconfigure的jar包中；</li>
<li><strong>它将所有需要导入的组件以全类名的方式返回 ， 这些组件就会被添加到容器中 ；</strong></li>
<li>它会给容器中导入非常多的自动配置类 （xxxAutoConfiguration）, 就是给容器中导入这个场景需要的所有组件 ， 并配置好这些组件 ；</li>
<li><strong>有了自动配置类 ， 免去了我们手动编写配置注入功能组件等的工作；</strong></li>
</ol>
<h3 id="2-4、Run"><a href="#2-4、Run" class="headerlink" title="2.4、Run"></a>2.4、Run</h3><p>开启一个服务</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringbootDemo02Application</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//该方法返回一个ConfigurableApplicationContext对象</span></span><br><span class="line">        <span class="comment">//参数一：应用入口的类     参数类：命令行参数</span></span><br><span class="line">                       SpringApplication.run(SpringbootDemo02Application.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>SpringApplication.run分析</strong></p>
<p>分析该方法主要分两部分，一部分是SpringApplication的实例化，二是run方法的执行；</p>
<h3 id="2-5、SpringApplication"><a href="#2-5、SpringApplication" class="headerlink" title="2.5、SpringApplication"></a>2.5、SpringApplication</h3><p>这个类主要做了以下四件事情</p>
<ol>
<li>推断应用的类型是普通的项目还是Web项目</li>
<li>查找并加载所有可用初始化器 ， 设置到initializers属性中</li>
<li>找出所有的应用程序监听器，设置到listeners属性中</li>
<li>推断并设置main方法的定义类，找到运行的主类</li>
</ol>
<h2 id="三、配置文件"><a href="#三、配置文件" class="headerlink" title="三、配置文件"></a>三、配置文件</h2><h3 id="3-1、配置文件"><a href="#3-1、配置文件" class="headerlink" title="3.1、配置文件"></a>3.1、配置文件</h3><p>SpringBoot使用一个全局的配置文件，配置文件名是固定的；</p>
<ul>
<li>application.properties</li>
<li>application.yml</li>
</ul>
<p>作用：修改SpringBoot自动配置的默认值；</p>
<pre><code>    （我们在配置文件中做的修改，SpringBoot在底层都给我们自动配置好）
</code></pre>
<h3 id="3-2、yaml"><a href="#3-2、yaml" class="headerlink" title="3.2、yaml"></a>3.2、yaml</h3><p>  是一种标记语言，不是一种标记语言。</p>
<p>  <strong>语法</strong>：key:(空格)value</p>
<pre><code> 以空格的缩进来控制层级关系；只要是左对齐的一列数据，都是同一个层级
</code></pre>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">8081</span></span><br></pre></td></tr></table></figure>

<p>  对象：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">friends:</span></span><br><span class="line">   <span class="attr">lastName:</span> <span class="string">zhangsan</span>        </span><br><span class="line">   <span class="attr">age:</span> <span class="number">20</span>    </span><br><span class="line"></span><br><span class="line"><span class="string">行内写法：</span>  </span><br><span class="line"><span class="attr">friends:</span> &#123;<span class="attr">lastName:</span> <span class="string">zhangsan</span>,<span class="attr">age:</span> <span class="number">18</span>&#125;</span><br></pre></td></tr></table></figure>

<p>  数组（List、Set）：</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">animals:</span></span><br><span class="line">   <span class="bullet">-</span> <span class="string">dog</span></span><br><span class="line">   <span class="bullet">-</span> <span class="string">cat</span></span><br><span class="line">   <span class="bullet">-</span> <span class="string">pid</span></span><br><span class="line"></span><br><span class="line"><span class="string">行内写法：</span></span><br><span class="line"><span class="attr">animals:</span> [<span class="string">cat</span>,<span class="string">dog</span>,<span class="string">pid</span>]</span><br></pre></td></tr></table></figure>



<h3 id="3-3、配置文件占位符"><a href="#3-3、配置文件占位符" class="headerlink" title="3.3、配置文件占位符"></a>3.3、配置文件占位符</h3><p>1、随机数</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$&#123;random.value&#125;、$&#123;random.<span class="keyword">int</span>&#125;、$&#123;random.<span class="keyword">long</span>&#125;</span><br><span class="line">$&#123;random.<span class="keyword">int</span>(<span class="number">10</span>)&#125;、$&#123;random.<span class="keyword">int</span>[<span class="number">1024</span>,<span class="number">65536</span>]&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>2、占位符获取之前配置的值，如果没有可以是用:指定默认值</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">person.last-name</span>=<span class="string">张三$&#123;random.uuid&#125;</span></span><br><span class="line"><span class="meta">person.age</span>=<span class="string">$&#123;random.int&#125;</span></span><br><span class="line"><span class="meta">person.birth</span>=<span class="string">2017/12/15</span></span><br><span class="line"><span class="meta">person.boss</span>=<span class="string">false</span></span><br><span class="line"><span class="meta">person.maps.k1</span>=<span class="string">v1</span></span><br><span class="line"><span class="meta">person.maps.k2</span>=<span class="string">14</span></span><br><span class="line"><span class="meta">person.lists</span>=<span class="string">a,b,c</span></span><br><span class="line"><span class="meta">person.dog.name</span>=<span class="string">$&#123;person.hello:hello&#125;_dog</span></span><br><span class="line"><span class="meta">person.dog.age</span>=<span class="string">15</span></span><br></pre></td></tr></table></figure>



<h3 id="3-4、配置文件值的注入"><a href="#3-4、配置文件值的注入" class="headerlink" title="3.4、配置文件值的注入"></a>3.4、配置文件值的注入</h3><p><code>@Value</code>和<code>@ConfigurationProperties</code></p>
<p>yaml：</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">person:</span></span><br><span class="line">    <span class="attr">lastName:</span> <span class="string">hello</span></span><br><span class="line">    <span class="attr">age:</span> <span class="number">18</span></span><br><span class="line">    <span class="attr">boss:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">birth:</span> <span class="number">2017</span><span class="string">/12/12</span></span><br><span class="line">    <span class="attr">maps:</span> &#123;<span class="attr">k1:</span> <span class="string">v1</span>,<span class="attr">k2:</span> <span class="number">12</span>&#125;</span><br><span class="line">    <span class="attr">lists:</span></span><br><span class="line">      <span class="string">‐</span> <span class="string">lisi</span></span><br><span class="line">      <span class="string">‐</span> <span class="string">zhaoliu</span></span><br><span class="line">    <span class="attr">dog:</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">小狗</span></span><br><span class="line">      <span class="attr">age:</span> <span class="number">12</span></span><br></pre></td></tr></table></figure>

<p>javaBean:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 将配置文件中配置的每一个属性的值，映射到这个组件中</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@ConfigurationProperties</span>：告诉SpringBoot将本类中的所有属性和配置文件中相关的配置进行绑定；</span></span><br><span class="line"><span class="comment"> *      prefix = &quot;person&quot;：配置文件中哪个下面的所有属性进行一一映射</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 只有这个组件是容器中的组件，才能使用容器提供</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@ConfigurationProperties</span>功能；</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;person&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String lastName;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="keyword">private</span> Boolean boss;</span><br><span class="line">    <span class="keyword">private</span> Date birth;</span><br><span class="line">    <span class="keyword">private</span> Map&lt;String,Object&gt; maps;</span><br><span class="line">    <span class="keyword">private</span> List&lt;Object&gt; lists;</span><br><span class="line">    <span class="keyword">private</span> Dog dog;</span><br></pre></td></tr></table></figure>

<p>配置文件处理器</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;!‐‐导入配置文件处理器，配置文件进行绑定就会有提示‐‐&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span>        </span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>            </span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring‐boot‐configuration‐ processor<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>            </span><br><span class="line">   <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span>            </span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span> </span><br></pre></td></tr></table></figure>



<p><strong>@Value获取值和@ConfigurationProperties获取值比较</strong></p>
<table>
<thead>
<tr>
<th></th>
<th>@ConfigurationProperties</th>
<th>@Value</th>
</tr>
</thead>
<tbody><tr>
<td>功能</td>
<td>批量注入配置文件中的属性</td>
<td>一个个指定</td>
</tr>
<tr>
<td>松散绑定（松散语法）</td>
<td>支持</td>
<td>不支持</td>
</tr>
<tr>
<td>SpEL</td>
<td>不支持</td>
<td>支持</td>
</tr>
<tr>
<td>JSR303数据校验</td>
<td>支持</td>
<td>不支持</td>
</tr>
<tr>
<td>复杂类型封装</td>
<td>支持</td>
<td>不支持</td>
</tr>
</tbody></table>
<p><strong>Profile</strong></p>
<p>  <strong>多Profile文件</strong></p>
<pre><code>    我们在主配置文件编写的时候，文件名可以是

     application-&#123;profile&#125;.properties/yml
    默认使用application.properties的配置；
</code></pre>
<p>  <strong>yml支持多文档块方式</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"> server:</span><br><span class="line">  port: 8081</span><br><span class="line">spring:</span><br><span class="line">  profiles:</span><br><span class="line">    active: prod</span><br><span class="line">‐‐‐</span><br><span class="line">server:</span><br><span class="line">  port: 8083</span><br><span class="line">spring:</span><br><span class="line">  profiles: dev</span><br><span class="line">‐‐‐</span><br><span class="line">server:</span><br><span class="line">  port: 8084</span><br><span class="line">spring:</span><br><span class="line">  profiles: prod  #指定属于哪个环境</span><br></pre></td></tr></table></figure>

<p>  <strong>激活指定profile</strong></p>
<pre><code> 1、在配置文件中指定 spring.profiles.active=dev
 2、命令行：
       java -jar spring-boot-02-config-0.0.1-SNAPSHOT.jar --spring.profiles.active=dev；
    可以直接在测试的时候，配置传入命令行参数
 3、虚拟机参数；
    -Dspring.profiles.active=dev
</code></pre>
<h3 id="3-5、配置文件的加载位置"><a href="#3-5、配置文件的加载位置" class="headerlink" title="3.5、配置文件的加载位置"></a>3.5、配置文件的加载位置</h3><p>  –file:./config/<br>  –file:./<br>  –classpath:/config/<br>  –classpath:/<br>  优先级由高到底，高优先级的配置会覆盖低优先级的配置</p>
<h3 id="3-6、加载指定配置文件"><a href="#3-6、加载指定配置文件" class="headerlink" title="3.6、加载指定配置文件"></a>3.6、加载指定配置文件</h3><p><code>@PropertySource</code>： 加载指定的配置文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@PropertySource(value &#x3D; &#123;&quot;classpath:person.properties&quot;&#125;)</span><br></pre></td></tr></table></figure>

<p><code>@ImportResource</code>：导入Spring的配置文件，让配置文件里面的内容生效；</p>
<pre><code>       标注在一个配置类上
</code></pre>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@ImportResource(locations &#x3D; &#123;&quot;classpath:beans.xml&quot;&#125;)</span><br></pre></td></tr></table></figure>



<p>SpringBoot推荐给容器中添加组件的方式；推荐使用全注解的方式<br>1、配置类@Configuration——&gt;Spring配置文件<br>2、使用@Bean给容器中添加组件</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Configuration</span>：指明当前类是一个配置类；就是来替代之前的Spring配置文件</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 在配置文件中用&lt;bean&gt;&lt;bean/&gt;标签添加组件</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyAppConfig</span> </span>&#123;</span><br><span class="line">    <span class="comment">//将方法的返回值添加到容器中；容器中这个组件默认的id就是方法名</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> HelloService <span class="title">helloService02</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;配置类@Bean给容器中添加组件了...&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> HelloService();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="四、日志"><a href="#四、日志" class="headerlink" title="四、日志"></a>四、日志</h2><h3 id="4-1、日志框架"><a href="#4-1、日志框架" class="headerlink" title="4.1、日志框架"></a>4.1、日志框架</h3><p><strong>市面上的日志框架；</strong></p>
<p>JUL、JCL、Jboss-logging、logback、log4j、log4j2、slf4j….</p>
<table>
<thead>
<tr>
<th>日志门面  （日志的抽象层）</th>
<th>日志实现</th>
</tr>
</thead>
<tbody><tr>
<td><del>JCL（Jakarta  Commons Logging）</del>    SLF4j（Simple  Logging Facade for Java）    <strong><del>jboss-logging</del></strong></td>
<td>Log4j  JUL（java.util.logging）  Log4j2  <strong>Logback</strong></td>
</tr>
</tbody></table>
<p>左边选一个门面（抽象层）、右边来选一个实现；</p>
<p>日志门面：  SLF4J；</p>
<p>日志实现：Logback；</p>
<p>SpringBoot：底层是Spring框架，Spring框架默认是用JCL；‘</p>
<p>  <strong>==SpringBoot选用 SLF4j和logback；==</strong></p>
<h3 id="4-2、SLF4j使用"><a href="#4-2、SLF4j使用" class="headerlink" title="4.2、SLF4j使用"></a>4.2、SLF4j使用</h3><p>如何在系统中使用SLF4j   <a target="_blank" rel="noopener" href="https://www.slf4j.org/">https://www.slf4j.org</a></p>
<p>日志记录方法的调用，不应该来直接调用日志的实现类，而是调用日志抽象层里面的方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloWorld</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    Logger logger = LoggerFactory.getLogger(HelloWorld.class);</span><br><span class="line">    logger.info(<span class="string">&quot;Hello World&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>图示：</p>
<p><img src="/2021/04/24/springboot/image-20210306195529871.png" alt="image-20210306195529871"></p>
<p>每一个日志的实现框架都有自己的配置文件。使用slf4j以后，<strong>配置文件还是做成日志实现框架自己本身的配置文件；</strong></p>
<p><strong>遗留问题</strong></p>
<p>a（slf4j+logback）: Spring（commons-logging）、Hibernate（jboss-logging）、MyBatis、xxxx</p>
<p>统一日志记录，即使是别的框架和我一起统一使用slf4j进行输出？</p>
<p><img src="/2021/04/24/springboot/image-20210306195830630.png" alt="image-20210306195830630"></p>
<p><strong>如何让系统中所有的日志都统一到slf4j；</strong></p>
<p>==1、将系统中其他日志框架先排除出去；==</p>
<p>==2、用中间包来替换原有的日志框架；==</p>
<p>==3、我们导入slf4j其他的实现==</p>
<h3 id="4-3、日志关系"><a href="#4-3、日志关系" class="headerlink" title="4.3、日志关系"></a>4.3、日志关系</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>SpringBoot使用它来做日志功能；</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-logging<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>底层依赖关系</p>
<p><img src="/2021/04/24/springboot/image-20210306195815400.png" alt="image-20210306195815400"></p>
<p>总结：</p>
<p>  1）、SpringBoot底层也是使用slf4j+logback的方式进行日志记录</p>
<p>  2）、SpringBoot也把其他的日志都替换成了slf4j；</p>
<p>  3）、中间替换包？</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SuppressWarnings(&quot;rawtypes&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">LogFactory</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> String UNSUPPORTED_OPERATION_IN_JCL_OVER_SLF4J = <span class="string">&quot;http://www.slf4j.org/codes.html#unsupported_operation_in_jcl_over_slf4j&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> LogFactory logFactory = <span class="keyword">new</span> SLF4JLogFactory();</span><br></pre></td></tr></table></figure>

<p><img src="/2021/04/24/springboot/image-20210306195855693.png" alt="image-20210306195855693"></p>
<p>  4）、如果我们要引入其他框架？一定要把这个框架的默认日志依赖移除掉？</p>
<pre><code>    Spring框架用的是commons-logging；
</code></pre>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-logging<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-logging<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>==SpringBoot能自动适配所有的日志，而且底层使用slf4j+logback的方式记录日志，引入其他框架的时候，只需要把这个框架依赖的日志框架排除掉即可；==</strong></p>
<h3 id="4-4、日志使用"><a href="#4-4、日志使用" class="headerlink" title="4.4、日志使用"></a>4.4、日志使用</h3><p><strong>默认设置</strong></p>
<p>可直接使用</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//记录器</span></span><br><span class="line">   Logger logger = LoggerFactory.getLogger(getClass());</span><br><span class="line">   <span class="meta">@Test</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">contextLoads</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="comment">//System.out.println();</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">//日志的级别；</span></span><br><span class="line">      <span class="comment">//由低到高   trace&lt;debug&lt;info&lt;warn&lt;error</span></span><br><span class="line">      <span class="comment">//可以调整输出的日志级别；日志就只会在这个级别以以后的高级别生效</span></span><br><span class="line">      logger.trace(<span class="string">&quot;这是trace日志...&quot;</span>);</span><br><span class="line">      logger.debug(<span class="string">&quot;这是debug日志...&quot;</span>);</span><br><span class="line">      <span class="comment">//SpringBoot默认给我们使用的是info级别的，没有指定级别的就用SpringBoot默认规定的级别；root级别</span></span><br><span class="line">      logger.info(<span class="string">&quot;这是info日志...&quot;</span>);</span><br><span class="line">      logger.warn(<span class="string">&quot;这是warn日志...&quot;</span>);</span><br><span class="line">      logger.error(<span class="string">&quot;这是error日志...&quot;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p>springboot修改日志的默认设置</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">logging.level.com.atguigu</span>=<span class="string">trace</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#logging.path=</span></span><br><span class="line"><span class="comment"># 不指定路径在当前项目下生成springboot.log日志</span></span><br><span class="line"><span class="comment"># 可以指定完整的路径；</span></span><br><span class="line"><span class="comment">#logging.file=G:/springboot.log</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 在当前磁盘的根路径下创建spring文件夹和里面的log文件夹；使用 spring.log 作为默认文件</span></span><br><span class="line"><span class="meta">logging.path</span>=<span class="string">/spring/log</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  在控制台输出的日志的格式</span></span><br><span class="line"><span class="meta">logging.pattern.console</span> =<span class="string">%d&#123;yyyy-MM-dd&#125; [%thread] %-5level %logger&#123;50&#125; - %msg%n</span></span><br><span class="line"><span class="comment"># 指定文件中日志输出的格式</span></span><br><span class="line"><span class="meta">logging.pattern.file</span> =<span class="string">%d&#123;yyyy-MM-dd&#125; === [%thread] === %-5level === %logger&#123;50&#125; ==== %msg%n</span></span><br></pre></td></tr></table></figure>



<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">日志输出格式：</span><br><span class="line">      %d表示日期时间，</span><br><span class="line">      %thread表示线程名，</span><br><span class="line">      %-5level：级别从左显示5个字符宽度</span><br><span class="line">      %logger&#123;50&#125; 表示logger名字最长50个字符，否则按照句点分割。 </span><br><span class="line">      %msg：日志消息，</span><br><span class="line">      %n是换行符</span><br><span class="line">    --&gt;</span><br><span class="line">    %d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; [%thread] %-5level %logger&#123;50&#125; - %msg%n</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>logging.file</th>
<th>logging.path</th>
<th>Example</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td>(none)</td>
<td>(none)</td>
<td></td>
<td>只在控制台输出</td>
</tr>
<tr>
<td>指定文件名</td>
<td>(none)</td>
<td>my.log</td>
<td>输出日志到my.log文件</td>
</tr>
<tr>
<td>(none)</td>
<td>指定目录</td>
<td>/var/log</td>
<td>输出到指定目录的 spring.log 文件中</td>
</tr>
</tbody></table>
<p><strong>指定配置</strong></p>
<p>给类路径下放上每个日志框架自己的配置文件即可；SpringBoot就不使用他默认配置的了</p>
<table>
<thead>
<tr>
<th>Logging System</th>
<th>Customization</th>
</tr>
</thead>
<tbody><tr>
<td>Logback</td>
<td><code>logback-spring.xml</code>, <code>logback-spring.groovy</code>, <code>logback.xml</code> or <code>logback.groovy</code></td>
</tr>
<tr>
<td>Log4j2</td>
<td><code>log4j2-spring.xml</code> or <code>log4j2.xml</code></td>
</tr>
<tr>
<td>JDK (Java Util Logging)</td>
<td><code>logging.properties</code></td>
</tr>
</tbody></table>
<p>logback.xml：直接就被日志框架识别了；</p>
<p><strong>logback-spring.xml</strong>：日志框架就不直接加载日志的配置项，由SpringBoot解析日志配置，可以使用SpringBoot的高级Profile功能</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">springProfile</span> <span class="attr">name</span>=<span class="string">&quot;staging&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- configuration to be enabled when the &quot;staging&quot; profile is active --&gt;</span></span><br><span class="line">   可以指定某段配置只在某个环境下生效</span><br><span class="line"><span class="tag">&lt;/<span class="name">springProfile</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>如：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">&quot;stdout&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.ConsoleAppender&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">        日志输出格式：</span></span><br><span class="line"><span class="comment">         %d表示日期时间，</span></span><br><span class="line"><span class="comment">         %thread表示线程名，</span></span><br><span class="line"><span class="comment">         %-5level：级别从左显示5个字符宽度</span></span><br><span class="line"><span class="comment">         %logger&#123;50&#125; 表示logger名字最长50个字符，否则按照句点分割。 </span></span><br><span class="line"><span class="comment">         %msg：日志消息，</span></span><br><span class="line"><span class="comment">         %n是换行符</span></span><br><span class="line"><span class="comment">        --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">layout</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.classic.PatternLayout&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">springProfile</span> <span class="attr">name</span>=<span class="string">&quot;dev&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; ----&gt; [%thread] ---&gt; %-5level %logger&#123;50&#125; - %msg%n<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">springProfile</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">springProfile</span> <span class="attr">name</span>=<span class="string">&quot;!dev&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; ==== [%thread] ==== %-5level %logger&#123;50&#125; - %msg%n<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">springProfile</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">layout</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>如果使用logback.xml作为日志配置文件，还要使用profile功能，会有以下错误</p>
<p><code>no applicable action for [springProfile]</code></p>
<h3 id="4-5、切换日志框架"><a href="#4-5、切换日志框架" class="headerlink" title="4.5、切换日志框架"></a>4.5、切换日志框架</h3><p>可以按照slf4j的日志适配图，进行相关的切换；</p>
<p>slf4j+log4j的方式；</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>logback-classic<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>ch.qos.logback<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j-over-slf4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-log4j12<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>





<p>切换为log4j2</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">   <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-logging<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-log4j2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h2 id="五、Web开发"><a href="#五、Web开发" class="headerlink" title="五、Web开发"></a>五、Web开发</h2><h3 id="5-1、静态资源映射"><a href="#5-1、静态资源映射" class="headerlink" title="5.1、静态资源映射"></a>5.1、静态资源映射</h3><ol>
<li><p>所有**/webjars/**** ，都去<code>classpath:/META-INF/resources/webjars/</code>找资源；</p>
<p>   webjars：以jar包的方式引入静态资源；</p>
</li>
<li><p>“/**” 访问当前项目的任何资源，都去（静态资源的文件夹）找映射</p>
</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&quot;classpath:&#x2F;META-INF&#x2F;resources&#x2F;&quot;, </span><br><span class="line">&quot;classpath:&#x2F;resources&#x2F;&quot;,</span><br><span class="line">&quot;classpath:&#x2F;static&#x2F;&quot;, </span><br><span class="line">&quot;classpath:&#x2F;public&#x2F;&quot; </span><br><span class="line">&quot;&#x2F;&quot;：当前项目的根路径</span><br></pre></td></tr></table></figure>

<p>  <code>localhost:8080/abc </code>===  去静态资源文件夹里面找abc</p>
<ol start="3">
<li>欢迎页； 静态资源文件夹下的所有index.html页面；被”/**”映射；</li>
</ol>
<p>  <code>localhost:8080/  </code> 找index页面</p>
<ol start="4">
<li>所有的 /favicon.ico 都是在静态资源文件下找；</li>
</ol>
<h3 id="5-2、模板引擎"><a href="#5-2、模板引擎" class="headerlink" title="5.2、模板引擎"></a>5.2、模板引擎</h3><p>JSP、Velocity、Freemarker、Thymeleaf</p>
<p>Springboot推荐Thymelea</p>
<h4 id="引入thymeleaf"><a href="#引入thymeleaf" class="headerlink" title="引入thymeleaf"></a>引入thymeleaf</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span>        </span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>            </span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring‐boot‐starter‐thymeleaf<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span>        </span><br><span class="line">&lt;!‐‐切换thymeleaf版本‐‐&gt; </span><br><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">thymeleaf.version</span>&gt;</span>3.0.9.RELEASE<span class="tag">&lt;/<span class="name">thymeleaf.version</span>&gt;</span>        </span><br><span class="line">&lt;!‐‐ 布局功能的支持程序  thymeleaf3主程序  layout2以上版本 ‐‐&gt;        </span><br><span class="line">&lt;!‐‐ thymeleaf2   layout1‐‐&gt;        </span><br><span class="line">   &lt;thymeleaf‐layout‐dialect.version&gt;2.2.2&lt;/thymeleaf‐layout‐dialect.version&gt;        </span><br><span class="line"> <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h4 id="thymeleaf使用"><a href="#thymeleaf使用" class="headerlink" title="thymeleaf使用"></a>thymeleaf使用</h4><p>只要我们把HTML页面放在classpath:/templates/下，thymeleaf就能自动渲染</p>
<p>1.导入thymeleaf的命名空间</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span> <span class="attr">xmlns:th</span>=<span class="string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>2.使用语法</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span> <span class="attr">xmlns:th</span>=<span class="string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF‐8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>成功！<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    &lt;!‐‐th:text 将div里面的文本内容设置为 ‐‐&gt;</span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;hello&#125;&quot;</span>&gt;</span>这是显示欢迎信息<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>禁用模板引擎的缓存</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 禁用缓存</span><br><span class="line">spring.thymeleaf.cache&#x3D;false </span><br></pre></td></tr></table></figure>





<h4 id="语法规则"><a href="#语法规则" class="headerlink" title="语法规则"></a>语法规则</h4><p>th:text；改变当前元素里面的文本内容；</p>
<p>th：任意html属性；来替换原生属性的值</p>
<p>表达式:</p>
<p>  ${…}：获取变量值</p>
<p>  #{…}：获取国际化内容</p>
<p>  *{…}：选择表达式  和${}在功能上是一样</p>
<p>  @{…}：定义URL</p>
<p>  ~{…}：片段引用表达式</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">Simple expressions:（表达式语法）</span><br><span class="line">    Variable Expressions: $&#123;...&#125;：获取变量值；OGNL；</span><br><span class="line">     </span><br><span class="line">     <span class="number">1</span>）、获取对象的属性、调用方法        </span><br><span class="line">     <span class="number">2</span>）、使用内置的基本对象：        </span><br><span class="line">     <span class="comment">#ctx : the context object.</span></span><br><span class="line">     <span class="comment">#vars: the context variables.            </span></span><br><span class="line">     <span class="comment">#locale : the context locale.</span></span><br><span class="line">     <span class="comment">#request : (only in Web Contexts) the HttpServletRequest object.</span></span><br><span class="line">     <span class="comment">#response : (only in Web Contexts) the HttpServletResponse object.</span></span><br><span class="line">     <span class="comment">#session : (only in Web Contexts) the HttpSession object.</span></span><br><span class="line">     <span class="comment">#servletContext : (only in Web Contexts) the ServletContext object.</span></span><br><span class="line">               </span><br><span class="line">                $&#123;session.foo&#125;</span><br><span class="line"></span><br><span class="line">   <span class="number">3</span>）、内置的一些工具对象：</span><br><span class="line">     <span class="comment">#execInfo : information about the template being processed.</span></span><br><span class="line"><span class="comment">#messages : methods for obtaining externalized messages inside variables expressions, in the</span></span><br><span class="line">same way <span class="keyword">as</span> they would be obtained using <span class="comment">#&#123;…&#125; syntax.</span></span><br><span class="line"><span class="comment">#uris : methods for escaping parts of URLs/URIs</span></span><br><span class="line"><span class="comment">#conversions : methods for executing the configured conversion service (if any).</span></span><br><span class="line"><span class="comment">#dates : methods for java.util.Date objects: formatting, component extraction, etc.</span></span><br><span class="line"><span class="comment">#calendars : analogous to #dates , but for java.util.Calendar objects.</span></span><br><span class="line"><span class="comment">#numbers : methods for formatting numeric objects.</span></span><br><span class="line"><span class="comment">#strings : methods for String objects: contains, startsWith, prepending/appending, etc.</span></span><br><span class="line"><span class="comment">#objects : methods for objects in general.</span></span><br><span class="line"><span class="comment">#bools : methods for boolean evaluation.</span></span><br><span class="line"><span class="comment">#arrays : methods for arrays.</span></span><br><span class="line"><span class="comment">#lists : methods for lists.</span></span><br><span class="line"><span class="comment">#sets : methods for sets.</span></span><br><span class="line"><span class="comment">#maps : methods for maps.</span></span><br><span class="line"><span class="comment">#aggregates : methods for creating aggregates on arrays or collections.</span></span><br><span class="line"><span class="comment">#ids : methods for dealing with id attributes that might be repeated (for example, as a</span></span><br><span class="line">result of an iteration).</span><br><span class="line">    Selection Variable Expressions: *&#123;...&#125;：选择表达式：和$&#123;&#125;在功能上是一样；</span><br><span class="line">     补充：配合 th:<span class="built_in">object</span>=<span class="string">&quot;$&#123;session.user&#125;：    </span></span><br><span class="line"><span class="string">   &lt;div th:object=&quot;</span>$&#123;session.user&#125;<span class="string">&quot;&gt;</span></span><br><span class="line"><span class="string">    &lt;p&gt;Name: &lt;span th:text=&quot;</span>*&#123;firstName&#125;<span class="string">&quot;&gt;Sebastian&lt;/span&gt;.&lt;/p&gt;</span></span><br><span class="line"><span class="string">    &lt;p&gt;Surname: &lt;span th:text=&quot;</span>*&#123;lastName&#125;<span class="string">&quot;&gt;Pepper&lt;/span&gt;.&lt;/p&gt;</span></span><br><span class="line"><span class="string">    &lt;p&gt;Nationality: &lt;span th:text=&quot;</span>*&#123;nationality&#125;<span class="string">&quot;&gt;Saturn&lt;/span&gt;.&lt;/p&gt;</span></span><br><span class="line"><span class="string">    &lt;/div&gt;</span></span><br><span class="line"><span class="string">   </span></span><br><span class="line"><span class="string">    Message Expressions: #&#123;...&#125;：获取国际化内容</span></span><br><span class="line"><span class="string">    Link URL Expressions: @&#123;...&#125;：定义URL；</span></span><br><span class="line"><span class="string">     @&#123;/order/process(execId=$&#123;execId&#125;,execType=&#x27;FAST&#x27;)&#125;        </span></span><br><span class="line"><span class="string">    Fragment Expressions: ~&#123;...&#125;：片段引用表达式</span></span><br><span class="line"><span class="string">     &lt;div th:insert=&quot;</span>~&#123;commons :: main&#125;<span class="string">&quot;&gt;...&lt;/div&gt;        </span></span><br><span class="line"><span class="string">           </span></span><br><span class="line"><span class="string">Literals（字面量）</span></span><br><span class="line"><span class="string">      Text literals: &#x27;one text&#x27; , &#x27;Another one!&#x27; ,…</span></span><br><span class="line"><span class="string">      Number literals: 0 , 34 , 3.0 , 12.3 ,…</span></span><br><span class="line"><span class="string">      Boolean literals: true , false</span></span><br><span class="line"><span class="string">      Null literal: null</span></span><br><span class="line"><span class="string">      Literal tokens: one , sometext , main ,…</span></span><br><span class="line"><span class="string">Text operations:（文本操作）</span></span><br><span class="line"><span class="string">    String concatenation: +</span></span><br><span class="line"><span class="string">    Literal substitutions: |The name is $&#123;name&#125;|</span></span><br><span class="line"><span class="string">Arithmetic operations:（数学运算）</span></span><br><span class="line"><span class="string">    Binary operators: + , ‐ , * , / , %</span></span><br><span class="line"><span class="string">        Minus sign (unary operator): ‐</span></span><br><span class="line"><span class="string">Boolean operations:（布尔运算）</span></span><br><span class="line"><span class="string">    Binary operators: and , or</span></span><br><span class="line"><span class="string">    Boolean negation (unary operator): ! , not</span></span><br><span class="line"><span class="string">Comparisons and equality:（比较运算）</span></span><br><span class="line"><span class="string">    Comparators: &gt; , &lt; , &gt;= , &lt;= ( gt , lt , ge , le )</span></span><br><span class="line"><span class="string">    Equality operators: == , != ( eq , ne )</span></span><br><span class="line"><span class="string">Conditional operators:条件运算（三元运算符）</span></span><br><span class="line"><span class="string">    If‐then: (if) ? (then)</span></span><br><span class="line"><span class="string">    If‐then‐else: (if) ? (then) : (else)</span></span><br><span class="line"><span class="string">    Default: (value) ?: (defaultvalue)</span></span><br><span class="line"><span class="string">Special tokens:</span></span><br><span class="line"><span class="string">    No‐Operation: _</span></span><br></pre></td></tr></table></figure>



<h3 id="5-3、SpringMVC-自动配置"><a href="#5-3、SpringMVC-自动配置" class="headerlink" title="5.3、SpringMVC 自动配置"></a>5.3、SpringMVC 自动配置</h3><h4 id="auto-configuration"><a href="#auto-configuration" class="headerlink" title="auto-configuration"></a>auto-configuration</h4><p>Spring Boot 自动配置好了SpringMVC<br>以下是SpringBoot对SpringMVC的默认配置:（<code>WebMvcAutoConfiguration</code>）</p>
<ul>
<li>Inclusion of <strong>ContentNegotiatingViewResolver</strong> and <strong>BeanNameViewResolver</strong> beans.<ul>
<li>自动配置了ViewResolver（视图解析器：根据方法的返回值得到视图对象（View），视图对象决定如何渲染（转发？重定向？）</li>
<li>ContentNegotiatingViewResolver：组合所有的视图解析器的；</li>
<li>如何定制：我们可以自己给容器中添加一个视图解析器；自动的将其组合进来；</li>
</ul>
</li>
<li>Support for serving static resources, including support for WebJars (see below).静态资源文件夹路径,webjars</li>
<li>Static <strong>index.html</strong> support. 静态首页访问</li>
<li>Custom Favicon support (see below). favicon.ico</li>
<li>自动注册了 of Converter , GenericConverter , Formatter beans.<ul>
<li>Converter：转换器； public String hello(User user)：类型转换使用Converter</li>
<li>Formatter 格式化器； 2017.12.17===Date；</li>
</ul>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span>        </span><br><span class="line"><span class="meta">@ConditionalOnProperty(prefix = &quot;spring.mvc&quot;, name = &quot;date‐format&quot;)</span></span><br><span class="line"><span class="comment">//在文件中配置日期格式化的规则</span></span><br><span class="line">       </span><br><span class="line"><span class="function"><span class="keyword">public</span> Formatter&lt;Date&gt; <span class="title">dateFormatter</span><span class="params">()</span> </span>&#123;        </span><br><span class="line">   </span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> DateFormatter(<span class="keyword">this</span>.mvcProperties.getDateFormat());</span><br><span class="line">    <span class="comment">//日期格式化组件            </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<pre><code> 自己添加的格式化器转换器，我们只需要放在容器中即可
</code></pre>
<ul>
<li>Support for HttpMessageConverters (see below).<ul>
<li>HttpMessageConverter：SpringMVC用来转换Http请求和响应的；User—Json；</li>
<li>HttpMessageConverters 是从容器中确定；获取所有的HttpMessageConverter<br>自己给容器中添加HttpMessageConverter，只需要将自己的组件注册容器中<br>（@Bean,@Component）</li>
</ul>
</li>
<li>Automatic registration of MessageCodesResolver (see below).定义错误代码生成规则</li>
<li>Automatic use of a ConfigurableWebBindingInitializer bean (see below).<br>我们可以配置一个ConfigurableWebBindingInitializer来替换默认的；（添加到容器）</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">初始化WebDataBinder；</span><br><span class="line">请求数据&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;JavaBean；</span><br></pre></td></tr></table></figure>

<p>org.springframework.boot.autoconfigure.web：web的所有自动场景；</p>
<h4 id="扩展SpringMVC"><a href="#扩展SpringMVC" class="headerlink" title="扩展SpringMVC"></a>扩展SpringMVC</h4><p>在config包下 编写一个配置类（@Configuration），实现WebMvcConfigurer接口</p>
<p><strong>注意</strong> ：不能标注@EnableWebMvc;标注后springmvc的自动配置就会失效，我们全面接管springmvc</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 2020/2/13 14:32</span></span><br><span class="line"><span class="comment"> * 文件说明：Mvc的自定义配置类</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 薛云冲</span></span><br><span class="line"><span class="comment"> * 梦可以到的地方，只要努力，总有一天，自己也可以达到！</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyMvcConfig</span> <span class="keyword">implements</span> <span class="title">WebMvcConfigurer</span> </span>&#123;</span><br><span class="line"><span class="comment">//    视图解析器</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addViewControllers</span><span class="params">(ViewControllerRegistry registry)</span> </span>&#123;</span><br><span class="line">        registry.addViewController(<span class="string">&quot;/index&quot;</span>).setViewName(<span class="string">&quot;index&quot;</span>);</span><br><span class="line">        registry.addViewController(<span class="string">&quot;/&quot;</span>).setViewName(<span class="string">&quot;index&quot;</span>);</span><br><span class="line">      registry.addViewController(<span class="string">&quot;/index.html&quot;</span>).setViewName(<span class="string">&quot;index&quot;</span>);     registry.addViewController(<span class="string">&quot;main.html&quot;</span>).setViewName(<span class="string">&quot;dashboard&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//自定义的国际化组件</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> LocaleResolver <span class="title">localeResolver</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> MyLocaleResolver();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> </span>&#123;</span><br><span class="line">        registry.addInterceptor(<span class="keyword">new</span> LoginHandlerInterceptor())</span><br><span class="line">                .addPathPatterns(<span class="string">&quot;/**&quot;</span>）.excludePathPatterns</span><br><span class="line">            (<span class="string">&quot;/index.html&quot;</span>,<span class="string">&quot;/&quot;</span>,<span class="string">&quot;/index&quot;</span>,<span class="string">&quot;/user/login&quot;</span>,<span class="string">&quot;/asserts/**&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">                                 </span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="5-4、修改springboot默认配置"><a href="#5-4、修改springboot默认配置" class="headerlink" title="5.4、修改springboot默认配置"></a>5.4、修改springboot默认配置</h3><p>1） SpringBoot在自动配置很多组件的时候，先看容器中有没有用户自己配置的（@Bean、@Component）如果有就用用户配置的，如果没有，才自动配置；如果有些组件可以有多个（ViewResolver）将用户配置的和自己默认的组合起来；<br>2） 在SpringBoot中会有非常多的xxxConfigurer帮助我们进行扩展配置<br>3） 在SpringBoot中会有很多的xxxCustomizer帮助我们进行定制配置</p>
<h3 id="5-5、CRUD操作"><a href="#5-5、CRUD操作" class="headerlink" title="5.5、CRUD操作"></a>5.5、CRUD操作</h3><p>后台Controller</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xyc.springbootweb.Controller;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 2020/2/14 21:37</span></span><br><span class="line"><span class="comment"> * 文件说明：</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 薛云冲</span></span><br><span class="line"><span class="comment"> * 梦可以到的地方，只要努力，总有一天，自己也可以达到！</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;EMP&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EmployeeController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> EmployeeService employeeService;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> DepartmentDao departmentDao;</span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/findAll&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">findAll</span><span class="params">(Model model)</span></span>&#123;</span><br><span class="line">        Collection&lt;Employee&gt; employees = employeeService.findAll();</span><br><span class="line"></span><br><span class="line">        model.addAttribute(<span class="string">&quot;emps&quot;</span>,employees);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;list&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//    跳转到添加员工的页面</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/add&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toAddEmployee</span><span class="params">( Model model)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        model.addAttribute(<span class="string">&quot;depts&quot;</span>,departmentDao.getDepartments());</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;addEmp&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/add&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span>  String <span class="title">addEmployee</span><span class="params">(Employee employee)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (employee!=<span class="keyword">null</span>)&#123;</span><br><span class="line">            employeeService.addEmp(employee);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;redirect:findAll&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@GetMapping(&quot;/toUpdate&quot;)</span></span><br><span class="line"><span class="comment">//    跳转到修改员工信息的页面</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toUpdateEmployee</span><span class="params">(String id,Model model)</span></span>&#123;</span><br><span class="line">        Employee employee = employeeService.findById(id);</span><br><span class="line"></span><br><span class="line">        model.addAttribute(<span class="string">&quot;depts&quot;</span>,departmentDao.getDepartments());</span><br><span class="line">        model.addAttribute(<span class="string">&quot;emp&quot;</span>,employee);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;updateEmp&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/update&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">updateEmployee</span><span class="params">(Employee employee)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        employeeService.updateEmployee(employee);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;redirect:findAll&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/delete&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">deleteEmployee</span><span class="params">(String id)</span></span>&#123;</span><br><span class="line">        employeeService.deleteEmployee(id);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;redirect:findAll&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>前端利用thymeleaf模板引擎进行数据回显，等等</p>
<h3 id="5-6、国际化"><a href="#5-6、国际化" class="headerlink" title="5.6、国际化"></a>5.6、国际化</h3><p>1.在resources文件夹下创建包 <strong>i18n</strong>，在i18n下编写国际化消息</p>
<p><img src="/2021/04/24/springboot/image-20210306200300482.png" alt="image-20210306200300482"></p>
<p>2.在配置文件中添加消息文件的真实位置</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#  我们自定义的消息的配置文件的真实位置</span></span><br><span class="line">  <span class="attr">messages:</span></span><br><span class="line">    <span class="attr">basename:</span> <span class="string">i18n.login</span></span><br></pre></td></tr></table></figure>

<p>3.根据请求切换国际化语言（只需在相关请求中加入相关参数）</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-sm&quot;</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/index.html(l=&#x27;zh_CN&#x27;)&#125;&quot;</span>&gt;</span>中文<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-sm&quot;</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/index.html(l=&#x27;en_US&#x27;)&#125;&quot;</span>&gt;</span>English<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>4.创建国际化配置类放入容器（一定要放入容器）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xyc.springbootweb.config;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 2020/2/14 1:52</span></span><br><span class="line"><span class="comment"> * 文件说明：</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 薛云冲</span></span><br><span class="line"><span class="comment"> * 梦可以到的地方，只要努力，总有一天，自己也可以达到！</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyLocaleResolver</span> <span class="keyword">implements</span> <span class="title">LocaleResolver</span> </span>&#123;</span><br><span class="line">    <span class="comment">//解析请求</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Locale <span class="title">resolveLocale</span><span class="params">(HttpServletRequest httpServletRequest)</span> </span>&#123;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//获取请求中的语言参数</span></span><br><span class="line">        String language = httpServletRequest.getParameter(<span class="string">&quot;l&quot;</span>);</span><br><span class="line">        Locale locale = Locale.getDefault();</span><br><span class="line">        <span class="comment">// 如果没有就是用默认值</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">//如果请求中的链接携带了国际化参数</span></span><br><span class="line">        <span class="keyword">if</span> (!StringUtils.isEmpty(language))&#123;</span><br><span class="line">            <span class="comment">//zh_CN</span></span><br><span class="line">            String[] split = language.split(<span class="string">&quot;_&quot;</span>);</span><br><span class="line">            <span class="comment">//国家地区</span></span><br><span class="line">            locale = <span class="keyword">new</span> Locale(split[<span class="number">0</span>], split[<span class="number">1</span>]);</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> locale;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setLocale</span><span class="params">(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, Locale locale)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>4.去页面获取国际化的值；</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#&#123;login.tip&#125;</span><br><span class="line">#&#123;login.username&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-7、拦截器"><a href="#5-7、拦截器" class="headerlink" title="5.7、拦截器"></a>5.7、拦截器</h3><p>自定义拦截器</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 2020/2/14 18:43</span></span><br><span class="line"><span class="comment"> * 文件说明：</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 薛云冲</span></span><br><span class="line"><span class="comment"> * 梦可以到的地方，只要努力，总有一天，自己也可以达到！</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginHandlerInterceptor</span> <span class="keyword">implements</span> <span class="title">HandlerInterceptor</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 登录成功之后，应该有用户的session</span></span><br><span class="line">        Object username = request.getSession().getAttribute(<span class="string">&quot;username&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(username==<span class="keyword">null</span>)&#123;</span><br><span class="line"></span><br><span class="line">            request.setAttribute(<span class="string">&quot;msg&quot;</span>,<span class="string">&quot;未登录，请先登录!&quot;</span>);</span><br><span class="line">            request.getRequestDispatcher(<span class="string">&quot;/index.html&quot;</span>).forward(request,response);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>在自定义MvcConfig类中的<strong>注册拦截器</strong>（必须）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> </span>&#123;</span><br><span class="line">     registry.addInterceptor(<span class="keyword">new</span> LoginHandlerInterceptor())</span><br><span class="line">             .addPathPatterns(<span class="string">&quot;/**&quot;</span>).excludePathPatterns</span><br><span class="line">        (<span class="string">&quot;/index.html&quot;</span>,<span class="string">&quot;/&quot;</span>,<span class="string">&quot;/index&quot;</span>,<span class="string">&quot;/user/login&quot;</span>,<span class="string">&quot;/asserts/**&quot;</span>);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>



<h3 id="5-8、错误处理机制"><a href="#5-8、错误处理机制" class="headerlink" title="5.8、错误处理机制"></a>5.8、错误处理机制</h3><h4 id="5-8-1、默认的错误处理机制"><a href="#5-8-1、默认的错误处理机制" class="headerlink" title="5.8.1、默认的错误处理机制"></a>5.8.1、默认的错误处理机制</h4><h5 id="默认效果："><a href="#默认效果：" class="headerlink" title="默认效果："></a>默认效果：</h5><p>  1）、浏览器，返回一个默认的错误页面</p>
<p><img src="/2021/04/24/springboot/image-20210306200632269.png" alt="image-20210306200632269"></p>
<p><img src="/2021/04/24/springboot/image-20210306200644820.png" alt="image-20210306200644820"></p>
<h5 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h5><p>  可以参照ErrorMvcAutoConfiguration；错误处理的自动配置；</p>
<p>   给容器中添加了以下组件</p>
<p>  1、DefaultErrorAttributes：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">帮我们在页面共享信息；</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title">getErrorAttributes</span><span class="params">(RequestAttributes requestAttributes,</span></span></span><br><span class="line"><span class="function"><span class="params">         <span class="keyword">boolean</span> includeStackTrace)</span> </span>&#123;</span><br><span class="line">      Map&lt;String, Object&gt; errorAttributes = <span class="keyword">new</span> LinkedHashMap&lt;String, Object&gt;();</span><br><span class="line">      errorAttributes.put(<span class="string">&quot;timestamp&quot;</span>, <span class="keyword">new</span> Date());</span><br><span class="line">      addStatus(errorAttributes, requestAttributes);</span><br><span class="line">      addErrorDetails(errorAttributes, requestAttributes, includeStackTrace);</span><br><span class="line">      addPath(errorAttributes, requestAttributes);</span><br><span class="line">      <span class="keyword">return</span> errorAttributes;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>



<p>  2、BasicErrorController：处理默认/error请求</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;$&#123;server.error.path:$&#123;error.path:/error&#125;&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BasicErrorController</span> <span class="keyword">extends</span> <span class="title">AbstractErrorController</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@RequestMapping(produces = &quot;text/html&quot;)</span><span class="comment">//产生html类型的数据；浏览器发送的请求来到这个方法处理</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> ModelAndView <span class="title">errorHtml</span><span class="params">(HttpServletRequest request,</span></span></span><br><span class="line"><span class="function"><span class="params">         HttpServletResponse response)</span> </span>&#123;</span><br><span class="line">      HttpStatus status = getStatus(request);</span><br><span class="line">      Map&lt;String, Object&gt; model = Collections.unmodifiableMap(getErrorAttributes(</span><br><span class="line">            request, isIncludeStackTrace(request, MediaType.TEXT_HTML)));</span><br><span class="line">      response.setStatus(status.value());</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//去哪个页面作为错误页面；包含页面地址和页面内容</span></span><br><span class="line">      ModelAndView modelAndView = resolveErrorView(request, response, status, model);</span><br><span class="line">      <span class="keyword">return</span> (modelAndView == <span class="keyword">null</span> ? <span class="keyword">new</span> ModelAndView(<span class="string">&quot;error&quot;</span>, model) : modelAndView);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@RequestMapping</span></span><br><span class="line">   <span class="meta">@ResponseBody</span>    <span class="comment">//产生json数据，其他客户端来到这个方法处理；</span></span><br><span class="line">   <span class="keyword">public</span> ResponseEntity&lt;Map&lt;String, Object&gt;&gt; error(HttpServletRequest request) &#123;</span><br><span class="line">      Map&lt;String, Object&gt; body = getErrorAttributes(request,</span><br><span class="line">            isIncludeStackTrace(request, MediaType.ALL));</span><br><span class="line">      HttpStatus status = getStatus(request);</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> ResponseEntity&lt;Map&lt;String, Object&gt;&gt;(body, status);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>



<p>  3、ErrorPageCustomizer：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Value(&quot;$&#123;error.path:/error&#125;&quot;)</span></span><br><span class="line"><span class="keyword">private</span> String path = <span class="string">&quot;/error&quot;</span>;  系统出现错误以后来到error请求进行处理；（web.xml注册的错误页面规则）</span><br></pre></td></tr></table></figure>



<p>  4、DefaultErrorViewResolver：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> ModelAndView <span class="title">resolveErrorView</span><span class="params">(HttpServletRequest request, HttpStatus status,</span></span></span><br><span class="line"><span class="function"><span class="params">         Map&lt;String, Object&gt; model)</span> </span>&#123;</span><br><span class="line">      ModelAndView modelAndView = resolve(String.valueOf(status), model);</span><br><span class="line">      <span class="keyword">if</span> (modelAndView == <span class="keyword">null</span> &amp;&amp; SERIES_VIEWS.containsKey(status.series())) &#123;</span><br><span class="line">         modelAndView = resolve(SERIES_VIEWS.get(status.series()), model);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> modelAndView;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">private</span> ModelAndView <span class="title">resolve</span><span class="params">(String viewName, Map&lt;String, Object&gt; model)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//默认SpringBoot可以去找到一个页面？  error/404</span></span><br><span class="line">      String errorViewName = <span class="string">&quot;error/&quot;</span> + viewName;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//模板引擎可以解析这个页面地址就用模板引擎解析</span></span><br><span class="line">      TemplateAvailabilityProvider provider = <span class="keyword">this</span>.templateAvailabilityProviders</span><br><span class="line">            .getProvider(errorViewName, <span class="keyword">this</span>.applicationContext);</span><br><span class="line">      <span class="keyword">if</span> (provider != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="comment">//模板引擎可用的情况下返回到errorViewName指定的视图地址</span></span><br><span class="line">         <span class="keyword">return</span> <span class="keyword">new</span> ModelAndView(errorViewName, model);</span><br><span class="line">      &#125;</span><br><span class="line">        <span class="comment">//模板引擎不可用，就在静态资源文件夹下找errorViewName对应的页面   error/404.html</span></span><br><span class="line">      <span class="keyword">return</span> resolveResource(errorViewName, model);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>



<h5 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h5><pre><code> 一但系统出现4xx或者5xx之类的错误；ErrorPageCustomizer就会生效（定制错误的响应规则）；就会来到/error请求；就会被**BasicErrorController**处理；

 1）响应页面；去哪个页面是由**DefaultErrorViewResolver**解析得到的；
</code></pre>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> ModelAndView <span class="title">resolveErrorView</span><span class="params">(HttpServletRequest request,</span></span></span><br><span class="line"><span class="function"><span class="params">      HttpServletResponse response, HttpStatus status, Map&lt;String, Object&gt; model)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//所有的ErrorViewResolver得到ModelAndView</span></span><br><span class="line">   <span class="keyword">for</span> (ErrorViewResolver resolver : <span class="keyword">this</span>.errorViewResolvers) &#123;</span><br><span class="line">      ModelAndView modelAndView = resolver.resolveErrorView(request, status, model);</span><br><span class="line">      <span class="keyword">if</span> (modelAndView != <span class="keyword">null</span>) &#123;</span><br><span class="line">         <span class="keyword">return</span> modelAndView;</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="5-8-2、定制错误响应："><a href="#5-8-2、定制错误响应：" class="headerlink" title="5.8.2、定制错误响应："></a>5.8.2、定制错误响应：</h4><h5 id="定制错误的页面；"><a href="#定制错误的页面；" class="headerlink" title="定制错误的页面；"></a>定制错误的页面；</h5><p>1）、有模板引擎的情况下；error/状态码; 【将错误页面命名为  错误状态码.html 放在模板引擎文件夹里面的 error文件夹下】，发生此状态码的错误就会来到  对应的页面；</p>
<pre><code>    我们可以使用4xx和5xx作为错误页面的文件名来匹配这种类型的所有错误，精确优先（优先寻找精确的状态码.html）；

    页面能获取的信息；

       timestamp：时间戳

       status：状态码

       error：错误提示

       exception：异常对象

       message：异常消息

       errors：JSR303数据校验的错误都在这里
</code></pre>
<p>2）、没有模板引擎（模板引擎找不到这个错误页面），静态资源文件夹下找；</p>
<p>3）、以上都没有错误页面，就是默认来到SpringBoot默认的错误提示页面；</p>
<h5 id="定制错误的json数据；"><a href="#定制错误的json数据；" class="headerlink" title="定制错误的json数据；"></a>定制错误的json数据；</h5><p>1）、自定义异常处理&amp;返回定制json数据；</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ControllerAdvice</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyExceptionHandler</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="meta">@ExceptionHandler(UserNotExistException.class)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Map&lt;String,Object&gt; <span class="title">handleException</span><span class="params">(Exception e)</span></span>&#123;</span><br><span class="line">        Map&lt;String,Object&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        map.put(<span class="string">&quot;code&quot;</span>,<span class="string">&quot;user.notexist&quot;</span>);</span><br><span class="line">        map.put(<span class="string">&quot;message&quot;</span>,e.getMessage());</span><br><span class="line">        <span class="keyword">return</span> map;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//没有自适应效果...</span></span><br></pre></td></tr></table></figure>



<p>2）、转发到/error进行自适应响应效果处理</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ExceptionHandler(UserNotExistException.class)</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> String <span class="title">handleException</span><span class="params">(Exception e, HttpServletRequest request)</span></span>&#123;</span><br><span class="line">       Map&lt;String,Object&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">       <span class="comment">//传入我们自己的错误状态码  4xx 5xx，否则就不会进入定制错误页面的解析流程</span></span><br><span class="line">       <span class="comment">/**</span></span><br><span class="line"><span class="comment">        * Integer statusCode = (Integer) request</span></span><br><span class="line"><span class="comment">        .getAttribute(&quot;javax.servlet.error.status_code&quot;);</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">       request.setAttribute(<span class="string">&quot;javax.servlet.error.status_code&quot;</span>,<span class="number">500</span>);</span><br><span class="line">       map.put(<span class="string">&quot;code&quot;</span>,<span class="string">&quot;user.notexist&quot;</span>);</span><br><span class="line">       map.put(<span class="string">&quot;message&quot;</span>,e.getMessage());</span><br><span class="line">       <span class="comment">//转发到/error</span></span><br><span class="line">       <span class="keyword">return</span> <span class="string">&quot;forward:/error&quot;</span>;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>



<p>3）、将我们的定制数据携带出去；</p>
<p>出现错误以后，会来到/error请求，会被BasicErrorController处理，响应出去可以获取的数据是由getErrorAttributes得到的（是AbstractErrorController（ErrorController）规定的方法）；</p>
<p>  1、完全来编写一个ErrorController的实现类【或者是编写AbstractErrorController的子类】，放在容器中；</p>
<p>  2、页面上能用的数据，或者是json返回能用的数据都是通过errorAttributes.getErrorAttributes得到；</p>
<pre><code>    容器中DefaultErrorAttributes.getErrorAttributes()；默认进行数据处理的；
</code></pre>
<p>自定义ErrorAttributes</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//给容器中加入我们自己定义的ErrorAttributes</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyErrorAttributes</span> <span class="keyword">extends</span> <span class="title">DefaultErrorAttributes</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title">getErrorAttributes</span><span class="params">(RequestAttributes requestAttributes, <span class="keyword">boolean</span> includeStackTrace)</span> </span>&#123;</span><br><span class="line">        Map&lt;String, Object&gt; map = <span class="keyword">super</span>.getErrorAttributes(requestAttributes, includeStackTrace);</span><br><span class="line">        map.put(<span class="string">&quot;company&quot;</span>,<span class="string">&quot;atguigu&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> map;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>最终的效果：响应是自适应的，可以通过定制ErrorAttributes改变需要返回的内容，</p>
<h2 id="六、整合JDBC"><a href="#六、整合JDBC" class="headerlink" title="六、整合JDBC"></a>六、整合JDBC</h2><h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><ol>
<li><p>导入JDBC的启动器，以及mysql的相关依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ol>
<ol start="2">
<li>在springboot的配置中对数据源<strong>datasource</strong>进行配置</li>
</ol>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">123456</span></span><br><span class="line">    <span class="comment">#?serverTimezone=UTC解决时区的报错 </span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/ems?serverTimezone=UTC&amp;useUnicode=true&amp;characterEncoding=utf-8</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">#type 指定自定义数据源类型，以下是阿里的druid数据源</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">com.alibaba.druid.pool.DruidDataSource</span></span><br><span class="line">    </span><br></pre></td></tr></table></figure>

<p>配置好，就可以直接使用了，其余的springboot自动配置</p>
<p><strong>com.zaxxer.hikari.HikariDataSource （Spring Boot 2.0 以上，默认使用此数据源）</strong></p>
<p><strong>可以使用 spring.datasource.type 指定自定义的数据源类型，值为 要使用的连接池实现的完全限定名。默认情况下，它是从类路径自动检测的。</strong></p>
<p>可以测试一下是否配置完成  在测试类中</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith(SpringRunner.class)</span></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringbootDemoDataApplicationTests</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//DI注入数据源</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    DataSource dataSource;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">contextLoads</span><span class="params">()</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">        <span class="comment">//看一下默认数据源 dataSource.getClass()</span></span><br><span class="line">        System.out.println(dataSource.getClass());</span><br><span class="line">        <span class="comment">//输出默认数据源：com.zaxxer.hikari.HikariDataSource</span></span><br><span class="line">        <span class="comment">//获得连接</span></span><br><span class="line">        Connection connection =   dataSource.getConnection();</span><br><span class="line">        System.out.println(connection);</span><br><span class="line">        <span class="comment">//关闭连接</span></span><br><span class="line">        connection.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><p><strong>CRUD操作</strong></p>
<p>方法：</p>
<ol>
<li>配置好数据源（dataSource）后，就可以拿到数据库连接（Connection），使用连接和原生的JDBC就可以进行操作数据库</li>
<li>使用第三方框架，mybatis，hibernate等</li>
<li><strong>使用Spring对原生JDBC的轻量级封装 ，即org.springframework.jdbc.core.JdbcTemplate。</strong></li>
</ol>
<p>在jdbcTemplate中，封装有数据库操作的所有CRUD方法</p>
<p>在springboot中已默认配置了jdbcTemplate，并放入容器中，<strong>直接自行注入即可使用</strong>。</p>
<p><strong>jdbcTempalte提供的几类方法</strong>：</p>
<ul>
<li>execute方法：可以用于执行任何SQL语句，一般用于执行DDL语句；</li>
<li><strong>update方法</strong>及batchUpdate方法：update方法用于执行新增、修改、删除等语句；batchUpdate方法用于执行批处理相关语句；</li>
<li><strong>query方法及queryForXXX方法</strong>：用于执行查询相关语句；</li>
<li>call方法：用于执行存储过程、函数相关语句。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JdbcController</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">     <span class="comment">//JdbcTemplate 是 core 包的核心类，用于简化 JDBC操作，还能避免一些常见的错误，如忘记关闭数据库连接</span></span><br><span class="line">    <span class="comment">//Spring Boot 默认提供了数据源，默认提供了 org.springframework.jdbc.core.JdbcTemplate</span></span><br><span class="line">    <span class="comment">//JdbcTemplate 中会自己注入数据源，使用起来也不用再自己来关闭数据库连接</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    JdbcTemplate jdbcTemplate;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//查询数据库的所有连接</span></span><br><span class="line">   <span class="comment">//没有实体类，怎么取数据库的数据？用Map&lt;String,Object&gt;</span></span><br><span class="line">   <span class="comment">//Map 中的 key 对应数据库的字段名，value 对应数据库的字段值</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;findAll&quot;)</span></span><br><span class="line">    <span class="comment">//查询所有</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Map&lt;String,Object&gt;&gt; findAll()&#123;</span><br><span class="line">        String sql=<span class="string">&quot;select * from admin&quot;</span>;</span><br><span class="line">    </span><br><span class="line">        <span class="comment">//List 中的1个 Map 对应数据库的 1行数据</span></span><br><span class="line">    <span class="comment">//Map 中的 key 对应数据库的字段名，value 对应数据库的字段值</span></span><br><span class="line">        </span><br><span class="line">        List&lt;Map&lt;String, Object&gt;&gt; maps =   jdbcTemplate.queryForList(sql);</span><br><span class="line">       </span><br><span class="line">        <span class="keyword">return</span> maps;</span><br><span class="line">    &#125;</span><br><span class="line">   <span class="comment">//增加信息</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;add&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">add</span><span class="params">()</span></span>&#123;</span><br><span class="line">        String sql=<span class="string">&quot;insert into ems.admin values(&#x27;123142&#x27;,&#x27;root&#x27;,&#x27;991016&#x27;,&#x27;测试3&#x27;)&quot;</span>;</span><br><span class="line">        </span><br><span class="line">        jdbcTemplate.update(sql);</span><br><span class="line">       </span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;update-ok&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//删除数据</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;delete&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">delete</span><span class="params">()</span></span>&#123;</span><br><span class="line">        </span><br><span class="line">        String sql=<span class="string">&quot;delete from ems.admin where id=&#x27;123142&#x27;&quot;</span>;</span><br><span class="line">        </span><br><span class="line">        jdbcTemplate.update(sql);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;delete-ok&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//修改数据</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;update&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">update</span><span class="params">()</span></span>&#123;</span><br><span class="line">        String sql=<span class="string">&quot;update ems.admin set name=&#x27;测试&#x27; where id=&#x27;123142&#x27;&quot;</span>;</span><br><span class="line">       </span><br><span class="line">        jdbcTemplate.update(sql);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;update-ok&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="七、整合Druid数据源"><a href="#七、整合Druid数据源" class="headerlink" title="七、整合Druid数据源"></a>七、整合Druid数据源</h2><p>简介：</p>
<p>Druid 是阿里巴巴开源平台上一个数据库连接池实现，结合了 C3P0、DBCP、PROXOOL 等 DB 池的优点，同时加入了日志监控。</p>
<p>Druid 基本配置参数：</p>
<table>
<thead>
<tr>
<th>配置</th>
<th>缺省值</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>name</td>
<td></td>
<td>配置这个属性的意义在于，如果存在多个数据源，监控的时候可以通过名字来区分开来。 如果没有配置，将会生成一个名字，格式是：”DataSource-“ + System.identityHashCode(this).  另外配置此属性至少在1.0.5版本中是不起作用的，强行设置name会出错 <a target="_blank" rel="noopener" href="http://blog.csdn.net/lanmo555/article/details/41248763">详情-点此处</a>。</td>
</tr>
<tr>
<td>url</td>
<td></td>
<td>连接数据库的url，不同数据库不一样。例如： mysql : jdbc:mysql://10.20.153.104:3306/druid2  oracle : jdbc:oracle:thin:@10.20.149.85:1521:ocnauto</td>
</tr>
<tr>
<td>username</td>
<td></td>
<td>连接数据库的用户名</td>
</tr>
<tr>
<td>password</td>
<td></td>
<td>连接数据库的密码。如果你不希望密码直接写在配置文件中，可以使用ConfigFilter。详细看这里：<a target="_blank" rel="noopener" href="https://github.com/alibaba/druid/wiki/%E4%BD%BF%E7%94%A8ConfigFilter">https://github.com/alibaba/druid/wiki/%E4%BD%BF%E7%94%A8ConfigFilter</a></td>
</tr>
<tr>
<td>driverClassName</td>
<td>根据url自动识别</td>
<td>这一项可配可不配，如果不配置druid会根据url自动识别dbType，然后选择相应的driverClassName</td>
</tr>
<tr>
<td>initialSize</td>
<td>0</td>
<td>初始化时建立物理连接的个数。初始化发生在显示调用init方法，或者第一次getConnection时</td>
</tr>
<tr>
<td>maxActive</td>
<td>8</td>
<td>最大连接池数量</td>
</tr>
<tr>
<td>maxIdle</td>
<td>8</td>
<td>已经不再使用，配置了也没效果</td>
</tr>
<tr>
<td>minIdle</td>
<td></td>
<td>最小连接池数量</td>
</tr>
<tr>
<td>maxWait</td>
<td></td>
<td>获取连接时最大等待时间，单位毫秒。配置了maxWait之后，缺省启用公平锁，并发效率会有所下降，如果需要可以通过配置useUnfairLock属性为true使用非公平锁。</td>
</tr>
<tr>
<td>poolPreparedStatements</td>
<td>false</td>
<td>是否缓存preparedStatement，也就是PSCache。PSCache对支持游标的数据库性能提升巨大，比如说oracle。在mysql下建议关闭。</td>
</tr>
<tr>
<td>maxOpenPreparedStatements</td>
<td>-1</td>
<td>要启用PSCache，必须配置大于0，当大于0时，poolPreparedStatements自动触发修改为true。在Druid中，不会存在Oracle下PSCache占用内存过多的问题，可以把这个数值配置大一些，比如说100</td>
</tr>
<tr>
<td>validationQuery</td>
<td></td>
<td>用来检测连接是否有效的sql，要求是一个查询语句。如果validationQuery为null，testOnBorrow、testOnReturn、testWhileIdle都不会其作用。</td>
</tr>
<tr>
<td>validationQueryTimeout</td>
<td></td>
<td>单位：秒，检测连接是否有效的超时时间。底层调用jdbc Statement对象的void setQueryTimeout(int seconds)方法</td>
</tr>
<tr>
<td>testOnBorrow</td>
<td>true</td>
<td>申请连接时执行validationQuery检测连接是否有效，做了这个配置会降低性能。</td>
</tr>
<tr>
<td>testOnReturn</td>
<td>false</td>
<td>归还连接时执行validationQuery检测连接是否有效，做了这个配置会降低性能</td>
</tr>
<tr>
<td>testWhileIdle</td>
<td>false</td>
<td>建议配置为true，不影响性能，并且保证安全性。申请连接的时候检测，如果空闲时间大于timeBetweenEvictionRunsMillis，执行validationQuery检测连接是否有效。</td>
</tr>
<tr>
<td>timeBetweenEvictionRunsMillis</td>
<td>1分钟（1.0.14）</td>
<td>有两个含义： 1) Destroy线程会检测连接的间隔时间，如果连接空闲时间大于等于minEvictableIdleTimeMillis则关闭物理连接 2) testWhileIdle的判断依据，详细看testWhileIdle属性的说明</td>
</tr>
<tr>
<td>numTestsPerEvictionRun</td>
<td></td>
<td>不再使用，一个DruidDataSource只支持一个EvictionRun</td>
</tr>
<tr>
<td>minEvictableIdleTimeMillis</td>
<td>30分钟（1.0.14）</td>
<td>连接保持空闲而不被驱逐的最长时间</td>
</tr>
<tr>
<td>connectionInitSqls</td>
<td></td>
<td>物理连接初始化的时候执行的sql</td>
</tr>
<tr>
<td>exceptionSorter</td>
<td>根据dbType自动识别</td>
<td>当数据库抛出一些不可恢复的异常时，抛弃连接</td>
</tr>
<tr>
<td>filters</td>
<td></td>
<td>属性类型是字符串，通过别名的方式配置扩展插件，常用的插件有： 监控统计用的filter:stat 日志用的filter:log4j 防御sql注入的filter:wall</td>
</tr>
<tr>
<td>proxyFilters</td>
<td></td>
<td>类型是List&lt;com.alibaba.druid.filter.Filter&gt;，如果同时配置了filters和proxyFilters，是组合关系，并非替换关系</td>
</tr>
</tbody></table>
<h3 id="导入依赖"><a href="#导入依赖" class="headerlink" title="导入依赖"></a>导入依赖</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--log4j--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.17<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="配置数据源"><a href="#配置数据源" class="headerlink" title="配置数据源"></a>配置数据源</h3><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">991016</span></span><br><span class="line"><span class="comment">#    如果mysql关于时区报错，就在url中加一个参数 ：serverTimezeno=UTC</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">JDBC:mysql://localhost:3306/ems?serverTimezone=UTC&amp;useUnicode=true&amp;characterEncoding=utf-8</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line"><span class="comment">#    切换数据源   默认的数据源：com.zaxxer.hikari.HikariDataSource</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">com.alibaba.druid.pool.DruidDataSource</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#Spring Boot 默认是不注入这些属性值的，需要自己绑定</span></span><br><span class="line">    <span class="comment">#druid 数据源专有配置</span></span><br><span class="line">    <span class="attr">druid:</span></span><br><span class="line">        <span class="attr">initialSize:</span> <span class="number">5</span></span><br><span class="line">        <span class="attr">minIdle:</span> <span class="number">5</span></span><br><span class="line">        <span class="attr">maxActive:</span> <span class="number">20</span></span><br><span class="line">        <span class="attr">maxWait:</span> <span class="number">60000</span></span><br><span class="line">        <span class="attr">timeBetweenEvictionRunsMillis:</span> <span class="number">60000</span></span><br><span class="line">        <span class="attr">minEvictableIdleTimeMillis:</span> <span class="number">300000</span></span><br><span class="line">        <span class="attr">validationQuery:</span> <span class="string">SELECT</span> <span class="number">1</span> <span class="string">FROM</span> <span class="string">DUAL</span></span><br><span class="line">        <span class="attr">testWhileIdle:</span> <span class="literal">true</span></span><br><span class="line">        <span class="attr">testOnBorrow:</span> <span class="literal">false</span></span><br><span class="line">        <span class="attr">testOnReturn:</span> <span class="literal">false</span></span><br><span class="line">        <span class="attr">poolPreparedStatements:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">#配置监控统计拦截的filters，stat:监控统计、log4j：日志记录、wall：防御sql注入</span></span><br><span class="line">        <span class="comment">#如果允许时报错  java.lang.ClassNotFoundException: org.apache.log4j.Priority</span></span><br><span class="line">        <span class="comment">#则导入 log4j 依赖即可，Maven 地址： https://mvnrepository.com/artifact/log4j/log4j</span></span><br><span class="line">        <span class="attr">filters:</span> <span class="string">stat,log4j</span></span><br><span class="line">        <span class="attr">maxPoolPreparedStatementPerConnectionSize:</span> <span class="number">20</span></span><br><span class="line">        <span class="attr">useGlobalDataSourceStat:</span> <span class="literal">true</span></span><br><span class="line">        <span class="attr">connectionProperties:</span> <span class="string">druid.stat.mergeSql=true;druid.stat.slowSqlMillis=500</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>配置完成后可在测试类中，检测数据源是否配置完成</p>
<h3 id="配置Druid数据监控"><a href="#配置Druid数据监控" class="headerlink" title="配置Druid数据监控"></a>配置Druid数据监控</h3><p>Druid 数据源具有监控的功能，并提供了一个 web 界面方便用户查看，类似安装 路由器 时，人家也提供了一个默认的 web 页面。</p>
<p>所以第一步需要设置 Druid 的后台管理页面，比如 登录账号、密码 等；配置后台管理；</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DruidConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ConfigurationProperties(prefix = &quot;spring.datasource&quot;)</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> DataSource <span class="title">druidDataSource</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> DruidDataSource();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//后台监控   web.xml ServletRegistrationBean</span></span><br><span class="line">    <span class="comment">//因为springboot 内置了servlet容器，所以没有web.xml ，替代方法：servletRegistrationBean</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ServletRegistrationBean <span class="title">statViewServlet</span><span class="params">()</span></span>&#123;</span><br><span class="line">        ServletRegistrationBean&lt;StatViewServlet&gt; bean = <span class="keyword">new</span> ServletRegistrationBean&lt;&gt;(<span class="keyword">new</span> StatViewServlet(),<span class="string">&quot;/druid/*&quot;</span>);</span><br><span class="line">        <span class="comment">//后台需要有人登录，账号密码配置</span></span><br><span class="line">        HashMap&lt;String,String&gt; initParameters = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//增加配置</span></span><br><span class="line">        initParameters.put(<span class="string">&quot;loginUsername&quot;</span>,<span class="string">&quot;admin&quot;</span>);<span class="comment">//登录key，是固定的 LoginUsername、LoginPassword</span></span><br><span class="line">        initParameters.put(<span class="string">&quot;loginPassword&quot;</span>,<span class="string">&quot;991016&quot;</span>);</span><br><span class="line">        <span class="comment">//允许谁可以访问</span></span><br><span class="line">        initParameters.put(<span class="string">&quot;allow&quot;</span>,<span class="string">&quot;&quot;</span>);</span><br><span class="line">        <span class="comment">//禁止谁可以访问</span></span><br><span class="line">        initParameters.put(<span class="string">&quot;kuangsheng&quot;</span>,<span class="string">&quot;192.168&quot;</span>);</span><br><span class="line"></span><br><span class="line">        bean.setInitParameters(initParameters);</span><br><span class="line">        <span class="keyword">return</span> bean;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">// filter</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> FilterRegistrationBean <span class="title">webStatFilter</span><span class="params">()</span></span>&#123;</span><br><span class="line">        FilterRegistrationBean&lt;Filter&gt; bean = <span class="keyword">new</span> FilterRegistrationBean&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        bean.setFilter(<span class="keyword">new</span> WebStatFilter());</span><br><span class="line"></span><br><span class="line">        <span class="comment">//可以过滤哪些请求？</span></span><br><span class="line">        HashMap&lt;String,String&gt; initParameters = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        <span class="comment">//这些东西不进行统计</span></span><br><span class="line">        initParameters.put(<span class="string">&quot;exclusions&quot;</span>,<span class="string">&quot;*.js,*.css,/druid/*&quot;</span>);</span><br><span class="line"></span><br><span class="line">        bean.setInitParameters(initParameters);</span><br><span class="line">        <span class="keyword">return</span> bean;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="八、整合Mybatis"><a href="#八、整合Mybatis" class="headerlink" title="八、整合Mybatis"></a>八、整合Mybatis</h2><h3 id="1-导入整合mybatis所需依赖"><a href="#1-导入整合mybatis所需依赖" class="headerlink" title="1.导入整合mybatis所需依赖"></a>1.导入整合mybatis所需依赖</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 引入 myBatis，这是 MyBatis官方提供的适配 Spring Boot 的，而不是Spring Boot自己的--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h3 id="2-配置数据源"><a href="#2-配置数据源" class="headerlink" title="2.配置数据源"></a>2.配置数据源</h3><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">991016</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/ems?serverTimezone=UTC&amp;useUnicode=true&amp;characterEncoding=utf-8</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>测试类测试一下是否可以连接成功。。。</p>
<h3 id="3-整合Mybatis"><a href="#3-整合Mybatis" class="headerlink" title="3.整合Mybatis"></a>3.整合Mybatis</h3><p>在配置文件中加入</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">  <span class="comment">#整合mybatis</span></span><br><span class="line"><span class="attr">mybatis:</span></span><br><span class="line">   <span class="comment">#对应实体类的路径</span></span><br><span class="line">  <span class="attr">type-aliases-package:</span> <span class="string">com.xyc.pojo</span></span><br><span class="line">   <span class="comment">#指定mybatis的核心配置文件与Mapper映射文件</span></span><br><span class="line">  <span class="attr">mapper-locations:</span> <span class="string">classpath:mybatis/mapper/*.xml</span></span><br></pre></td></tr></table></figure>

<h3 id="4-创建实体类："><a href="#4-创建实体类：" class="headerlink" title="4.创建实体类："></a>4.创建实体类：</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//lombok的注解标注这是一个实体类</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="comment">//标注自动创建无参构造</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="comment">//标注自动创建有参构造</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Admin</span> </span>&#123;</span><br><span class="line"><span class="keyword">private</span> String id;</span><br><span class="line"><span class="keyword">private</span> String username;</span><br><span class="line"><span class="keyword">private</span> String password;</span><br><span class="line"><span class="keyword">private</span> String name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-配置Mapper接口类"><a href="#5-配置Mapper接口类" class="headerlink" title="5.配置Mapper接口类"></a>5.配置Mapper接口类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//@Mapper : 表示本类是一个 MyBatis 的 Mapper，（dao层）</span></span><br><span class="line"><span class="comment">// 等价于以前 Spring 整合 MyBatis 时的 Mapper 接口</span></span><br><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="comment">//@Repository:将此类放入spring容器中</span></span><br><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">AdminMapper</span> </span>&#123;</span><br><span class="line">    <span class="comment">//查询所有</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Admin&gt; <span class="title">findAll</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="comment">//通过id查询</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Admin <span class="title">findById</span><span class="params">(String id)</span></span>;</span><br><span class="line">    <span class="comment">// 增加</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">add</span><span class="params">(Admin admin)</span></span>;</span><br><span class="line">    <span class="comment">// 修改</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">update</span><span class="params">(Admin admin)</span></span>;</span><br><span class="line">    <span class="comment">// 删除</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">delete</span><span class="params">(String id)</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="6-Mapper映射文件"><a href="#6-Mapper映射文件" class="headerlink" title="6.Mapper映射文件"></a>6.Mapper映射文件</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.xyc.mapper.AdminMapper&quot;</span> &gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findAll&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;Admin&quot;</span> &gt;</span></span><br><span class="line">        select * from admin;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findById&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;Admin&quot;</span>&gt;</span></span><br><span class="line">        select * from admin where id = #&#123;id&#125;;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;add&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;Admin&quot;</span>&gt;</span></span><br><span class="line">        insert into</span><br><span class="line">            admin(id, username, password, name)</span><br><span class="line">        values</span><br><span class="line">            (#&#123;id&#125;,#&#123;username&#125;,#&#123;password&#125;,#&#123;name&#125;)</span><br><span class="line">    <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;update&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;Admin&quot;</span>&gt;</span></span><br><span class="line">        update</span><br><span class="line">            admin</span><br><span class="line">        set</span><br><span class="line">            id= #&#123;id&#125;,</span><br><span class="line">            username= #&#123;username&#125;,</span><br><span class="line">            password= #&#123;password&#125;,</span><br><span class="line">            name =#&#123;name&#125;</span><br><span class="line">        where</span><br><span class="line">            id = #&#123;id&#125;;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">&quot;delete&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;String&quot;</span>&gt;</span></span><br><span class="line">        delete from admin where id = #&#123;id&#125;;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="九、springSecurity"><a href="#九、springSecurity" class="headerlink" title="九、springSecurity"></a>九、springSecurity</h2><h3 id="1、SpringSecurity简介"><a href="#1、SpringSecurity简介" class="headerlink" title="1、SpringSecurity简介"></a>1、SpringSecurity简介</h3><h4 id="1-1、安全框架概述"><a href="#1-1、安全框架概述" class="headerlink" title="1.1、安全框架概述"></a>1.1、安全框架概述</h4><p><strong>什么是安全框架 ?</strong></p>
<p>解决系统安全问题的框架。如果没有安全框架,我们需要手动处理每个资源的访问控制,非常麻烦。使用安全框架,我们可以通过配置的方式实现对资源的访问限制。</p>
<h4 id="1-2、常用安全框架"><a href="#1-2、常用安全框架" class="headerlink" title="1.2、常用安全框架"></a>1.2、常用安全框架</h4><p><strong>Spring Security</strong>: Spring全家桶的一员。是一个能够为基于 Spring的企业应用系统提供声明式的安全访问控制解决方案的安全框架。它提供了一组可以在Spring应用上下文中配置的Bean,充分利用了 <strong>Spring IoC</strong>、<strong>DI</strong>  (控制反转 Inversion of Control；DI: Dependency Injection 依赖注入)和**AoP(面问切面编程)**功能,为应用系统提供声明式的安全访问控制功能,减少了为企业系统安全控制编写大量重复代码的工作。</p>
<p><strong>Apache Shiro</strong>: 一个功能强大且易于使用的Java安全框架提供了认证、授权、加密和会话管理</p>
<h4 id="1-3、简介"><a href="#1-3、简介" class="headerlink" title="1.3、简介"></a>1.3、简介</h4><p>Spring Security是一个高度自定义的安全框架。利用 Spring loC/D和AOP功能,为系统提供了声明式安全访问控制功能,减少了为系统安全而编写大量重复代码的工作。使用 Spring Secruity的原因有很多,但大部分都是发现了javaEE的 Servlet规范或EJB规范中的安全功能缺乏典型企业应用场景。同时认识到他们在WAR或EAR级别无法移植。因此如果你更换服务器环境,还有大量工作去重新配置你的应用程序。使用 Spring Security解决了这些问题也为你提供许多其他有用的、可定制的安全功能。正如你可能知道的两个应用程序的两个主要区域是<strong>“认证和授权”</strong>(或者访问控制)。这两点也是 Spring Security重要核心功能。</p>
<p><strong>“认证“,是建立一个他声明的主体的过程(一个“主体”一般是指用户,设备或一些可以在你的应用程序中执行动作的其他系统),通俗点说就是系统认为用户是否能登录</strong>。</p>
<p><strong>“授权”指确定一个主体是否允许在你的应用程序执行一个动作的过程。通俗点讲就是系统判断用户是否有权限去做某些事情。</strong></p>
<h3 id="2、简单使用"><a href="#2、简单使用" class="headerlink" title="2、简单使用"></a>2、简单使用</h3><p>导入依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-security<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>前端页面</p>
<p>login.html</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;/login&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">用户名：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">密码：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;登录&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>导入spring-boot-starter-security 启动器后，Spring Security 已经生效，默认拦截全部请求，如果用<br>户没有登录，跳转到内置登录页面。</p>
<p><img src="/2021/04/24/springboot/image-20210323181759473.png" alt="image-20210323181759473"></p>
<p>默认的 username 为 user，password 打印在控制台中。</p>
<h3 id="3、UserDetailsService"><a href="#3、UserDetailsService" class="headerlink" title="3、UserDetailsService"></a>3、UserDetailsService</h3><p>当什么也没有配置的时候，账号和密码是由 Spring Security 定义生成的。而在实际项目中账号和密<br>码都是从数据库中查询出来的。所以我们要通过自定义逻辑控制认证逻辑。如果需要自定义逻辑时，只<br>需要实现 UserDetailsService 接口即可。</p>
<p><img src="/2021/04/24/springboot/image-20210323182229365.png" alt="image-20210323182229365"></p>
<h4 id="3-1、返回值"><a href="#3-1、返回值" class="headerlink" title="3.1、返回值"></a>3.1、返回值</h4><p>返回值为  UserDetails 接口 的实例</p>
<p>UserDetails接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserDetails</span> <span class="keyword">extends</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    Collection&lt;? extends GrantedAuthority&gt; getAuthorities();</span><br><span class="line">   <span class="comment">// 获取密码</span></span><br><span class="line">    <span class="function">String <span class="title">getPassword</span><span class="params">()</span></span>;</span><br><span class="line">   <span class="comment">// 获取用户名</span></span><br><span class="line">    <span class="function">String <span class="title">getUsername</span><span class="params">()</span></span>;</span><br><span class="line">   <span class="comment">// 是否账号过期</span></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">isAccountNonExpired</span><span class="params">()</span></span>;</span><br><span class="line">   <span class="comment">// 是否账号被锁定</span></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">isAccountNonLocked</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="comment">// 凭证（密码）是否过期</span></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">isCredentialsNonExpired</span><span class="params">()</span></span>;</span><br><span class="line">   <span class="comment">// 是否可用</span></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">isEnabled</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>想返回 <strong>UserDetails</strong> 的实例,只能返回接口的实现类。SpringSecurity 中提供了如下的实例。</p>
<p><img src="/2021/04/24/springboot/image-20210323182832191.png" alt="image-20210323182832191"></p>
<p>我们只需要使用里面的 User 类即可。注意 User 的全限定路径是：<code>org.springframework.security.core.userdetails.User</code> 此处经常和系统中自己开发的 User 类弄混。</p>
<p>User 类的方法和属性</p>
<p><img src="/2021/04/24/springboot/image-20210323183150672.png" alt="image-20210323183150672"></p>
<p>构造方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * username : 用户名 ，password : 密码，authorities ： 用户所具有的权限 （not null）</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">User</span><span class="params">(String username, String password, Collection&lt;? extends GrantedAuthority&gt; authorities)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>(username, password, <span class="keyword">true</span>, <span class="keyword">true</span>, <span class="keyword">true</span>, <span class="keyword">true</span>, authorities);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">User</span><span class="params">(String username, String password, <span class="keyword">boolean</span> enabled, <span class="keyword">boolean</span> accountNonExpired, <span class="keyword">boolean</span> credentialsNonExpired, <span class="keyword">boolean</span> accountNonLocked, Collection&lt;? extends GrantedAuthority&gt; authorities)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (username != <span class="keyword">null</span> &amp;&amp; !<span class="string">&quot;&quot;</span>.equals(username) &amp;&amp; password != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">this</span>.username = username;</span><br><span class="line">            <span class="keyword">this</span>.password = password;</span><br><span class="line">            <span class="keyword">this</span>.enabled = enabled;</span><br><span class="line">            <span class="keyword">this</span>.accountNonExpired = accountNonExpired;</span><br><span class="line">            <span class="keyword">this</span>.credentialsNonExpired = credentialsNonExpired;</span><br><span class="line">            <span class="keyword">this</span>.accountNonLocked = accountNonLocked;</span><br><span class="line">            <span class="keyword">this</span>.authorities = Collections.unmodifiableSet(sortAuthorities(authorities));</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">&quot;Cannot pass null or empty values to constructor&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>此处的用户名应该是客户端传递过来的用户名。而密码应该是从数据库中查询出来的密码。SpringSecurity 会根据 User 中的 password 和客户端传递过来的 password 进行比较。如果相同则表示认证通过，如果不相同表示认证失败。</p>
<p>authorities 里面包含的所有内容为此用户具有的权限，如有里面没有包含某个权限，而在做某个事情时必须包含某个权限则会出现 403。通常都是通过AuthorityUtils.commaSeparatedStringToAuthorityList(“”) 来创建authorities 集合对象的。参数是一个字符串，多个权限使用逗号分隔。</p>
<h4 id="3-2、方法参数"><a href="#3-2、方法参数" class="headerlink" title="3.2、方法参数"></a>3.2、方法参数</h4><p>方法参数为登录时传入的用户名</p>
<h4 id="3-3、异常"><a href="#3-3、异常" class="headerlink" title="3.3、异常"></a>3.3、异常</h4><p><code>UsernameNotFoundException</code> 用户名没有发现异常。在 loadUserByUsername 中是需要通过自己的逻辑从数据库中取值的。如果通过用户名没有查询到对应的数据，应该抛出UsernameNotFoundException ，系统就知道用户名没有查询到。</p>
<h4 id="3-4、实现案例"><a href="#3-4、实现案例" class="headerlink" title="3.4、实现案例"></a>3.4、实现案例</h4><p>UserDetailsService接口的实现类 ：UserDetailsServiceImpl</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserDetailsServiceImpl</span> <span class="keyword">implements</span> <span class="title">UserDetailsService</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger log = LoggerFactory.getLogger(UserDetailsServiceImpl.class);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ISysUserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> SysPermissionService permissionService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> UserDetails <span class="title">loadUserByUsername</span><span class="params">(String username)</span> <span class="keyword">throws</span> UsernameNotFoundException </span>&#123;</span><br><span class="line">        SysUser user = userService.selectUserByUserName(username);</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isNull(user)) &#123;</span><br><span class="line">            log.info(<span class="string">&quot;登录用户：&#123;&#125; 不存在.&quot;</span>, username);</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> UsernameNotFoundException(<span class="string">&quot;登录用户：&quot;</span> + username + <span class="string">&quot; 不存在&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (UserStatus.DELETED.getCode().equals(user.getDelFlag())) &#123;</span><br><span class="line">            log.info(<span class="string">&quot;登录用户：&#123;&#125; 已被删除.&quot;</span>, username);</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> BaseException(<span class="string">&quot;对不起，您的账号：&quot;</span> + username + <span class="string">&quot; 已被删除&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (UserStatus.DISABLE.getCode().equals(user.getStatus())) &#123;</span><br><span class="line">            log.info(<span class="string">&quot;登录用户：&#123;&#125; 已被停用.&quot;</span>, username);</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> BaseException(<span class="string">&quot;对不起，您的账号：&quot;</span> + username + <span class="string">&quot; 已停用&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> createLoginUser(user);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> UserDetails <span class="title">createLoginUser</span><span class="params">(SysUser user)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> LoginUser(user, permissionService.getMenuPermission(user));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>UserDetails接口的实现类  LoginUser</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginUser</span> <span class="keyword">implements</span> <span class="title">UserDetails</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 用户唯一标识</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String token;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 登录时间</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Long loginTime;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 过期时间</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Long expireTime;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 登录IP地址</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String ipaddr;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 登录地点</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String loginLocation;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 浏览器类型</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String browser;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 操作系统</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String os;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 权限列表</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Set&lt;String&gt; permissions;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 用户信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> SysUser user;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getToken</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> token;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setToken</span><span class="params">(String token)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.token = token;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LoginUser</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LoginUser</span><span class="params">(SysUser user, Set&lt;String&gt; permissions)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.user = user;</span><br><span class="line">        <span class="keyword">this</span>.permissions = permissions;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@JsonIgnore</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getPassword</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> user.getPassword();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getUsername</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> user.getUserName();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 账户是否未过期,过期无法验证</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@JsonIgnore</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isAccountNonExpired</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 指定用户是否解锁,锁定的用户无法进行身份验证</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@JsonIgnore</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isAccountNonLocked</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 指示是否已过期的用户的凭据(密码),过期的凭据防止认证</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@JsonIgnore</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isCredentialsNonExpired</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 是否可用 ,禁用的用户不能身份验证</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@JsonIgnore</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isEnabled</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Collection&lt;? extends GrantedAuthority&gt; getAuthorities() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="4、PasswordEncoder"><a href="#4、PasswordEncoder" class="headerlink" title="4、PasswordEncoder"></a>4、PasswordEncoder</h3><p>Spring Security 要求容器中必须有 PasswordEncoder 实例。所以当自定义登录逻辑时要求必须给容器注入 PaswordEncoder 的bean对象。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">PasswordEncoder</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 把参数按照特定的解析规则进行解析</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">String <span class="title">encode</span><span class="params">(CharSequence var1)</span></span>;</span><br><span class="line">   <span class="comment">/*</span></span><br><span class="line"><span class="comment">   * 验证从存储中获取的编码密码与编码后提交的原始密码是否匹配。如果密码匹配，</span></span><br><span class="line"><span class="comment">   * 则返回 true；如果不匹配，则返回 false。第一个参数表示需要被解析的密码。第二个参数表示存</span></span><br><span class="line"><span class="comment">    * 储的密码。</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">matches</span><span class="params">(CharSequence var1, String var2)</span></span>;</span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 如果解析的密码能够再次进行解析且达到更安全的结果则返回 true，否则返回 false。默认返回 false。</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="function"><span class="keyword">default</span> <span class="keyword">boolean</span> <span class="title">upgradeEncoding</span><span class="params">(String encodedPassword)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>内置解析器</p>
<p><img src="/2021/04/24/springboot/image-20210323185034812.png" alt="image-20210323185034812"></p>
<p>内置解析器有很多 ，BCryptPasswordEncoder 是官方推荐的密码解析器。 BCryptPasswordEncoder 是对 bcrypt 强散列方法的具体实现。是基于Hash算法实现的单向加密。可以通过strength控制加密强度，默认 10.</p>
<h3 id="5、自定义登录逻辑"><a href="#5、自定义登录逻辑" class="headerlink" title="5、自定义登录逻辑"></a>5、自定义登录逻辑</h3><p>当 进 行 自 定 义 登 录 逻 辑 时 需 要 用 到 之 前 讲 解 的 <code>UserDetailsService</code> 和<code>PasswordEncoder</code> 。但是 Spring Security 要求：当进行自定义登录逻辑时容器内必须有PasswordEncoder 实例。</p>
<h4 id="5-1、配置类"><a href="#5-1、配置类" class="headerlink" title="5.1、配置类"></a>5.1、配置类</h4><p>将PasswordEncoder注入到容器中</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SecurityConfig</span> </span>&#123;</span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> PasswordEncoder <span class="title">getPw</span><span class="params">()</span></span>&#123;</span><br><span class="line">   <span class="keyword">return</span> <span class="keyword">new</span> BCryptPasswordEncoder();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="5-2、自定义逻辑"><a href="#5-2、自定义逻辑" class="headerlink" title="5.2、自定义逻辑"></a>5.2、自定义逻辑</h4><p>在 Spring Security 中实现 UserDetailService 就表示为用户详情服务。在这个类中编写用户认证逻辑。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title">UserDetailsService</span> </span>&#123;</span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> PasswordEncoder pw;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> UserDetails <span class="title">loadUserByUsername</span><span class="params">(String username)</span> <span class="keyword">throws</span></span></span><br><span class="line"><span class="function">UsernameNotFoundException </span>&#123;</span><br><span class="line">   <span class="comment">//1.查询数据库判断用户名是否存在，如果不存在抛出UsernameNotFoundException异常</span></span><br><span class="line">   <span class="keyword">if</span> (!<span class="string">&quot;admin&quot;</span>.equals(username))&#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> UsernameNotFoundException(<span class="string">&quot;用户名不存在&quot;</span>);</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="comment">//2.把查询出来的密码（注册时已经加密过）进行解析，或直接把密码放入构造方法中</span></span><br><span class="line">   String password = pw.encode(<span class="string">&quot;123&quot;</span>);</span><br><span class="line">   <span class="keyword">return</span> <span class="keyword">new</span> User(username,password,</span><br><span class="line">      AuthorityUtils.commaSeparatedStringToAuthorityList(<span class="string">&quot;admin,normal&quot;</span>));</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="6、自定义登录界面"><a href="#6、自定义登录界面" class="headerlink" title="6、自定义登录界面"></a>6、自定义登录界面</h3><h4 id="6-1、修改配置类"><a href="#6-1、修改配置类" class="headerlink" title="6.1、修改配置类"></a>6.1、修改配置类</h4><p>主要是设置哪个页面是登录页面。配置类需要继承WebSecurityConfigurerAdapte,并重写 configure 方法。</p>
<ul>
<li>successForwardUrl() ：登录成功后跳转地址</li>
<li>loginPage() ：登录页面</li>
<li>loginProcessingUrl() ：登录页面表单提交地址，此地址可以不真实存在。</li>
<li>antMatchers() ：匹配内容</li>
<li>permitAll() ：允许</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SecurityConfig</span> <span class="keyword">extends</span> <span class="title">WebSecurityConfigurerAdapter</span> </span>&#123;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">   <span class="comment">//表单提交</span></span><br><span class="line">   http.formLogin()</span><br><span class="line">   <span class="comment">//自定义登录页面</span></span><br><span class="line">      .loginPage(<span class="string">&quot;/login.html&quot;</span>)</span><br><span class="line">    <span class="comment">//当发现/login时认为是登录，必须和表单提交的地址一样。去执行UserServiceImpl</span></span><br><span class="line">      .loginProcessingUrl(<span class="string">&quot;/login&quot;</span>)</span><br><span class="line">   <span class="comment">//登录成功后跳转页面，POST请求</span></span><br><span class="line">      .successForwardUrl(<span class="string">&quot;/toMain&quot;</span>);</span><br><span class="line">  </span><br><span class="line">    http.authorizeRequests()</span><br><span class="line">      <span class="comment">//login.html不需要被认证</span></span><br><span class="line">      .antMatchers(<span class="string">&quot;/login.html&quot;</span>).permitAll()</span><br><span class="line">      <span class="comment">//所有请求都必须被认证，必须登录后被访问</span></span><br><span class="line">      .anyRequest().authenticated();</span><br><span class="line">      </span><br><span class="line">       <span class="comment">//关闭csrf防护</span></span><br><span class="line">      http.csrf().disable();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> PasswordEncoder <span class="title">getPw</span><span class="params">()</span></span>&#123;</span><br><span class="line">   <span class="keyword">return</span> <span class="keyword">new</span> BCryptPasswordEncoder();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="7、认证过程中其他常用配置"><a href="#7、认证过程中其他常用配置" class="headerlink" title="7、认证过程中其他常用配置"></a>7、认证过程中其他常用配置</h3><h4 id="7-1、失败跳转"><a href="#7-1、失败跳转" class="headerlink" title="7.1、失败跳转"></a>7.1、失败跳转</h4><p>设置失败跳转页面</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//表单提交</span></span><br><span class="line">http.formLogin()</span><br><span class="line">   <span class="comment">//自定义登录页面</span></span><br><span class="line">   .loginPage(<span class="string">&quot;/login.html&quot;</span>)</span><br><span class="line">   <span class="comment">//当发现/login时认为是登录，必须和表单提交的地址一样。去执行UserServiceImpl</span></span><br><span class="line">   .loginProcessingUrl(<span class="string">&quot;/login&quot;</span>)</span><br><span class="line">   <span class="comment">//登录成功后跳转页面，POST请求</span></span><br><span class="line">   .successForwardUrl(<span class="string">&quot;/toMain&quot;</span>)</span><br><span class="line">   <span class="comment">//登录失败后跳转页面，POST请求</span></span><br><span class="line">   .failureForwardUrl(<span class="string">&quot;/toError&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>设置失败页面不拦截</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">http.authorizeRequests()</span><br><span class="line"><span class="comment">//login.html不需要被认证</span></span><br><span class="line">.antMatchers(<span class="string">&quot;/login.html&quot;</span>).permitAll()</span><br><span class="line"><span class="comment">//error.html不需要被认证</span></span><br><span class="line">.antMatchers(<span class="string">&quot;/error.html&quot;</span>).permitAll()</span><br><span class="line"><span class="comment">//所有请求都必须被认证，必须登录后被访问</span></span><br><span class="line">.anyRequest().authenticated();</span><br></pre></td></tr></table></figure>



<h4 id="7-2、设置请求账户和密码的参数名"><a href="#7-2、设置请求账户和密码的参数名" class="headerlink" title="7.2、设置请求账户和密码的参数名"></a>7.2、设置请求账户和密码的参数名</h4><p>当进行登录时会执行 UsernamePasswordAuthenticationFilter 过滤器。在该过滤器中定义请求的用户名密码默认为</p>
<p>username和password。</p>
<p><img src="/2021/04/24/springboot/image-20210323191116568.png" alt="image-20210323191116568"></p>
<p>修改默认用户名和密码参数名</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//表单提交</span></span><br><span class="line">http.formLogin()</span><br><span class="line">   <span class="comment">//自定义登录页面</span></span><br><span class="line">   .loginPage(<span class="string">&quot;/login.html&quot;</span>)</span><br><span class="line">   <span class="comment">//当发现/login时认为是登录，必须和表单提交的地址一样。去执行UserServiceImpl</span></span><br><span class="line">   .loginProcessingUrl(<span class="string">&quot;/login&quot;</span>)</span><br><span class="line">   <span class="comment">//登录成功后跳转页面，POST请求</span></span><br><span class="line">   .successForwardUrl(<span class="string">&quot;/toMain&quot;</span>)</span><br><span class="line">   <span class="comment">//登录失败后跳转页面，POST请求</span></span><br><span class="line">   .failureForwardUrl(<span class="string">&quot;/toError&quot;</span>)</span><br><span class="line">    <span class="comment">//修改默认用户名和密码参数名</span></span><br><span class="line">   .usernameParameter(<span class="string">&quot;myusername&quot;</span>)</span><br><span class="line">   .passwordParameter(<span class="string">&quot;mypassword&quot;</span>)</span><br></pre></td></tr></table></figure>



<h4 id="7-3、自定义登录成功处理器"><a href="#7-3、自定义登录成功处理器" class="headerlink" title="7.3、自定义登录成功处理器"></a>7.3、自定义登录成功处理器</h4><p>使用successForwardUrl()时表示成功后转发请求到地址。内部是通过 successHandler() 方法进行控制成功后交给哪个类进行处理</p>
<p><img src="/2021/04/24/springboot/image-20210323191926000.png" alt="image-20210323191926000"></p>
<p>ForwardAuthenticationSuccessHandler内部就是最简单的请求转发。由于是请求转发，当遇到需要跳转到站外或在前后端分离的项目中就无法使用了,</p>
<p><img src="/2021/04/24/springboot/image-20210323192146396.png" alt="image-20210323192146396"></p>
<p>当需要控制登录成功后去做一些事情时，可以进行自定义认证成功控制器。</p>
<p>自定义类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyAuthenticationSuccessHandler</span> <span class="keyword">implements</span></span></span><br><span class="line"><span class="class"><span class="title">AuthenticationSuccessHandler</span> </span>&#123;</span><br><span class="line">   <span class="keyword">private</span> String url;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="title">MyAuthenticationSuccessHandler</span><span class="params">(String url)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">this</span>.url = url;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAuthenticationSuccess</span><span class="params">(HttpServletRequest request,</span></span></span><br><span class="line"><span class="function"><span class="params">      HttpServletResponse response, Authentication authentication)</span> <span class="keyword">throws</span> IOException,</span></span><br><span class="line"><span class="function">   ServletException </span>&#123;</span><br><span class="line">   <span class="comment">//Principal 主体，存放了登录用户的信息</span></span><br><span class="line">      User user = (User) authentication.getPrincipal();</span><br><span class="line">      System.out.println(user.getUsername());</span><br><span class="line">      <span class="comment">//输出null</span></span><br><span class="line">      System.out.println(user.getPassword());</span><br><span class="line">      System.out.println(user.getAuthorities());</span><br><span class="line">      response.sendRedirect(url);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>修改配置</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">/表单提交</span><br><span class="line">http.formLogin()</span><br><span class="line"><span class="comment">//自定义登录页面</span></span><br><span class="line">.loginPage(<span class="string">&quot;/login.html&quot;</span>)</span><br><span class="line"><span class="comment">//当发现/login时认为是登录，必须和表单提交的地址一样。去执行UserServiceImpl</span></span><br><span class="line">.loginProcessingUrl(<span class="string">&quot;/login&quot;</span>)</span><br><span class="line"><span class="comment">//登录成功后跳转页面，POST请求</span></span><br><span class="line"><span class="comment">// .successForwardUrl(&quot;/toMain&quot;)</span></span><br><span class="line"><span class="comment">//和successForwardUrl不能共存</span></span><br><span class="line">.successHandler(<span class="keyword">new</span></span><br><span class="line">MyAuthenticationSuccessHandler(<span class="string">&quot;/login&quot;</span>))</span><br><span class="line"><span class="comment">//登录失败后跳转页面，POST请求</span></span><br><span class="line">.failureForwardUrl(<span class="string">&quot;/toError&quot;</span>)</span><br><span class="line">.usernameParameter(<span class="string">&quot;myusername&quot;</span>)</span><br><span class="line">.passwordParameter(<span class="string">&quot;mypassword&quot;</span>);</span><br></pre></td></tr></table></figure>



<h4 id="7-4、自定义登录失败处理器"><a href="#7-4、自定义登录失败处理器" class="headerlink" title="7.4、自定义登录失败处理器"></a>7.4、自定义登录失败处理器</h4><p>failureForwardUrl()内部调用的是 failureHandler() 方法</p>
<p><img src="/2021/04/24/springboot/image-20210323193912195.png" alt="image-20210323193912195"></p>
<p>ForwardAuthenticationFailureHandler 中也是一个请求转发，并在request 作用域中设置SPRING_SECURITY_LAST_EXCEPTION 的 key，内容为异常对象。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ForwardAuthenticationFailureHandler</span> <span class="keyword">implements</span> <span class="title">AuthenticationFailureHandler</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String forwardUrl;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ForwardAuthenticationFailureHandler</span><span class="params">(String forwardUrl)</span> </span>&#123;</span><br><span class="line">        Assert.isTrue(UrlUtils.isValidRedirectUrl(forwardUrl), () -&gt; &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;&#x27;&quot;</span> + forwardUrl + <span class="string">&quot;&#x27; is not a valid forward URL&quot;</span>;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">this</span>.forwardUrl = forwardUrl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAuthenticationFailure</span><span class="params">(HttpServletRequest request, HttpServletResponse response, AuthenticationException exception)</span> <span class="keyword">throws</span> IOException, ServletException </span>&#123;</span><br><span class="line">        request.setAttribute(<span class="string">&quot;SPRING_SECURITY_LAST_EXCEPTION&quot;</span>, exception);</span><br><span class="line">        request.getRequestDispatcher(<span class="keyword">this</span>.forwardUrl).forward(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>实现</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyForwardAuthenticationFailureHandler</span> <span class="keyword">implements</span></span></span><br><span class="line"><span class="class"><span class="title">AuthenticationFailureHandler</span> </span>&#123;</span><br><span class="line">   <span class="keyword">private</span> String url;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="title">MyForwardAuthenticationFailureHandler</span><span class="params">(String url)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">this</span>.url = url;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAuthenticationFailure</span><span class="params">(HttpServletRequest request,</span></span></span><br><span class="line"><span class="function"><span class="params">   HttpServletResponse response, AuthenticationException exception)</span> <span class="keyword">throws</span></span></span><br><span class="line"><span class="function">   IOException, ServletException </span>&#123;</span><br><span class="line">      response.sendRedirect(url);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>配置</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//表单提交</span></span><br><span class="line">http.formLogin()</span><br><span class="line"><span class="comment">//自定义登录页面</span></span><br><span class="line">.loginPage(<span class="string">&quot;/login.html&quot;</span>)</span><br><span class="line"><span class="comment">//当发现/login时认为是登录，必须和表单提交的地址一样。去执行UserServiceImpl</span></span><br><span class="line">.loginProcessingUrl(<span class="string">&quot;/login&quot;</span>)</span><br><span class="line"><span class="comment">//登录成功后跳转页面，POST请求</span></span><br><span class="line"><span class="comment">// .successForwardUrl(&quot;/toMain&quot;)</span></span><br><span class="line"><span class="comment">//和successForwardUrl不能共存</span></span><br><span class="line">.successHandler(<span class="keyword">new</span></span><br><span class="line">MyAuthenticationSuccessHandler(<span class="string">&quot;http://www.baidu.com&quot;</span>))</span><br><span class="line"><span class="comment">//登录失败后跳转页面，POST请求</span></span><br><span class="line"><span class="comment">// .failureForwardUrl(&quot;/toError&quot;)</span></span><br><span class="line">.failureHandler(<span class="keyword">new</span> MyForwardAuthenticationFailureHandler(<span class="string">&quot;/error.html&quot;</span>))</span><br><span class="line">.usernameParameter(<span class="string">&quot;myusername&quot;</span>)</span><br><span class="line">.passwordParameter(<span class="string">&quot;mypassword&quot;</span>);</span><br></pre></td></tr></table></figure>



<h3 id="8、访问控制url匹配"><a href="#8、访问控制url匹配" class="headerlink" title="8、访问控制url匹配"></a>8、访问控制url匹配</h3><p>在前面认证中所有常用配置，主要是对 http.formLogin() 进行操作。而在配置类中<code>http.authorizeRequests()</code> 主要是对url进行控制，也就是我们所说的授权（访问控制）。http.authorizeRequests() 也支持链式编程</p>
<h4 id="8-1、anyRequest"><a href="#8-1、anyRequest" class="headerlink" title="8.1、anyRequest()"></a>8.1、anyRequest()</h4><p>在之前认证过程中我们就已经使用过 anyRequest()，表示匹配所有的请求。一般情况下此方法都会<br>使用，设置全部内容都需要进行认证。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.anyRequest().authenticated();</span><br></pre></td></tr></table></figure>



<h4 id="8-2、antMatcher"><a href="#8-2、antMatcher" class="headerlink" title="8.2、antMatcher()"></a>8.2、antMatcher()</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> C <span class="title">antMatchers</span><span class="params">(String... antPatterns)</span></span></span><br></pre></td></tr></table></figure>

<p>参数是不定向参数，每个参数是一个 ant 表达式，用于匹配 URL规则。</p>
<ul>
<li>? ： 匹配一个字符</li>
</ul>
<ul>
<li>* ：匹配 0 个或多个字符</li>
<li>** ：匹配 0 个或多个目录</li>
</ul>
<p>在实际项目中经常需要放行所有静态资源</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.antMatchers(<span class="string">&quot;/js/**&quot;</span>,<span class="string">&quot;/css/**&quot;</span>).permitAll()</span><br></pre></td></tr></table></figure>

<p>或</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">.antMatchers(<span class="string">&quot;/**/*.js&quot;</span>).permitAll()</span><br><span class="line">.antMatchers(<span class="string">&quot;/**/*.css&quot;</span>).permitAll()</span><br></pre></td></tr></table></figure>



<h4 id="8-3、regexMatchers"><a href="#8-3、regexMatchers" class="headerlink" title="8.3、regexMatchers()"></a>8.3、regexMatchers()</h4><p>使用正则表达式进行匹配。和 antMatchers() 主要的区别就是参数， antMatchers() 参数是 ant<br>表达式， regexMatchers() 参数是正则表达式。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.regexMatchers( <span class="string">&quot;.+[.]js&quot;</span>).permitAll()</span><br></pre></td></tr></table></figure>



<p>无论是 antMatchers() 还是 regexMatchers() 都具有两个参数的方法，其中第一个参数都是HttpMethod ，表示请求方式，当设置了 HttpMethod 后表示只有设定的特定的请求方式才执行对应的权限设置。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">enum</span> <span class="title">HttpMethod</span> </span>&#123;</span><br><span class="line">    GET, HEAD, POST, PUT, PATCH, DELETE, OPTIONS, TRACE;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Map&lt;String, HttpMethod&gt; mappings = <span class="keyword">new</span> HashMap&lt;&gt;(<span class="number">16</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (HttpMethod httpMethod : values()) &#123;</span><br><span class="line">            mappings.put(httpMethod.name(), httpMethod);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> HttpMethod <span class="title">resolve</span><span class="params">(<span class="meta">@Nullable</span> String method)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (method != <span class="keyword">null</span> ? mappings.get(method) : <span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">matches</span><span class="params">(String method)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (<span class="keyword">this</span> == resolve(method));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="8-4、mvcMatchers"><a href="#8-4、mvcMatchers" class="headerlink" title="8.4、mvcMatchers()"></a>8.4、mvcMatchers()</h4><p>mvcMatchers()适用于配置了 servletPath 的情况。</p>
<p><code>servletPath</code> 就是所有的 URL 的统一前缀。在 SpringBoot 整合SpringMVC 的项目中可以在<br>application.properties 中添加下面内容设置 ServletPath</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">spring.mvc.servlet.path</span> = <span class="string">/system</span></span><br></pre></td></tr></table></figure>

<p>在 Spring Security 的配置类中配置 .servletPath() 是 mvcMatchers()返回值特有的方法，antMatchers()和 regexMatchers()没有这个方法。在 servletPath() 中配置了 servletPath 后，mvcMatchers()直接写 SpringMVC 中@RequestMapping()中设置的路径即可。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.mvcMatchers(<span class="string">&quot;/demo&quot;</span>).servletPath(<span class="string">&quot;/xxxx&quot;</span>).permitAll()</span><br></pre></td></tr></table></figure>

<p>等价于</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.antMatchers(<span class="string">&quot;/xxxx/demo&quot;</span>).permitAll()</span><br></pre></td></tr></table></figure>

<h3 id="9、内置访问控制方法"><a href="#9、内置访问控制方法" class="headerlink" title="9、内置访问控制方法"></a>9、内置访问控制方法</h3><p>Spring Security 匹配了 URL 后调用了 permitAll() 表示不需要认证，随意访问。在 Spring Security<br>中提供了多种内置控制。</p>
<h4 id="9-1、permitAll"><a href="#9-1、permitAll" class="headerlink" title="9.1、permitAll()"></a>9.1、permitAll()</h4><p>permitAll()表示所匹配的 URL 任何人都允许访问。</p>
<h4 id="9-2、authenticated"><a href="#9-2、authenticated" class="headerlink" title="9.2、authenticated()"></a>9.2、authenticated()</h4><p>authenticated()表示所匹配的 URL 都需要被认证才能访问。</p>
<h4 id="9-3、anonymous"><a href="#9-3、anonymous" class="headerlink" title="9.3、anonymous()"></a>9.3、anonymous()</h4><p>anonymous()表示可以匿名访问匹配的URL。和permitAll()效果类似，只是设置为 anonymous()的 url会执行 filter 链中</p>
<h4 id="9-4、denyAll"><a href="#9-4、denyAll" class="headerlink" title="9.4、denyAll()"></a>9.4、denyAll()</h4><p>denyAll()表示所匹配的 URL 都不允许被访问。</p>
<h4 id="9-5、rememberMe"><a href="#9-5、rememberMe" class="headerlink" title="9.5、rememberMe()"></a>9.5、rememberMe()</h4><p>被“remember me”的用户允许访问</p>
<h4 id="9-6、fullyAuthenticated"><a href="#9-6、fullyAuthenticated" class="headerlink" title="9.6、fullyAuthenticated()"></a>9.6、fullyAuthenticated()</h4><p>如果用户不是被 remember me 的，才可以访问。</p>
<h3 id="10、角色权限判断"><a href="#10、角色权限判断" class="headerlink" title="10、角色权限判断"></a>10、角色权限判断</h3><p>Spring Security 中还支持很多其他权限控制。这些方法一般都用于用户已经被认证后，判断用户是否具有特定的要求。</p>
<h4 id="10-1、hasAuthority-String"><a href="#10-1、hasAuthority-String" class="headerlink" title="10.1、hasAuthority(String)"></a>10.1、hasAuthority(String)</h4><p>判断用户是否具有特定的权限，用户的权限是在自定义登录逻辑中创建 User 对象时指定的。下图中admin和normal 就是用户的权限。admin和normal 严格区分大小写。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.antMatchers(<span class="string">&quot;/main1.html&quot;</span>).hasAuthority(<span class="string">&quot;admin&quot;</span>)</span><br></pre></td></tr></table></figure>



<h4 id="10-2、hasAnyAuthority-String-…"><a href="#10-2、hasAnyAuthority-String-…" class="headerlink" title="10.2、hasAnyAuthority(String …)"></a>10.2、hasAnyAuthority(String …)</h4><p>如果用户具备给定权限中某一个，就允许访问。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.antMatchers(<span class="string">&quot;/main1.html&quot;</span>).hasAnyAuthority(<span class="string">&quot;adMin&quot;</span>,<span class="string">&quot;admiN&quot;</span>)</span><br></pre></td></tr></table></figure>



<h4 id="10-3、hasRole-String"><a href="#10-3、hasRole-String" class="headerlink" title="10.3、hasRole(String)"></a>10.3、hasRole(String)</h4><p>如果用户具备给定角色就允许访问。否则出现 403。</p>
<p>在给用户赋予角色时角色需要以： ROLE_开头 ，后面添加角色名称。例如：ROLE_abc 其中 abc 是角<br>色名，ROLE_是固定的字符开头。</p>
<p>使用 hasRole()时参数也只写 abc 即可。否则启动报错。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.antMatchers(<span class="string">&quot;/main1.html&quot;</span>).hasRole(<span class="string">&quot;abc&quot;</span>)</span><br></pre></td></tr></table></figure>

<h4 id="10-4、hasAnyRole-String-…"><a href="#10-4、hasAnyRole-String-…" class="headerlink" title="10.4、hasAnyRole(String …)"></a>10.4、hasAnyRole(String …)</h4><p>如果用户具备给定角色的任意一个，就允许被访问</p>
<h4 id="10-5、hasIpAddress-String"><a href="#10-5、hasIpAddress-String" class="headerlink" title="10.5、hasIpAddress(String)"></a>10.5、hasIpAddress(String)</h4><p>如果请求是指定的 IP 就运行访问。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.antMatchers(<span class="string">&quot;/main1.html&quot;</span>).hasIpAddress(<span class="string">&quot;127.0.0.1&quot;</span>)</span><br></pre></td></tr></table></figure>



<p>而在实际项目中可能都是一个异步请求，显示上述效果对于用户就不是特别友好了。Spring Security 支<br>持自定义权限受限。</p>
<h3 id="11、自定义403处理方案"><a href="#11、自定义403处理方案" class="headerlink" title="11、自定义403处理方案"></a>11、自定义403处理方案</h3><p>使用 Spring Security 时经常会看见 403（无权限），默认情况下显示的效果如下：</p>
<p><img src="/2021/04/24/springboot/image-20210323203027958.png" alt="image-20210323203027958"></p>
<p>新建类 实现 AccessDeniedHandler接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyAccessDeniedHandler</span> <span class="keyword">implements</span> <span class="title">AccessDeniedHandler</span> </span>&#123;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handle</span><span class="params">(HttpServletRequest request, HttpServletResponse response,</span></span></span><br><span class="line"><span class="function"><span class="params">AccessDeniedException accessDeniedException)</span> <span class="keyword">throws</span> IOException,</span></span><br><span class="line"><span class="function">ServletException </span>&#123;</span><br><span class="line">   response.setStatus(HttpServletResponse.SC_FORBIDDEN);</span><br><span class="line">   response.setHeader(<span class="string">&quot;Content-Type&quot;</span>, <span class="string">&quot;application/json;charset=utf-8&quot;</span>);</span><br><span class="line">   PrintWriter out = response.getWriter();</span><br><span class="line">   out.write(<span class="string">&quot;&#123;\&quot;status\&quot;:\&quot;error\&quot;,\&quot;msg\&quot;:\&quot;权限不足，请联系管理员！\&quot;&#125;&quot;</span>);</span><br><span class="line">   out.flush();</span><br><span class="line">   out.close();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>配置类中添加</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//异常处理</span></span><br><span class="line">http.exceptionHandling()</span><br><span class="line">.accessDeniedHandler(myAccessDeniedHandler);</span><br></pre></td></tr></table></figure>



<h3 id="12、基于表达式的访问控制"><a href="#12、基于表达式的访问控制" class="headerlink" title="12、基于表达式的访问控制"></a>12、基于表达式的访问控制</h3><h4 id="12-1、access"><a href="#12-1、access" class="headerlink" title="12.1、access()"></a>12.1、access()</h4><p><img src="/2021/04/24/springboot/image-20210323203610520.png" alt="image-20210323203610520"></p>
<p>可以通过 access() 实现和之前学习的权限控制完成相同的功能。</p>
<p><img src="/2021/04/24/springboot/image-20210323203651863.png" alt="image-20210323203651863"></p>
<h4 id="12-2、使用自定义方法"><a href="#12-2、使用自定义方法" class="headerlink" title="12.2、使用自定义方法"></a>12.2、使用自定义方法</h4><p><strong>新建接口和实现类</strong></p>
<p>MyService.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">MyService</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">hasPermission</span><span class="params">(HttpServletRequest request, Authentication</span></span></span><br><span class="line"><span class="function"><span class="params">authentication)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyServiceImpl</span> <span class="keyword">implements</span> <span class="title">MyService</span> </span>&#123;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hasPermission</span><span class="params">(HttpServletRequest request, Authentication</span></span></span><br><span class="line"><span class="function"><span class="params">authentication)</span> </span>&#123;</span><br><span class="line">   Object obj = authentication.getPrincipal();</span><br><span class="line">   <span class="keyword">if</span> (obj <span class="keyword">instanceof</span> UserDetails)&#123;</span><br><span class="line">      UserDetails userDetails = (UserDetails) obj;</span><br><span class="line">      Collection&lt;? extends GrantedAuthority&gt; authorities =userDetails.getAuthorities();</span><br><span class="line">      <span class="keyword">return</span> authorities.contains(newSimpleGrantedAuthority(request.getRequestURI()));</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><strong>修改配置</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//url拦截</span></span><br><span class="line">http.authorizeRequests()</span><br><span class="line"><span class="comment">//login.html不需要被认证</span></span><br><span class="line"><span class="comment">// .antMatchers(&quot;/login.html&quot;).permitAll()</span></span><br><span class="line">.antMatchers(<span class="string">&quot;/login.html&quot;</span>).access(<span class="string">&quot;permitAll&quot;</span>)</span><br><span class="line"><span class="comment">// .antMatchers(&quot;/main.html&quot;).hasRole(&quot;abc&quot;)</span></span><br><span class="line">.antMatchers(<span class="string">&quot;/main.html&quot;</span>).access(<span class="string">&quot;hasRole(&#x27;abc&#x27;)&quot;</span>)</span><br><span class="line">.anyRequest().access(<span class="string">&quot;@myServiceImpl.hasPermission(request,authentication)&quot;</span>)</span><br></pre></td></tr></table></figure>



<h3 id="13、基于注解的访问控制"><a href="#13、基于注解的访问控制" class="headerlink" title="13、基于注解的访问控制"></a>13、基于注解的访问控制</h3><p>在 Spring Security 中提供了一些访问控制的注解。这些注解都是默认是都不可用的，需要通过<br><code>@EnableGlobalMethodSecurity</code> 进行开启后使用。<br>如果设置的条件允许，程序正常执行。如果不允许会报 500</p>
<p>这些注解可以写到 Service 接口或方法上，也可以写到 Controller或 Controller 的方法上。通常情况下<br>都是写在控制器方法上的，控制接口URL是否允许被访问。</p>
<h4 id="13-1、-Secured"><a href="#13-1、-Secured" class="headerlink" title="13.1、@Secured"></a>13.1、@Secured</h4><p>@Secured 是专门用于判断是否具有角色的。能写在方法或类上。参数要以 ROLE_开头。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Secured(&quot;ROLE_abc&quot;)</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/toMain&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">toMain</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;redirect:/main.html&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="13-2、-PreAuthorize-PostAuthorize"><a href="#13-2、-PreAuthorize-PostAuthorize" class="headerlink" title="13.2、@PreAuthorize/@PostAuthorize"></a>13.2、@PreAuthorize/@PostAuthorize</h4><p>@PreAuthorize 和@PostAuthorize 都是方法或类级别注解。</p>
<ul>
<li>@PreAuthorize 表示访问方法或类在执行之前先判断权限，大多情况下都是使用这个注解，注解<br>的参数和access()方法参数取值相同，都是权限表达式。</li>
<li>@PostAuthorize 表示方法或类执行结束后判断权限，此注解很少被使用到。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 成功后跳转页面</span></span><br><span class="line"><span class="comment">* <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@PreAuthorize(&quot;hasRole(&#x27;ROLE_abc&#x27;)&quot;)</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/toMain&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">toMain</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;redirect:/main.html&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="14、RememberMe功能实现"><a href="#14、RememberMe功能实现" class="headerlink" title="14、RememberMe功能实现"></a>14、RememberMe功能实现</h3><p>Spring Security 中 Remember Me 为“记住我”功能，用户只需要在登录时添加 remember-me复选<br>框，取值为true。Spring Security 会自动把用户信息存储到数据源中，以后就可以不登录进行访问</p>
<p>Spring Security 实 现 Remember Me 功 能 时 底 层 实 现 依 赖Spring-JDBC，所以需要导入 Spring-<br>JDBC。以后多使用 MyBatis 框架而很少直接导入 spring-jdbc，所以此处导入 mybatis 启动器同时还需<br>要添加 MySQL 驱动</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- mybatis 依赖 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- mysql 数据库依赖 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>8.0.18<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>配置数据源</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">spring.datasource.driver-class-name</span>= <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line"><span class="meta">spring.datasource.url</span>= <span class="string">jdbc:mysql://localhost:3306/security?</span></span><br><span class="line"><span class="attr">useUnicode</span>=<span class="string">true&amp;characterEncoding=UTF-8&amp;serverTimezone=Asia/Shanghai</span></span><br><span class="line"><span class="meta">spring.datasource.username</span>= <span class="string">root</span></span><br><span class="line"><span class="meta">spring.datasource.password</span>= <span class="string">root</span></span><br></pre></td></tr></table></figure>



<p>编写配置</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RememberMeConfig</span> </span>&#123;</span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> DataSource dataSource;</span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> PersistentTokenRepository <span class="title">getPersistentTokenRepository</span><span class="params">()</span></span>&#123;</span><br><span class="line">JdbcTokenRepositoryImpl jdbcTokenRepository = <span class="keyword">new</span></span><br><span class="line">JdbcTokenRepositoryImpl();</span><br><span class="line">jdbcTokenRepository.setDataSource(dataSource);</span><br><span class="line"><span class="comment">//自动建表，第一次启动时需要，第二次启动时注释掉</span></span><br><span class="line">jdbcTokenRepository.setCreateTableOnStartup(<span class="keyword">true</span>);</span><br><span class="line"><span class="keyword">return</span> jdbcTokenRepository;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>==注意== : <code>jdbcTokenRepository.setCreateTableOnStartup(true);</code> :自动建表，第一次启动时需要，第二次启动时注释掉</p>
<p>修改SecurityConfig.java</p>
<p>在 configure 中添加下面配置内容。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">http.rememberMe()</span><br><span class="line">    <span class="comment">//失效时间，单位秒</span></span><br><span class="line">   .tokenValiditySeconds(<span class="number">120</span>)</span><br><span class="line">    <span class="comment">//登录逻辑交给哪个对象</span></span><br><span class="line">    .userDetailsService(userService)</span><br><span class="line">    <span class="comment">// 持久层对象</span></span><br><span class="line">    .tokenRepository(persistentTokenRepository);</span><br></pre></td></tr></table></figure>



<h3 id="15、Thymeleaf中SpringSecurity的使用"><a href="#15、Thymeleaf中SpringSecurity的使用" class="headerlink" title="15、Thymeleaf中SpringSecurity的使用"></a>15、Thymeleaf中SpringSecurity的使用</h3><p>Spring Security 可以在一些视图技术中进行控制显示效果。例如： JSP 或 Thymeleaf 。在非前后端分离且使用 Spring Boot 的项目中多使用 Thymeleaf 作为视图展示技术。</p>
<p>Thymeleaf 对 Spring Security 的 支 持 都 放 在 thymeleaf-extras-springsecurityX 中，目前最新版本为 5。所以需要在项目中添加此 jar 包的依赖和 thymeleaf 的依赖。。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--thymeleaf springsecurity5 依赖--&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.thymeleaf.extras&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;thymeleaf-extras-springsecurity5&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;!--thymeleaf依赖--&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-thymeleaf&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<p>在 html 页面中引入 thymeleaf 命名空间和 security 命名空间</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;html xmlns=<span class="string">&quot;http://www.w3.org/1999/xhtml&quot;</span></span><br><span class="line">xmlns:th=<span class="string">&quot;http://www.thymeleaf.org&quot;</span></span><br><span class="line">xmlns:sec=<span class="string">&quot;http://www.thymeleaf.org/thymeleaf-extras-springsecurity5&quot;</span>&gt;</span><br></pre></td></tr></table></figure>



<p><strong>获取属性</strong></p>
<p>可以在html页面中通过 sec:authentication=”” 获取UsernamePasswordAuthenticationToken 中所有 getXXX 的内容，包含父类中的 getXXX 的内容。</p>
<p>根据源码得出下面属性：</p>
<ul>
<li><p>name ：登录账号名称</p>
</li>
<li><p>principal ：登录主体，在自定义登录逻辑中是 UserDetails</p>
</li>
<li><p>credentials ：凭证</p>
</li>
<li><p>authorities ：权限和角色</p>
</li>
<li><p>details ：实际上是 WebAuthenticationDetails 的实例。可以获取 remoteAddress (客户端ip)和 sessionId (当前 sessionId)</p>
</li>
</ul>
<p>新建demo.html<br>在项目 resources 中新建 templates 文件夹，在 templates 中新建demo.html 页面</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.w3.org/1999/xhtml&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">xmlns:sec</span>=<span class="string">&quot;http://www.thymeleaf.org/thymeleaf-extras-springsecurity5&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    登录账号:<span class="tag">&lt;<span class="name">span</span> <span class="attr">sec:authentication</span>=<span class="string">&quot;name&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">    登录账号:<span class="tag">&lt;<span class="name">span</span> <span class="attr">sec:authentication</span>=<span class="string">&quot;principal.username&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">    凭证：<span class="tag">&lt;<span class="name">span</span> <span class="attr">sec:authentication</span>=<span class="string">&quot;credentials&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">    权限和角色：<span class="tag">&lt;<span class="name">span</span> <span class="attr">sec:authentication</span>=<span class="string">&quot;authorities&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">    客户端地址：<span class="tag">&lt;<span class="name">span</span> <span class="attr">sec:authentication</span>=<span class="string">&quot;details.remoteAddress&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">    sessionId：<span class="tag">&lt;<span class="name">span</span> <span class="attr">sec:authentication</span>=<span class="string">&quot;details.sessionId&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>





<p><strong>权限判断</strong></p>
<p>设置用户角色和权限</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> User(username,password,</span><br><span class="line">AuthorityUtils.commaSeparatedStringToAuthorityList(<span class="string">&quot;admin,ROLE_abc,/insert,/dele</span></span><br><span class="line"><span class="string">te&quot;</span>));</span><br></pre></td></tr></table></figure>



<p>控制页面显示效果</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">通过权限判断：</span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">sec:authorize</span>=<span class="string">&quot;hasAuthority(&#x27;/insert&#x27;)&quot;</span>&gt;</span>新增<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">sec:authorize</span>=<span class="string">&quot;hasAuthority(&#x27;/delete&#x27;)&quot;</span>&gt;</span>删除<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">sec:authorize</span>=<span class="string">&quot;hasAuthority(&#x27;/update&#x27;)&quot;</span>&gt;</span>修改<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">sec:authorize</span>=<span class="string">&quot;hasAuthority(&#x27;/select&#x27;)&quot;</span>&gt;</span>查看<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">通过角色判断：</span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">sec:authorize</span>=<span class="string">&quot;hasRole(&#x27;abc&#x27;)&quot;</span>&gt;</span>新增<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">sec:authorize</span>=<span class="string">&quot;hasRole(&#x27;abc&#x27;)&quot;</span>&gt;</span>删除<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">sec:authorize</span>=<span class="string">&quot;hasRole(&#x27;abc&#x27;)&quot;</span>&gt;</span>修改<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">sec:authorize</span>=<span class="string">&quot;hasRole(&#x27;abc&#x27;)&quot;</span>&gt;</span>查看<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h3 id="16、退出登录"><a href="#16、退出登录" class="headerlink" title="16、退出登录"></a>16、退出登录</h3><p>用户只需要向 Spring Security 项目中发送 /logout 退出请求即可</p>
<p>进入我们自定义的界面</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http.logout()</span><br><span class="line">.logoutUrl(<span class="string">&quot;/logout&quot;</span>)</span><br><span class="line">.logoutSuccessUrl(<span class="string">&quot;/login.html&quot;</span>);</span><br></pre></td></tr></table></figure>



<p><strong>logout其他常用配置源码解读</strong></p>
<p><strong>addLogoutHandler(LogoutHandler)</strong></p>
<p>默认是 contextLogoutHandler</p>
<p><img src="/2021/04/24/springboot/image-20210323210046313.png" alt="image-20210323210046313"></p>
<p>默认实例内容</p>
<p><img src="/2021/04/24/springboot/image-20210323210102015.png" alt="image-20210323210102015"></p>
<p><strong>clearAuthentication(boolean)</strong></p>
<p>是否清除认证状态，默认为 true</p>
<p><img src="/2021/04/24/springboot/image-20210323210134932.png" alt="image-20210323210134932"></p>
<p>是否销毁 HttpSession 对象，默认为 true</p>
<p><img src="/2021/04/24/springboot/image-20210323210143957.png" alt="image-20210323210143957"></p>
<p><strong>logoutSuccessHandler(LogoutSuccessHandler)</strong></p>
<p>退出成功处理器</p>
<p><img src="/2021/04/24/springboot/image-20210323210207545.png" alt="image-20210323210207545"></p>
<p>也可以自己进行定义退出成功处理器。只要实现了<code> LogoutSuccessHandler</code> 接口。与之前讲解的登录<br>成功处理器和登录失败处理器极其类似。</p>
<h3 id="17、SpringSecurity中的CSRF"><a href="#17、SpringSecurity中的CSRF" class="headerlink" title="17、SpringSecurity中的CSRF"></a>17、SpringSecurity中的CSRF</h3><h4 id="17-1、什么是CSRF？"><a href="#17-1、什么是CSRF？" class="headerlink" title="17.1、什么是CSRF？"></a>17.1、什么是CSRF？</h4><p>CSRF（Cross-site request forgery）跨站请求伪造，也被称为“OneClick Attack” 或者 SessionRiding。通过伪造用户请求访问受信任站点的非法请求访问。</p>
<p>跨域：只要网络协议，ip 地址，端口中任何一个不相同就是跨域请求。</p>
<p>客户端与服务进行交互时，由于 http 协议本身是无状态协议，所以引入了cookie进行记录客户端身份。在cookie中会存放session id用来识别客户端身份的。在跨域的情况下，session id 可能被第三方恶意劫持，通过这个 session id 向服务端发起请求时，服务端会认为这个请求是合法的，可能发生很多意想不到的事情。</p>
<h4 id="17-2、Spring-Security中的CSRF"><a href="#17-2、Spring-Security中的CSRF" class="headerlink" title="17.2、Spring Security中的CSRF"></a>17.2、Spring Security中的CSRF</h4><p>从 Spring Security4开始<strong>CSRF防护默认开启</strong>。默认会拦截请求。进行CSRF处理。CSRF为了保证不是其他第三方网站访问，要求访问时携带参数名为 _csrf 值为token(token 在服务端产生)的内容，如果token和服务端的token匹配成功，则正常访问。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.w3.org/1999/xhtml&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">xmlns:th</span>=<span class="string">&quot;http://www.thymeleaf.org&quot;</span></span></span><br><span class="line"><span class="tag">&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;/login&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">th:value</span>=<span class="string">&quot;$&#123;_csrf.token&#125;&quot;</span> <span class="attr">name</span>=<span class="string">&quot;_csrf&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">th:if</span>=<span class="string">&quot;$&#123;_csrf&#125;&quot;</span>/&gt;</span></span><br><span class="line">        用户名：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">        密码：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;登录&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h3 id="18、Oauth2认证"><a href="#18、Oauth2认证" class="headerlink" title="18、Oauth2认证"></a>18、Oauth2认证</h3><p>OAUTH协议为用户资源的授权提供了一个安全的、开放而又简易的标准。同时，任何第三方都可以使用OAUTH认证服务，任何服务提供商都可以实现自身的OAUTH认证服务，因而OAUTH是开放的。业界提供了OAUTH的多种实现如PHP、JavaScript，Java，Ruby等各种语言开发包，大大节约了程序员的时间，因而OAUTH是简易的。互联网很多服务如Open API，很多大公司如Google，Yahoo，Microsoft等都提供了OAUTH认证服务，这些都足以说OAUTH标准逐渐成为开放资源授权的标准。</p>
<p>一个Oauth2认证的例子，网站使用微信认证的过程：</p>
<p><img src="/2021/04/24/springboot/image-20210324152234115.png" alt="image-20210324152234115"></p>
<ol>
<li>用户进入网站的登录页面，点击微信的图标以微信账号登录系统，用户是自己在微信里信息的资源<br>拥有者</li>
</ol>
<p>点击“微信”出现一个二维码，此时用户扫描二维码，开始给网站授权。</p>
<ol start="2">
<li>资源拥有者同意给客户端授权</li>
</ol>
<p>资源拥有者扫描二维码表示资源拥有者同意给客户端授权，微信会对资源拥有者的身份进行验证，验<br>证通过后，微信会询问用户是否给授权网站访问自己的微信数据，用户点击“确认登录”表示同意授权，<br>微信认证服务器会颁发一个授权码，并重定向到网站。</p>
<ol start="3">
<li><p>客户端获取到授权码，请求认证服务器申请令牌<br>此过程用户看不到，客户端应用程序请求认证服务器，请求携带授权码。</p>
</li>
<li><p>认证服务器向客户端响应令牌<br>认证服务器验证了客户端请求的授权码，如果合法则给客户端颁发令牌，令牌是客户端访问资源的通<br>行证。此交互过程用户看不到，当客户端拿到令牌后，用户在网站看到已经登录成功。</p>
</li>
<li><p>客户端请求资源服务器的资源<br>客户端携带令牌访问资源服务器的资源。网站携带令牌请求访问微信服务器获取用户的基本信息。</p>
</li>
<li><p>资源服务器返回受保护资源<br>资源服务器校验令牌的合法性，如果合法则向用户响应资源信息内容。</p>
</li>
</ol>
<p>注意：资源服务器和认证服务器可以是一个服务也可以分开的服务，如果是分开的服务资源服务器通常<br>要请求认证服务器来校验令牌的合法性。</p>
<p><img src="/2021/04/24/springboot/image-20210324152635216.png" alt="image-20210324152635216"></p>
<p><strong>客户端</strong><br>本身不存储资源，需要通过资源拥有者的授权去请求资源服务器的资源，比如：Android客户端、Web<br>客户端（浏览器端）、微信客户端等。<br><strong>资源拥有者</strong><br>通常为用户，也可以是应用程序，即该资源的拥有者。<br><strong>授权服务器（也称认证服务器）</strong><br>用来对资源拥有的身份进行认证、对访问资源进行授权。客户端要想访问资源需要通过认证服务器由资<br>源拥有者授权后方可访问。<br><strong>资源服务器</strong><br>存储资源的服务器，比如，网站用户管理服务器存储了网站用户信息，网站相册服务器存储了用户的相<br>册信息，微信的资源服务存储了微信的用户信息等。客户端最终访问资源服务器获取资源信息。</p>
<p><strong>术语</strong></p>
<p>客户凭证(client Credentials) ：客户端的clientId和密码用于认证客户<br>令牌(tokens) ：授权服务器在接收到客户请求后，颁发的访问令牌<br>作用域(scopes) ：客户请求访问令牌时，由资源拥有者额外指定的细分权限(permission)</p>
<p><strong>令牌类型</strong><br>授权码 ：仅用于授权码授权类型，用于交换获取访问令牌和刷新令牌<br>访问令牌 ：用于代表一个用户或服务直接去访问受保护的资源<br>刷新令牌 ：用于去授权服务器获取一个刷新访问令牌<br>BearerToken ：不管谁拿到Token都可以访问资源，类似现金<br>Proof of Possession(PoP) Token ：可以校验client是否对Token有明确的拥有权</p>
<h3 id="19、Spring-Security-Oauth2"><a href="#19、Spring-Security-Oauth2" class="headerlink" title="19、Spring Security Oauth2"></a>19、Spring Security Oauth2</h3><p><img src="/2021/04/24/springboot/image-20210324180046998.png" alt="image-20210324180046998"></p>
<p>Authorize Endpoint ：授权端点，进行授权<br>Token Endpoint ：令牌端点，经过授权拿到对应的Token<br>Introspection Endpoint ：校验端点，校验Token的合法性<br>Revocation Endpoint ：撤销端点，撤销授权</p>
<p><strong>Spring Security Oauth2架构</strong></p>
<p><img src="/2021/04/24/springboot/image-20210324180921998.png" alt="image-20210324180921998"></p>
<ol>
<li>用户访问,此时没有Token。Oauth2RestTemplate会报错，这个报错信息会被<br>Oauth2ClientContextFilter捕获并重定向到认证服务器</li>
<li>认证服务器通过Authorization Endpoint进行授权，并通过AuthorizationServerTokenServices生<br>成授权码并返回给客户端</li>
<li>客户端拿到授权码去认证服务器通过Token Endpoint调用AuthorizationServerTokenServices生<br>成Token并返回给客户端</li>
<li>客户端拿到Token去资源服务器访问资源，一般会通过Oauth2AuthenticationManager调用<br>ResourceServerTokenServices进行校验。校验通过可以获取资源。</li>
</ol>
<h4 id="使用-授权模式"><a href="#使用-授权模式" class="headerlink" title="使用 授权模式"></a>使用 授权模式</h4><p>导入依赖 (导入spring-cloud的依赖使用时比较简单一些)</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-oauth2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-security<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>配置类 SecurityConfig 需要继承 WebSecurityConfigurerAdapter</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableWebSecurity</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SecurityConfig</span> <span class="keyword">extends</span> <span class="title">WebSecurityConfigurerAdapter</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> PasswordEncoder <span class="title">passwordEncoder</span><span class="params">()</span> </span>&#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="keyword">new</span> BCryptPasswordEncoder();</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        http.csrf()</span><br><span class="line">        .disable()</span><br><span class="line">        .authorizeRequests()</span><br><span class="line">        .antMatchers(<span class="string">&quot;/oauth/**&quot;</span>, <span class="string">&quot;/login/**&quot;</span>, <span class="string">&quot;/logout/**&quot;</span>)</span><br><span class="line">        .permitAll()</span><br><span class="line">        .anyRequest()</span><br><span class="line">        .authenticated()</span><br><span class="line">        .and()</span><br><span class="line">        .formLogin()</span><br><span class="line">        .permitAll();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>



<p>编写UserDetailsService接口的实现类，通过loadUserByUsername方法处理登录逻辑</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserService</span> <span class="keyword">implements</span> <span class="title">UserDetailsService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> PasswordEncoder passwordEncoder;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> UserDetails <span class="title">loadUserByUsername</span><span class="params">(String username)</span> <span class="keyword">throws</span></span></span><br><span class="line"><span class="function">        UsernameNotFoundException </span>&#123;</span><br><span class="line">        String password = passwordEncoder.encode(<span class="string">&quot;123456&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> User(<span class="string">&quot;admin&quot;</span>,password,</span><br><span class="line">          AuthorityUtils.commaSeparatedStringToAuthorityList(<span class="string">&quot;admin&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以实现UserDetails接口定义我们自己的登录用户类</p>
<p>授权服务器配置 AuthorizationServerConfig.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableAuthorizationServer</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AuthorizationServerConfig</span> <span class="keyword">extends</span> <span class="title">AuthorizationServerConfigurerAdapter</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> PasswordEncoder passwordEncoder;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(ClientDetailsServiceConfigurer clients)</span> <span class="keyword">throws</span></span></span><br><span class="line"><span class="function">    Exception </span>&#123;</span><br><span class="line">        clients.inMemory()</span><br><span class="line">        <span class="comment">//配置client_id</span></span><br><span class="line">        .withClient(<span class="string">&quot;admin&quot;</span>)</span><br><span class="line">        <span class="comment">//配置client-secret</span></span><br><span class="line">        .secret(passwordEncoder.encode(<span class="string">&quot;112233&quot;</span>))</span><br><span class="line">        <span class="comment">//配置访问token的有效期</span></span><br><span class="line">        .accessTokenValiditySeconds(<span class="number">3600</span>)</span><br><span class="line">        <span class="comment">//配置刷新token的有效期</span></span><br><span class="line">        .refreshTokenValiditySeconds(<span class="number">864000</span>)</span><br><span class="line">        <span class="comment">//配置redirect_uri，用于授权成功后跳转</span></span><br><span class="line">        .redirectUris(<span class="string">&quot;http://www.baidu.com&quot;</span>)</span><br><span class="line">        <span class="comment">//配置申请的权限范围</span></span><br><span class="line">        .scopes(<span class="string">&quot;all&quot;</span>)</span><br><span class="line">        <span class="comment">//配置grant_type，表示授权类型</span></span><br><span class="line">        .authorizedGrantTypes(<span class="string">&quot;authorization_code&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>资源服务器配置 ResourceServerConfig.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableResourceServer</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ResourceServerConfig</span> <span class="keyword">extends</span> <span class="title">ResourceServerConfigurerAdapter</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        http.authorizeRequests()</span><br><span class="line">        .anyRequest()</span><br><span class="line">        .authenticated()</span><br><span class="line">        .and()</span><br><span class="line">        .requestMatchers()</span><br><span class="line">        .antMatchers(<span class="string">&quot;/user/**&quot;</span>);<span class="comment">//配置需要保护的资源路径</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<p>编写Controller</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@GetMapping(&quot;/getCurrentUser&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">getCurrentUser</span><span class="params">(Authentication authentication)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">return</span> authentication.getPrincipal();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>测试：</p>
<p>获取授权码</p>
<p><a target="_blank" rel="noopener" href="http://localhost:8080/oauth/authorize?response_type=code&amp;client_id=client&amp;redirect_uri=http://www.baidu.com&amp;scope=all">http://localhost:8080/oauth/authorize?response_type=code&amp;client_id=client&amp;redirect_uri=http://www.baidu.com&amp;scope=all</a></p>
<p><img src="/2021/04/24/springboot/image-20210324184930095.png" alt="image-20210324184930095"></p>
<p>输入账户密码 ：—》 进入授权页面</p>
<p><img src="/2021/04/24/springboot/image-20210324185014808.png" alt="image-20210324185014808"></p>
<p>点击授权获取授权码 xNx1zB</p>
<p><img src="/2021/04/24/springboot/image-20210324185041935.png" alt="image-20210324185041935"></p>
<p>根据授权码获取令牌（POST请求）</p>
<p><img src="/2021/04/24/springboot/image-20210324185135154.png" alt="image-20210324185135154"></p>
<p><img src="/2021/04/24/springboot/image-20210324185224371.png" alt="image-20210324185224371"></p>
<p><code>grant_type </code>：授权类型，填写authorization_code，表示授权码模式<br><code>code </code>：授权码，就是刚刚获取的授权码，注意：授权码只使用一次就无效了，需要重新申请。<br><code>client_id </code>:客户端标识<br><code>redirect_uri </code>：申请授权码时的跳转url，一定和申请授权码时用的redirect_uri一致。<br><code>scope </code>:授权范围。</p>
<p>认证失败服务端返回 401 Unauthorized<br>注意：此时无法请求到令牌，访问服务器会报错</p>
<p><img src="/2021/04/24/springboot/image-20210324185406754.png" alt="image-20210324185406754"></p>
<p>根据token去资源服务器拿资源</p>
<p><img src="/2021/04/24/springboot/image-20210324185423207.png" alt="image-20210324185423207"></p>
<h4 id="Spring-Security-Oauth2-密码模式"><a href="#Spring-Security-Oauth2-密码模式" class="headerlink" title="Spring Security Oauth2 密码模式"></a>Spring Security Oauth2 密码模式</h4><p>SecurityConfig中添加 AuthenticationManager</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> AuthenticationManager <span class="title">authenticationManagerBean</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">   <span class="keyword">return</span> <span class="keyword">super</span>.authenticationManagerBean();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>AuthorizationServerConfig.java中重写该方法，并添加授权类型</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 使用密码模式需要配置</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(AuthorizationServerEndpointsConfigurer endpoints)</span> </span>&#123;</span><br><span class="line">    endpoints.authenticationManager(authenticationManager)</span><br><span class="line">          .userDetailsService(userService);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(ClientDetailsServiceConfigurer clients)</span> <span class="keyword">throws</span></span></span><br><span class="line"><span class="function">Exception </span>&#123;</span><br><span class="line">        clients.inMemory()</span><br><span class="line">            <span class="comment">//配置client_id</span></span><br><span class="line">            .withClient(<span class="string">&quot;admin&quot;</span>)</span><br><span class="line">            <span class="comment">//配置client-secret</span></span><br><span class="line">            .secret(passwordEncoder.encode(<span class="string">&quot;112233&quot;</span>))</span><br><span class="line">            <span class="comment">//配置访问token的有效期</span></span><br><span class="line">            .accessTokenValiditySeconds(<span class="number">3600</span>)</span><br><span class="line">            <span class="comment">//配置刷新token的有效期</span></span><br><span class="line">            .refreshTokenValiditySeconds(<span class="number">864000</span>)</span><br><span class="line">            <span class="comment">//配置redirect_uri，用于授权成功后跳转</span></span><br><span class="line">            .redirectUris(<span class="string">&quot;http://www.baidu.com&quot;</span>)</span><br><span class="line">            <span class="comment">//配置申请的权限范围</span></span><br><span class="line">            .scopes(<span class="string">&quot;all&quot;</span>)</span><br><span class="line">            <span class="comment">//配置grant_type，表示授权类型</span></span><br><span class="line">            .authorizedGrantTypes(<span class="string">&quot;authorization_code&quot;</span>,<span class="string">&quot;password&quot;</span>);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h4 id="redis中存储token"><a href="#redis中存储token" class="headerlink" title="redis中存储token"></a>redis中存储token</h4><p>导入依赖</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--redis 依赖--&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-data-redis&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;!-- commons-pool2 对象池依赖 --&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.apache.commons&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;commons-pool2&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>



<p>redisConfig</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RedisConfig</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisConnectionFactory redisConnectionFactory;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> TokenStore <span class="title">redisTokenStore</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> RedisTokenStore(redisConnectionFactory);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在认证服务器配置中指定令牌的存储策略为Redis</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 使用密码模式需要配置</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(AuthorizationServerEndpointsConfigurer endpoints)</span> </span>&#123;</span><br><span class="line">endpoints.authenticationManager(authenticationManager)</span><br><span class="line">.userDetailsService(userService)</span><br><span class="line">.tokenStore(tokenStore);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h3 id="20、JWT"><a href="#20、JWT" class="headerlink" title="20、JWT"></a>20、JWT</h3><h4 id="常见的认证机制"><a href="#常见的认证机制" class="headerlink" title="常见的认证机制"></a>常见的认证机制</h4><p><strong>HTTP Basic Auth</strong></p>
<p>HTTP Basic Auth简单点说明就是每次请求API时都提供用户的username和password，简言之，Basic Auth是配合RESTful API 使用的最简单的认证方式，只需提供用户名密码即可，但由于有把用户名密码暴露给第三方客户端的风险，在生产环境下被使用的越来越少。因此，在开发对外开放的RESTful API时，尽量避免采用HTTP Basic Auth。</p>
<p><strong>Cookie Auth</strong></p>
<p>Cookie认证机制就是为一次请求认证在服务端创建一个Session对象，同时在客户端的浏览器端创建了一个Cookie对象；通过客户端带上来Cookie对象来与服务器端的session对象匹配来实现状态管理的。默认的，当我们关闭浏览器的时候，cookie会被删除。但可以通过修改cookie 的expire time使cookie在一定时间内有效。</p>
<p><img src="/2021/04/24/springboot/image-20210324190705873.png" alt="image-20210324190705873"></p>
<p><strong>OAuth</strong></p>
<p><img src="/2021/04/24/springboot/image-20210324190853144.png" alt="image-20210324190853144"></p>
<p>基于OAuth的认证机制适用于个人消费者类的互联网产品，如社交类APP等应用，但是不太适合<br>拥有自有认证权限管理的企业应用。</p>
<p><strong>Token Auth</strong></p>
<p>使用基于 Token 的身份验证方法，在服务端不需要存储用户的登录记录。大概的流程是这样的：</p>
<ol>
<li>客户端使用用户名跟密码请求登录</li>
<li>服务端收到请求，去验证用户名与密码</li>
<li>验证成功后，服务端会签发一个 Token，再把这个 Token 发送给客户端</li>
<li>客户端收到 Token 以后可以把它存储起来，比如放在 Cookie 里</li>
<li>客户端每次向服务端请求资源的时候需要带着服务端签发的 Token</li>
<li>服务端收到请求，然后去验证客户端请求里面带着的 Token，如果验证成功，就向客户端返回请<br>求的数据</li>
</ol>
<p>比第一种方式更安全，比第二种方式更节约服务器资源，比第三种方式更加轻量。<br>具体，Token Auth的优点（Token机制相对于Cookie机制又有什么好处呢？）：</p>
<ol>
<li>支持跨域访问: Cookie是不允许垮域访问的，这一点对Token机制是不存在的，前提是传输的用户<br>认证信息通过HTTP头传输.</li>
<li>无状态(也称：服务端可扩展行):Token机制在服务端不需要存储session信息，因为Token 自身包<br>含了所有登录用户的信息，只需要在客户端的cookie或本地介质存储状态信息.</li>
<li>更适用CDN: 可以通过内容分发网络请求你服务端的所有资料（如：javascript，HTML,图片<br>等），而你的服务端只要提供API即可.</li>
<li>去耦: 不需要绑定到一个特定的身份验证方案。Token可以在任何地方生成，只要在你的API被调用<br>的时候，你可以进行Token生成调用即可.</li>
<li>更适用于移动应用: 当你的客户端是一个原生平台（iOS, Android，Windows 10等）时，Cookie<br>是不被支持的（你需要通过Cookie容器进行处理），这时采用Token认证机制就会简单得多。</li>
<li>CSRF:因为不再依赖于Cookie，所以你就不需要考虑对CSRF（跨站请求伪造）的防范。</li>
<li>性能: 一次网络往返时间（通过数据库查询session信息）总比做一次HMACSHA256计算的Token<br>验证和解析要费时得多.</li>
<li>不需要为登录页面做特殊处理: 如果你使用Protractor 做功能测试的时候，不再需要为登录页面做<br>特殊处理.</li>
<li>基于标准化:你的API可以采用标准化的 JSON Web Token (JWT). 这个标准已经存在多个后端库<br>（.NET, Ruby, Java,Python, PHP）和多家公司的支持（如：Firebase,Google, Microsoft）.</li>
</ol>
<h4 id="JWT简介"><a href="#JWT简介" class="headerlink" title="JWT简介"></a>JWT简介</h4><p>JSON Web Token（JWT）是一个开放的行业标准（RFC 7519），它定义了一种简介的、自包含的协<br>议格式，用于在通信双方传递json对象，传递的信息经过数字签名可以被验证和信任。JWT可以使用<br>HMAC算法或使用RSA的公钥/私钥对来签名，防止被篡改。</p>
<p>官网： <a target="_blank" rel="noopener" href="https://jwt.io/">https://jwt.io/</a></p>
<p>JWT 优点：</p>
<ol>
<li><p>jwt基于json，非常方便解析。</p>
</li>
<li><p>可以在令牌中自定义丰富的内容，易扩展。</p>
</li>
<li><p>通过非对称加密算法及数字签名技术，JWT防止篡改，安全性高。</p>
</li>
<li><p>资源服务使用JWT可不依赖认证服务即可完成授权。</p>
</li>
</ol>
<p>缺点：</p>
<ol>
<li>JWT令牌较长，占存储空间比较大。</li>
</ol>
<h4 id="组成"><a href="#组成" class="headerlink" title="组成"></a>组成</h4><p>由三部分组成头部、负载与签名</p>
<p><strong>头部</strong>：用于描述关于该JWT的最基本的信息，例如其类型（即JWT）以及签名所用的算法（如HMAC<br>SHA256或RSA）等。 使用Base64编码</p>
<p><strong>负载</strong>：存放有效信息。</p>
<p>分为三个部分</p>
<ul>
<li><p>标准中注册的声明（建议但不强制使用）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">iss: jwt签发者</span><br><span class="line">sub: jwt所面向的用户</span><br><span class="line">aud: 接收jwt的一方</span><br><span class="line">exp: jwt的过期时间，这个过期时间必须要大于签发时间</span><br><span class="line">nbf: 定义在什么时间之前，该jwt都是不可用的.</span><br><span class="line">iat: jwt的签发时间</span><br><span class="line">jti: jwt的唯一身份标识，主要用来作为一次性token,从而回避重放攻击</span><br></pre></td></tr></table></figure></li>
</ul>
<ul>
<li><p>公共的声明：可以添加任何的信息，一般添加用户的相关信息或其他业务需要的必要信息.</p>
</li>
<li><p>私有的声明  ：提供者和消费者所共同定义的声明，不建议存放敏感信息，Base64编码是对称解密的</p>
</li>
</ul>
<p><strong>签名</strong>：一个签证信息，这个签证信息由三部分组成：</p>
<ol>
<li>header (base64后的)</li>
<li>payload (base64后的)</li>
<li>secret（盐，一定要保密）</li>
</ol>
<p>这个部分需要base64加密后的header和base64加密后的payload使用.连接组成的字符串，然后通过<br>header中声明的加密方式进行加盐secret组合加密，然后就构成了jwt的第三部分</p>
<h4 id="使用-1"><a href="#使用-1" class="headerlink" title="使用"></a>使用</h4><p>导入依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.jsonwebtoken<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jjwt<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.9.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>测试使用</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testCreatToken</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">//创建一个JwtBuilder对象</span></span><br><span class="line">    JwtBuilder jwtBuilder = Jwts.builder()</span><br><span class="line">        <span class="comment">//声明的标识&#123;&quot;jti&quot;:&quot;8848&quot;&#125;</span></span><br><span class="line">        .setId(<span class="string">&quot;8848&quot;</span>)</span><br><span class="line">        <span class="comment">//主体，用户&#123;&quot;sub&quot;:&quot;gailun&quot;&#125;</span></span><br><span class="line">        .setSubject(<span class="string">&quot;gailun&quot;</span>)</span><br><span class="line">        <span class="comment">//创建日期&#123;&quot;ita&quot;:&quot;xxxxxx&quot;&#125;</span></span><br><span class="line">        .setIssuedAt(<span class="keyword">new</span> Date())</span><br><span class="line">        <span class="comment">//签名手段，参数1：算法，参数2：盐</span></span><br><span class="line">        .signWith(SignatureAlgorithm.HS256,<span class="string">&quot;xxxx&quot;</span>)</span><br><span class="line">        <span class="comment">//设置过期时间</span></span><br><span class="line">        .setExpiration(<span class="keyword">new</span> Date(exp));</span><br><span class="line">       <span class="comment">// 自定义claim</span></span><br><span class="line">      .claim(<span class="string">&quot;roles&quot;</span>,<span class="string">&quot;admin&quot;</span>)</span><br><span class="line">      .claim(<span class="string">&quot;logo&quot;</span>,<span class="string">&quot;shsxt.jpg&quot;</span>)</span><br><span class="line">        <span class="comment">//获取jwt的token</span></span><br><span class="line">        String token = jwtBuilder.compact();</span><br><span class="line">        System.out.println(token);</span><br><span class="line">        <span class="comment">//三部分的base64解密</span></span><br><span class="line">        System.out.println(<span class="string">&quot;--------------------&quot;</span>);</span><br><span class="line">        String[] split = token.split(<span class="string">&quot;\\.&quot;</span>);</span><br><span class="line">        System.out.println(Base64Codec.BASE64.decodeToString(split[<span class="number">0</span>]));</span><br><span class="line">        System.out.println(Base64Codec.BASE64.decodeToString(split[<span class="number">1</span>]));</span><br><span class="line">        <span class="comment">//无法解密</span></span><br><span class="line">        System.out.println(Base64Codec.BASE64.decodeToString(split[<span class="number">2</span>]));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>验证JWT</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testParseToken</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="comment">//token</span></span><br><span class="line">String token =</span><br><span class="line"><span class="string">&quot;eyJhbGciOiJIUzI1NiJ9.eyJqdGkiOiI4ODgiLCJzdWIiOiJSb3NlIiwiaWF0IjoxNTc4ODE0MjUyfQ&quot;</span> +</span><br><span class="line"><span class="string">&quot;.-FYFMHyfTcGzq900f_Drfdsges0ge2UjaWvPW9gCDto&quot;</span>;</span><br><span class="line"><span class="comment">//解析token获取负载中的声明对象</span></span><br><span class="line">Claims claims = Jwts.parser()</span><br><span class="line">   .setSigningKey(<span class="string">&quot;xxxx&quot;</span>) <span class="comment">//加密时的 盐</span></span><br><span class="line">   .parseClaimsJws(token)</span><br><span class="line">   .getBody();</span><br><span class="line"><span class="comment">//打印声明的属性</span></span><br><span class="line">System.out.println(<span class="string">&quot;id:&quot;</span>+claims.getId());</span><br><span class="line">System.out.println(<span class="string">&quot;subject:&quot;</span>+claims.getSubject());</span><br><span class="line">System.out.println(<span class="string">&quot;issuedAt:&quot;</span>+claims.getIssuedAt());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h3 id="21、Spring-Security-Oauth2-整合JWT"><a href="#21、Spring-Security-Oauth2-整合JWT" class="headerlink" title="21、Spring Security Oauth2 整合JWT"></a>21、Spring Security Oauth2 整合JWT</h3><p>在之前Spring Security Oauth2的基础上进行修改</p>
<p>添加配置类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JwtTokenStoreConfig</span> </span>&#123;</span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> TokenStore <span class="title">jwtTokenStore</span><span class="params">()</span></span>&#123;</span><br><span class="line">   <span class="keyword">return</span> <span class="keyword">new</span> JwtTokenStore(jwtAccessTokenConverter());</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> JwtAccessTokenConverter <span class="title">jwtAccessTokenConverter</span><span class="params">()</span></span>&#123;</span><br><span class="line">   JwtAccessTokenConverter accessTokenConverter = <span class="keyword">new</span> JwtAccessTokenConverter();</span><br><span class="line">   <span class="comment">//配置JWT使用的秘钥</span></span><br><span class="line">   accessTokenConverter.setSigningKey(<span class="string">&quot;test_key&quot;</span>);</span><br><span class="line">   <span class="keyword">return</span> jwtAccessTokenConverter();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在认证服务器配置中指定令牌的存储策略为JWT</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(AuthorizationServerEndpointsConfigurer endpoints)</span> </span>&#123;</span><br><span class="line">    endpoints.authenticationManager(authenticationManager)</span><br><span class="line">        .userDetailsService(userService)</span><br><span class="line">        <span class="comment">//配置存储令牌策略</span></span><br><span class="line">        .tokenStore(tokenStore)</span><br><span class="line">        .accessTokenConverter(jwtAccessTokenConverter);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>扩展JWT中存储的内容，这里我们在JWT中扩展一个 key为enhance，value为enhance info 的数据。<br>实现接口TokenEnhancer实现一个JWT内容增强器</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JwtTokenEnhancer</span> <span class="keyword">implements</span> <span class="title">TokenEnhancer</span> </span>&#123;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> OAuth2AccessToken <span class="title">enhance</span><span class="params">(OAuth2AccessToken accessToken,OAuth2Authentication authentication)</span> </span>&#123;</span><br><span class="line">    Map&lt;String,Object&gt; info = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">    info.put(<span class="string">&quot;enhance&quot;</span>,<span class="string">&quot;enhance info&quot;</span>);</span><br><span class="line">    ((DefaultOAuth2AccessToken)accessToken).setAdditionalInformation(info);</span><br><span class="line">    <span class="keyword">return</span> accessToken;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>创建一个JwtTokenEnhancer实例</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> JwtTokenEnhancer <span class="title">jwtTokenEnhancer</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> JwtTokenEnhancer();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在认证服务器配置中配置JWT的内容增强器</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(AuthorizationServerEndpointsConfigurer endpoints)</span> </span>&#123;</span><br><span class="line">TokenEnhancerChain enhancerChain = <span class="keyword">new</span> TokenEnhancerChain();</span><br><span class="line">List&lt;TokenEnhancer&gt; delegates = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    <span class="comment">//配置JWT的内容增强器</span></span><br><span class="line">    delegates.add(jwtTokenEnhancer);</span><br><span class="line">    delegates.add(jwtAccessTokenConverter);</span><br><span class="line">    enhancerChain.setTokenEnhancers(delegates);</span><br><span class="line">    endpoints.authenticationManager(authenticationManager)</span><br><span class="line">    .userDetailsService(userService)</span><br><span class="line">    <span class="comment">//配置存储令牌策略</span></span><br><span class="line">    .tokenStore(tokenStore)</span><br><span class="line">    .accessTokenConverter(jwtAccessTokenConverter)</span><br><span class="line">    .tokenEnhancer(enhancerChain);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>解析token</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/getCurrentUser&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">getCurrentUser</span><span class="params">(Authentication authentication,</span></span></span><br><span class="line"><span class="function"><span class="params">HttpServletRequest request)</span> </span>&#123;</span><br><span class="line">    String header = request.getHeader(<span class="string">&quot;Authorization&quot;</span>);</span><br><span class="line">    String token = header.substring(header.indexOf(<span class="string">&quot;bearer&quot;</span>) + <span class="number">7</span>);</span><br><span class="line">    <span class="keyword">return</span> Jwts.parser()</span><br><span class="line">    .setSigningKey(<span class="string">&quot;test_key&quot;</span>.getBytes(StandardCharsets.UTF_8))</span><br><span class="line">    .parseClaimsJws(token)</span><br><span class="line">    .getBody();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><strong>刷新令牌</strong></p>
<p>在Spring Cloud Security 中使用oauth2时，如果令牌失效了，可以使用刷新令牌通过refresh_token<br>的授权模式再次获取access_token。<br>只需修改认证服务器的配置，添加refresh_token的授权模式即可。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//配置访问token的有效期</span></span><br><span class="line">.accessTokenValiditySeconds(<span class="number">3600</span>)</span><br><span class="line"><span class="comment">//配置刷新token的有效期</span></span><br><span class="line">.refreshTokenValiditySeconds(<span class="number">864000</span>)</span><br></pre></td></tr></table></figure>





<h3 id="22、Spring-Security-Oauth2-整合单点登录（SSO）"><a href="#22、Spring-Security-Oauth2-整合单点登录（SSO）" class="headerlink" title="22、Spring Security Oauth2 整合单点登录（SSO）"></a>22、Spring Security Oauth2 整合单点登录（SSO）</h3><p>添加依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-oauth2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-security<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.jsonwebtoken<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jjwt<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.9.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>修改配置文件</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">server.port</span>=<span class="string">8081</span></span><br><span class="line"><span class="comment">#防止Cookie冲突，冲突会导致登录验证不通过</span></span><br><span class="line"><span class="meta">server.servlet.session.cookie.name</span>=<span class="string">OAUTH2-CLIENT-SESSIONID01</span></span><br><span class="line"><span class="comment">#授权服务器地址</span></span><br><span class="line"><span class="meta">oauth2-server-url</span>: <span class="string">http://localhost:8080</span></span><br><span class="line"><span class="comment">#与授权服务器对应的配置</span></span><br><span class="line"><span class="meta">security.oauth2.client.client-id</span>=<span class="string">admin</span></span><br><span class="line"><span class="meta">security.oauth2.client.client-secret</span>=<span class="string">112233</span></span><br><span class="line"><span class="meta">security.oauth2.client.user-authorization-uri</span>=<span class="string">$&#123;oauth2-server-</span></span><br><span class="line"><span class="attr">url&#125;/oauth/authorize</span></span><br><span class="line"><span class="meta">security.oauth2.client.access-token-uri</span>=<span class="string">$&#123;oauth2-server-url&#125;/oauth/token</span></span><br><span class="line"><span class="meta">security.oauth2.resource.jwt.key-uri</span>=<span class="string">$&#123;oauth2-server-url&#125;/oauth/token_key</span></span><br></pre></td></tr></table></figure>

<p>启动类添加<code>@EnableOAuth2Sso</code>注解</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableOAuth2Sso</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Oauth2client01demoApplication</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(Oauth2client01demoApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>修改认证服务器配置</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(ClientDetailsServiceConfigurer clients)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">clients.inMemory()</span><br><span class="line">    <span class="comment">//配置client_id</span></span><br><span class="line">    .withClient(<span class="string">&quot;admin&quot;</span>)</span><br><span class="line">    <span class="comment">//配置client-secret</span></span><br><span class="line">    .secret(passwordEncoder.encode(<span class="string">&quot;112233&quot;</span>))</span><br><span class="line">    <span class="comment">//配置访问token的有效期</span></span><br><span class="line">    .accessTokenValiditySeconds(<span class="number">3600</span>)</span><br><span class="line">    <span class="comment">//配置刷新token的有效期</span></span><br><span class="line">    .refreshTokenValiditySeconds(<span class="number">864000</span>)</span><br><span class="line">    <span class="comment">//配置redirect_uri，用于授权成功后跳转</span></span><br><span class="line">    <span class="comment">// .redirectUris(&quot;http://www.baidu.com&quot;)</span></span><br><span class="line">    <span class="comment">//单点登录时配置</span></span><br><span class="line">    .redirectUris(<span class="string">&quot;http://localhost:8081/login&quot;</span>)</span><br><span class="line">    <span class="comment">//配置申请的权限范围</span></span><br><span class="line">    .scopes(<span class="string">&quot;all&quot;</span>)</span><br><span class="line">    <span class="comment">//自动授权配置</span></span><br><span class="line">    .autoApprove(<span class="keyword">true</span>)</span><br><span class="line">    <span class="comment">//配置grant_type，表示授权类型</span></span><br><span class="line">    .authorizedGrantTypes(<span class="string">&quot;authorization_code&quot;</span>,<span class="string">&quot;password&quot;</span>,<span class="string">&quot;refresh_token&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(AuthorizationServerSecurityConfigurer security)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 获取密钥需要身份认证，使用单点登录时必须配置</span></span><br><span class="line">    security.tokenKeyAccess(<span class="string">&quot;isAuthenticated()&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h2 id="十、整合Shiro安全框架"><a href="#十、整合Shiro安全框架" class="headerlink" title="十、整合Shiro安全框架"></a>十、整合Shiro安全框架</h2><h3 id="整合-Shiro-环境搭建"><a href="#整合-Shiro-环境搭建" class="headerlink" title="整合 Shiro 环境搭建"></a>整合 Shiro 环境搭建</h3><p>Shiro 三大对象<br>Subject    当前用户<br>SecurityManager    管理所有用户<br>Realm    连接数据</p>
<p>一、在pom文件中导入shiro的坐标依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--    Shiro 三大对象</span></span><br><span class="line"><span class="comment">                   Subject   用户</span></span><br><span class="line"><span class="comment">                   SecurityManager    管理用户</span></span><br><span class="line"><span class="comment">                   Realm    连接数据</span></span><br><span class="line"><span class="comment">       --&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.shiro<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>shiro-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.5.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>二、创建Shiro的配置类一个ShiroConfig类:</p>
<p>  该类有三大核心组件：</p>
<ol>
<li><p>getShiroFilterFactoryBean</p>
</li>
<li><p>getDefaultWebSecrityManager</p>
</li>
<li><p>userRealm</p>
<p>三大组件相互关联：</p>
<pre><code>  DefaultWebSecrityManager与userRealm相关联

  ShiroFilterFactoryBean与DefaultWebSecrityManager相关联
</code></pre>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ShiroFilterFactoryBean : 3</span></span><br><span class="line">   </span><br><span class="line">   <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> ShiroFilterFactoryBean </span><br><span class="line">        getShiroFilterFactoryBean ( <span class="meta">@Qualifier(&quot;SecurityManager&quot;)</span> </span><br><span class="line">                 DefaultWebSecurityManager defaultWebSecurityManager)&#123;</span><br><span class="line">       </span><br><span class="line">        ShiroFilterFactoryBean bean = <span class="keyword">new</span> ShiroFilterFactoryBean();</span><br><span class="line">       </span><br><span class="line">        <span class="keyword">return</span> bean;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"><span class="comment">//DefaultWebSecrityManager :2</span></span><br><span class="line">    </span><br><span class="line">   <span class="meta">@Bean(name=&quot;SecurityManager&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> DefaultWebSecurityManager </span><br><span class="line">        getDefaultWebSecrityManager ( <span class="meta">@Qualifier(&quot;userRealm&quot;)</span>                                     UserRealm userRealm)      &#123;</span><br><span class="line">        </span><br><span class="line">        DefaultWebSecurityManager securityManager</span><br><span class="line">                  = <span class="keyword">new</span> DefaultWebSecurityManager();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//关联UserRealm</span></span><br><span class="line">        securityManager.setRealm(userRealm);</span><br><span class="line">        <span class="keyword">return</span> securityManager;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line"><span class="comment">//创建realm对象 ，需要自定义类 : 1</span></span><br><span class="line">    </span><br><span class="line">   <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span>  UserRealm <span class="title">userRealm</span><span class="params">()</span></span>&#123;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> UserRealm();</span><br><span class="line">    </span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>三、创建UserRealm类 并继承AuthorizingRealm类，重写其方法</p>
<p>  重写的方法有两个：</p>
<p>  1.授权-&gt;doGetAuthorizationInfo</p>
<p>  2.认证-&gt;doGetAuthenticationInfo</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//自定义的UserRealm  extends  AuthorizingRealm</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserRealm</span> <span class="keyword">extends</span> <span class="title">AuthorizingRealm</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//授权</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> AuthorizationInfo doGetAuthorizationInfo</span><br><span class="line">        (PrincipalCollection principalCollection) &#123;</span><br><span class="line">       </span><br><span class="line">        System.out.println(<span class="string">&quot;执行了—&gt; 授权doGetAuthorizationInfo&quot;</span> );</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//认证</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> AuthenticationInfo doGetAuthenticationInfo</span><br><span class="line">              (AuthenticationToken authenticationToken)</span><br><span class="line">              <span class="keyword">throws</span> AuthenticationException &#123;</span><br><span class="line">        </span><br><span class="line">        System.out.println(<span class="string">&quot;执行了—&gt; 认证doGetAuthorizationInfo&quot;</span> );</span><br><span class="line">       </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="实现登录拦截"><a href="#实现登录拦截" class="headerlink" title="实现登录拦截"></a>实现登录拦截</h3><p>在getShiroFilterFactoryBean组件中</p>
<p>添加shiro的内置过滤器</p>
<p>  该过滤器有五大权限:</p>
<ol>
<li>anon：无需认证就可以访问</li>
<li>authc：必需认证才能访问</li>
<li>user：必须拥有 记住我 功能才能用</li>
<li>perms：拥有对某个资源的权限才能访问</li>
<li>role：拥有某个角色权限才能访问</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ShiroFilterFactoryBean : 3</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> ShiroFilterFactoryBean  getShiroFilterFactoryBean</span><br><span class="line">        ( <span class="meta">@Qualifier(&quot;SecurityManager&quot;)</span> DefaultWebSecurityManager</span><br><span class="line">                             defaultWebSecurityManager)&#123;</span><br><span class="line">        </span><br><span class="line">        ShiroFilterFactoryBean bean = <span class="keyword">new</span> ShiroFilterFactoryBean();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//设置安全管理器 </span></span><br><span class="line">        <span class="comment">//defaultWebSecurityManager为</span></span><br><span class="line">        <span class="comment">//DefaultWebSecurityManager组件的对象</span></span><br><span class="line">        bean.setSecurityManager(defaultWebSecurityManager);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//添加shiro的内置过滤器</span></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        *  anon：无需认证就可以访问</span></span><br><span class="line"><span class="comment">        *  authc：必需认证才能访问</span></span><br><span class="line"><span class="comment">        *  user：必须拥有 记住我 功能才能用</span></span><br><span class="line"><span class="comment">        *  perms：拥有对某个资源的权限才能访问</span></span><br><span class="line"><span class="comment">        *  role：拥有某个角色权限才能访问</span></span><br><span class="line"><span class="comment">        * */</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//登录拦截</span></span><br><span class="line">        Map&lt;String,String&gt; filterChainDefinitionMap = <span class="keyword">new</span> LinkedHashMap&lt;&gt;();</span><br><span class="line">      <span class="comment">//添加需要拦截（未登录）的请求</span></span><br><span class="line">        filterChainDefinitionMap.put(<span class="string">&quot;/user/add&quot;</span>,<span class="string">&quot;authc&quot;</span>);</span><br><span class="line">        filterChainDefinitionMap.put(<span class="string">&quot;/user/update&quot;</span>,<span class="string">&quot;authc&quot;</span>);</span><br><span class="line">      <span class="comment">//filterChainDefinitionMap.put(&quot;/user/*&quot;,&quot;authc&quot;);</span></span><br><span class="line">        </span><br><span class="line">        bean.setFilterChainDefinitionMap(filterChainDefinitionMap);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//设置登录页面的路径(当拦截到未登录的请求时，跳转到该页面)</span></span><br><span class="line">        bean.setLoginUrl(<span class="string">&quot;/toLogin&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> bean;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h3 id="实现用户认证"><a href="#实现用户认证" class="headerlink" title="实现用户认证"></a>实现用户认证</h3><p>  在<strong>登陆的controller</strong>中接收用户信息，并封装成一个token（令牌）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"> UsernamePasswordToken token = <span class="keyword">new</span> UsernamePasswordToken</span><br><span class="line">                                  (username, password);</span><br><span class="line"><span class="comment">//设置记住我</span></span><br><span class="line"><span class="comment">//token.setRememberMe(true);</span></span><br></pre></td></tr></table></figure>

<p>  用当前用户进行登录</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/login&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">login</span><span class="params">(String username,String password,Model model)</span></span>&#123;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//获取当前的用户</span></span><br><span class="line">        Subject subject = SecurityUtils.getSubject();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//封装用户的登陆数据</span></span><br><span class="line">        UsernamePasswordToken token = <span class="keyword">new</span> UsernamePasswordToken</span><br><span class="line">                                  (username, password);</span><br><span class="line">       </span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            subject.login(token);<span class="comment">//执行登录方法，如果没有异常就说明ok</span></span><br><span class="line"></span><br><span class="line">        &#125;<span class="keyword">catch</span> (UnknownAccountException e)&#123;</span><br><span class="line">            model.addAttribute(<span class="string">&quot;msg&quot;</span>,<span class="string">&quot;用户名错误&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;login&quot;</span>;</span><br><span class="line">        &#125;<span class="keyword">catch</span> (IncorrectCredentialsException e)&#123;</span><br><span class="line">            model.addAttribute(<span class="string">&quot;msg&quot;</span>,<span class="string">&quot;密码错误&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;login&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;index&quot;</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>



<p>然后</p>
<p>  在userRealm类中的 认证—&gt;方法中对用户名进行认证。。</p>
<pre><code> shiro不用验证密码，shiro自动认证
</code></pre>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//认证</span></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">protected</span> AuthenticationInfo doGetAuthenticationInfo</span><br><span class="line">       (AuthenticationToken authenticationToken) </span><br><span class="line">                   <span class="keyword">throws</span>        AuthenticationException &#123;</span><br><span class="line">      </span><br><span class="line">       System.out.println(<span class="string">&quot;执行了—&gt; 认证doGetAuthorizationInfo&quot;</span> );</span><br><span class="line">       </span><br><span class="line">       <span class="comment">//用户名，密码   数据库中取</span></span><br><span class="line">       String username=<span class="string">&quot;root&quot;</span>;<span class="comment">//伪造数据</span></span><br><span class="line">       String password=<span class="string">&quot;123456&quot;</span>;</span><br><span class="line">       </span><br><span class="line">       UsernamePasswordToken usertoken = </span><br><span class="line">              (UsernamePasswordToken) authenticationToken;</span><br><span class="line">       </span><br><span class="line">       <span class="keyword">if</span>(!usertoken.getUsername().equals(username))&#123;</span><br><span class="line">           <span class="keyword">return</span> <span class="keyword">null</span>;<span class="comment">//抛出用户名错误异常 UnknownAccountException</span></span><br><span class="line">       &#125;</span><br><span class="line">     <span class="comment">//密码认证：shiro做 ,加密了</span></span><br><span class="line">       <span class="comment">//该构造方法中三个参数：</span></span><br><span class="line">       <span class="comment">//    第一个参数为向授权方法中传递的用户信息，</span></span><br><span class="line">       <span class="comment">//    第二个参数为从数据库中查找的用户的密码，用于shiro验证登录的密码是否正确</span></span><br><span class="line">       <span class="keyword">return</span> <span class="keyword">new</span>     SimpleAuthenticationInfo</span><br><span class="line">                       (admin,admin.getPassword(),<span class="string">&quot;&quot;</span>);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>



<h3 id="整合mybatis的认证"><a href="#整合mybatis的认证" class="headerlink" title="整合mybatis的认证"></a>整合mybatis的认证</h3><p>首先导入mybatis， mysql，jdbc的相关依赖坐标</p>
<p>在对数据源和mybatis进行配置</p>
<p>写好与登录所需查找用户表相关的mapper 以及其映射文件，及service类</p>
<p>然后</p>
<p>  在userRealm类中的 认证—&gt;方法中，通过前端传来的username从数据库中获取</p>
<p>用户信息；并进行认证</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">   <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AdminService service; </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//认证</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> AuthenticationInfo <span class="title">doGetAuthenticationInfo</span><span class="params">(AuthenticationToken authenticationToken)</span> <span class="keyword">throws</span> AuthenticationException </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;执行了—&gt; 认证doGetAuthorizationInfo&quot;</span> );</span><br><span class="line"></span><br><span class="line">        UsernamePasswordToken usertoken = (UsernamePasswordToken) authenticationToken;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//用户名，密码   数据库中取</span></span><br><span class="line">        Admin admin = service.findByUsername(usertoken.getUsername());</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (admin==<span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>; <span class="comment">//UnknowAccountExeception 抛出用户名错误异常</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//密码认证：shiro做 ,加密了</span></span><br><span class="line">        <span class="comment">//该构造方法中三个参数：</span></span><br><span class="line">        <span class="comment">//    第一个参数为向授权方法中传递的用户信息，</span></span><br><span class="line">        <span class="comment">//    第二个参数为从数据库中查找的用户的密码，用于shiro验证登录的密码是否正确</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> SimpleAuthenticationInfo</span><br><span class="line">                     (admin,admin.getPassword(),<span class="string">&quot;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="实现权限设置"><a href="#实现权限设置" class="headerlink" title="实现权限设置"></a>实现权限设置</h3><p>在shiroConfig类中可以 对访问某个资源页面所需权限 进行设置</p>
<blockquote>
<p>//拦截未拥有对/user/add资源的权限的请求，跳转到未授权页面</p>
<p>filterChainDefinitionMap.put(“/user/add”,”perms[user:add]”);</p>
</blockquote>
<p>显示未授权信息的页面也可自己设置</p>
<blockquote>
<p>//设置未授权页面的路径<br>bean.setUnauthorizedUrl(“/noauth”);</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> ShiroFilterFactoryBean  getShiroFilterFactoryBean</span><br><span class="line">        ( <span class="meta">@Qualifier(&quot;SecurityManager&quot;)</span></span><br><span class="line">         DefaultWebSecurityManager     defaultWebSecurityManager)&#123;</span><br><span class="line">      </span><br><span class="line">        ShiroFilterFactoryBean bean = <span class="keyword">new</span> ShiroFilterFactoryBean();</span><br><span class="line">        <span class="comment">//设置安全管理器</span></span><br><span class="line">        bean.setSecurityManager(defaultWebSecurityManager);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//添加shiro的内置过滤器</span></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        *  anon：无需认证就可以访问</span></span><br><span class="line"><span class="comment">        *  authc：必需认证才能访问</span></span><br><span class="line"><span class="comment">        *  user：必须拥有 记住我 功能才能用</span></span><br><span class="line"><span class="comment">        *  perms：拥有对某个资源的权限才能访问</span></span><br><span class="line"><span class="comment">        *  role：拥有某个角色权限才能访问</span></span><br><span class="line"><span class="comment">        * */</span></span><br><span class="line">        <span class="comment">//设置权限</span></span><br><span class="line">        <span class="comment">//登录拦截</span></span><br><span class="line">        Map&lt;String,String&gt; filterChainDefinitionMap = <span class="keyword">new</span> LinkedHashMap&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//拦截未拥有对/user/add资源的权限的请求，跳转到未授权页面</span></span><br><span class="line">        filterChainDefinitionMap.put(<span class="string">&quot;/user/add&quot;</span>,<span class="string">&quot;perms[user:add]&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//拦截user下所有未认证请求</span></span><br><span class="line">        filterChainDefinitionMap.put(<span class="string">&quot;/user/*&quot;</span>,<span class="string">&quot;authc&quot;</span>);</span><br><span class="line"><span class="comment">//        filterChainDefinitionMap.put(&quot;/user/add&quot;,&quot;authc&quot;);</span></span><br><span class="line"><span class="comment">//        filterChainDefinitionMap.put(&quot;/user/update&quot;,&quot;authc&quot;);</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        bean.setFilterChainDefinitionMap(filterChainDefinitionMap);</span><br><span class="line">        <span class="comment">//设置登录页面的路径</span></span><br><span class="line">        bean.setLoginUrl(<span class="string">&quot;/toLogin&quot;</span>);</span><br><span class="line">        <span class="comment">//设置未授权页面的路径</span></span><br><span class="line">        bean.setUnauthorizedUrl(<span class="string">&quot;/noauth&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> bean;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>



<h3 id="实现用户授权"><a href="#实现用户授权" class="headerlink" title="实现用户授权"></a>实现用户授权</h3><p>在UserRealm类的 授权-&gt;doGetAuthorizationInfo方法中对当前用户所拥有 用户权限进行授权</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//授权</span></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">protected</span> AuthorizationInfo <span class="title">doGetAuthorizationInfo</span><span class="params">(PrincipalCollection principalCollection)</span> </span>&#123;</span><br><span class="line">       System.out.println(<span class="string">&quot;执行了—&gt; 授权doGetAuthorizationInfo&quot;</span> );</span><br><span class="line"></span><br><span class="line">       SimpleAuthorizationInfo info = <span class="keyword">new</span> SimpleAuthorizationInfo();</span><br><span class="line">       <span class="comment">//拿到当前登录的对象,该对象为 认证方法返回值的第一个参数</span></span><br><span class="line">       Subject subject = SecurityUtils.getSubject();</span><br><span class="line">       Admin admin = (Admin) subject.getPrincipal();</span><br><span class="line">       <span class="comment">//给用户添加在ShiroConfig类中设置的相关权限。</span></span><br><span class="line">       <span class="comment">//(参数为admin用户所拥有的权限)</span></span><br><span class="line">       info.addStringPermission ( admin.getPerms() );</span><br><span class="line"></span><br><span class="line">       <span class="keyword">return</span> info;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<h3 id="shiro整合thymeleaf"><a href="#shiro整合thymeleaf" class="headerlink" title="shiro整合thymeleaf"></a>shiro整合thymeleaf</h3><p>  导入相关依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--        shiro整合thymeleaf--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.theborakompanioni<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>thymeleaf-extras-shiro<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>在shiroConfig中将ShiroDialect配置到容器中</p>
<pre><code> 用来整合shiro 和 thymeleaf
</code></pre>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//整合ShiroDialect ：用来整合shiro 和 thymeleaf</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ShiroDialect <span class="title">getShiroDialect</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ShiroDialect();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>最后  使用</p>
<p>  在拥有该权限时，显示该模块</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">shiro:hasPermission</span>=<span class="string">&quot;user:add&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/user/add&#125;&quot;</span>&gt;</span>add<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">shiro:hasPermission</span>=<span class="string">&quot;user:update&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/user/update&#125;&quot;</span>&gt;</span>update<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="十一、整合Swagger"><a href="#十一、整合Swagger" class="headerlink" title="十一、整合Swagger"></a>十一、整合Swagger</h2><h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><ul>
<li>号称世界上最流行的Api框架</li>
<li>RestFul Api文档在线生成工具-&gt;Api文档与API定义同步更新</li>
<li>直接运行，可以在线测试API接口；</li>
<li>支持多种语言</li>
</ul>
<h3 id="springboot集成Swagger"><a href="#springboot集成Swagger" class="headerlink" title="springboot集成Swagger"></a>springboot集成Swagger</h3><ol>
<li><p>新建一个springboot项目</p>
</li>
<li><p>导入相关依赖</p>
</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--        swagger依赖--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.springfox<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springfox-swagger2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.springfox<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springfox-swagger-ui<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>



<ol start="3">
<li>创建SwaggerConfig类，@EnableSwagger2注解开启Swagger2</li>
</ol>
<p>  此时Swagger2已经可以使用，（设置为默认配置）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableSwagger2</span>         <span class="comment">//开启Swagger2</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SwaggerConfig</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="4">
<li><p>测试运行：</p>
<blockquote>
<p>localhost:8080//swagger-ui.html</p>
</blockquote>
</li>
</ol>
<h3 id="配置Swagger"><a href="#配置Swagger" class="headerlink" title="配置Swagger"></a>配置Swagger</h3><p>  再SwaggerConfig类中配置了Swagger的Docket的bean实例</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableSwagger2</span>         <span class="comment">//开启Swagger2</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SwaggerConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//配置了Swagger的Docket的bean实例</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Docket <span class="title">docket</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Docket(DocumentationType.SWAGGER_2)</span><br><span class="line">                .apiInfo(apiInfo()) <span class="comment">//配置Swagger信息</span></span><br><span class="line">                .select()</span><br><span class="line">                <span class="comment">//RequestHandlerSelectors :配置要扫描接口的方式</span></span><br><span class="line">                <span class="comment">//basePackage 指定要扫描的包</span></span><br><span class="line">                .apis(RequestHandlerSelectors.basePackage(<span class="string">&quot;com.xyc&quot;</span>))</span><br><span class="line">                  </span><br><span class="line">               <span class="comment">//.paths(Predicates.not(PathSelectors.regex(&quot;/admin/.*&quot;)))</span></span><br><span class="line">                <span class="comment">//.paths(Predicates.not(PathSelectors.regex(&quot;/error.*&quot;)))</span></span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line">    <span class="comment">//配置Swagger信息</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> ApiInfo <span class="title">apiInfo</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ApiInfoBuilder()</span><br><span class="line">                .title(<span class="string">&quot;谷粒学院-SwaggerAPI文档&quot;</span>)</span><br><span class="line">                .description(<span class="string">&quot;本文档描述了课程中心微服务接口定义&quot;</span>)</span><br><span class="line">                .version( <span class="string">&quot;v1.0&quot;</span>)</span><br><span class="line">                .contact(<span class="keyword">new</span> Contact(<span class="string">&quot;java&quot;</span>,<span class="string">&quot;http://www.baidu.com&quot;</span>,<span class="string">&quot;452662481@qq.com&quot;</span>))</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="十二、任务"><a href="#十二、任务" class="headerlink" title="十二、任务"></a>十二、任务</h2><h3 id="1、异步任务"><a href="#1、异步任务" class="headerlink" title="1、异步任务"></a>1、异步任务</h3><p>常规使用异步任务，我们需要自定义多线程，通过开启线程来处理异步任务</p>
<p>springboot使用异步任务，只需用@EnableAsync 注解开启异步任务功能，并在指定方法上使用@Async注解标注该方法为异步任务。</p>
<p>案例：</p>
<p>用一个AsyncService类模拟数据处理，</p>
<p>如果不使用异步任务，在提交请求后，系统会把数据处理完成后，才进行响应。</p>
<p><strong>service</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xyc.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 2020/5/1 22:39</span></span><br><span class="line"><span class="comment"> * 文件说明：模拟一个service 需要进行处理一个耗时时间长的任务</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> xyc</span></span><br><span class="line"><span class="comment"> * 梦可以到的地方，只要努力，总有一天，自己也可以达到！</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AsyncService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">hello</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;数据正在处理。。。&quot;</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;数据3秒后处理完成。。。&quot;</span>);</span><br><span class="line">            Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">            System.out.println(<span class="string">&quot;数据2秒后处理完成。。。&quot;</span>);</span><br><span class="line">            Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">            System.out.println(<span class="string">&quot;数据1秒后处理完成。。。&quot;</span>);</span><br><span class="line">            Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;数据处理完成。。。&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>controller</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xyc.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.xyc.service.AsyncService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.scheduling.annotation.Async;</span><br><span class="line"><span class="keyword">import</span> org.springframework.scheduling.annotation.EnableAsync;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 2020/5/1 22:43</span></span><br><span class="line"><span class="comment"> * 文件说明：</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> xyc</span></span><br><span class="line"><span class="comment"> * 梦可以到的地方，只要努力，总有一天，自己也可以达到！</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@EnableAsync</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AsyncController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    AsyncService asyncService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Async</span></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/hello&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">hello</span><span class="params">()</span></span>&#123;</span><br><span class="line">        asyncService.hello();</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;hello&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="2、定时任务"><a href="#2、定时任务" class="headerlink" title="2、定时任务"></a>2、定时任务</h3><p>主要的类与注解</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">TaskScheduler  任务调度者</span><br><span class="line">TaskExecutor   任务执行者</span><br><span class="line"></span><br><span class="line">@EnableScheduling  &#x2F;&#x2F;开启定时功能的注解</span><br><span class="line">&#x2F;&#x2F;在特定时间执行这个方法</span><br><span class="line">&#x2F;&#x2F;                 秒 分 时 日 月 周几</span><br><span class="line">@Scheduled(cron &#x3D; &quot;10 31 20 *  *  ?&quot;)</span><br><span class="line"></span><br><span class="line">cron表达式</span><br><span class="line"></span><br></pre></td></tr></table></figure>





<p>使用案例</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableScheduling</span><span class="comment">//开启定时功能的注解</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ScheduledService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//在特定时间执行这个方法</span></span><br><span class="line">    <span class="comment">//                 秒 分 时 日 月 周几</span></span><br><span class="line">    <span class="meta">@Scheduled(cron = &quot;10 31 20 * * ?&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">hello</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;hello ya~&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h3 id="3、邮件任务"><a href="#3、邮件任务" class="headerlink" title="3、邮件任务"></a>3、邮件任务</h3><p>javaWeb原生的发送邮件需要手动配置好多的东西，使用springboot发送邮件，只需要在配置文件中配置邮件相关信息，并<code> new</code>一个<code>JavaMailSenderImpl</code>类，并调用send方法即可。</p>
<p>在springboot中存在一个<code> MailSenderAutoConfiguration</code>类，在里面面定义了对mail的自动配置。</p>
<p><img src="/2021/04/24/springboot/../AppData/Roaming/Typora/typora-user-images/image-20200504173857083.png" alt="image-20200504173857083"></p>
<p>在<code>MailProperties.class</code>类中定义了电子邮件支持的配置属性，即在<code>application.yml</code>配置文件中需要配置的相关属性</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;spring.mail&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MailProperties</span> </span>&#123;</span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Charset DEFAULT_CHARSET = StandardCharsets.UTF_8;</span><br><span class="line">   <span class="comment">/** SMTP server host. For instance, `smtp.example.com`.*/</span></span><br><span class="line">   <span class="keyword">private</span> String host;<span class="comment">//主机 smtp.XXX.com</span></span><br><span class="line">   <span class="comment">/** SMTP server port.*/</span></span><br><span class="line">   <span class="keyword">private</span> Integer port;<span class="comment">//端口</span></span><br><span class="line">   <span class="comment">/** Login user of the SMTP server.*/</span></span><br><span class="line">   <span class="keyword">private</span> String username;<span class="comment">//用户名</span></span><br><span class="line">   <span class="comment">/** Login password of the SMTP server.*/</span></span><br><span class="line">   <span class="keyword">private</span> String password;<span class="comment">//密码</span></span><br><span class="line">   <span class="comment">/** Protocol used by the SMTP server.*/</span></span><br><span class="line">   <span class="keyword">private</span> String protocol = <span class="string">&quot;smtp&quot;</span>;<span class="comment">//协议</span></span><br><span class="line">   <span class="comment">/** Default MimeMessage encoding.*/</span></span><br><span class="line">   <span class="keyword">private</span> Charset defaultEncoding = DEFAULT_CHARSET;</span><br><span class="line">   <span class="comment">/** Additional JavaMail Session properties.*/</span></span><br><span class="line">   <span class="keyword">private</span> Map&lt;String, String&gt; properties = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">   <span class="comment">/** Session JNDI name. When set, takes precedence over other Session settings.*/</span></span><br><span class="line">   <span class="keyword">private</span> String jndiName;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>并导入了<code>MailSenderJndiConfiguration.class</code>和<code>MailSenderPropertiesConfiguration.class</code>对邮件发送人进行自动配置，使我们在需要发送邮件时只需要直接调用<code>JavaMailSenderImpl</code>即可</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Import(&#123; MailSenderJndiConfiguration.class,            MailSenderPropertiesConfiguration.class &#125;)</span></span><br></pre></td></tr></table></figure>

<p><code>javaMailSenderImpl</code>实现了<code>JavaMailSender</code>接口，并同时支持<code>JavaMail</code></p>
<p><code> &#123;@link MimeMessage MimeMessages&#125;</code>和<code>Spring</code></p>
<p><code>&#123;@link SimpleMailMessage SimpleMailMessages&#125;</code>可以仅仅当做mailSender的实现类使用，</p>
<p>允许将所有设置本地定义为Bean属性。或者，可以指定一个预先配置的JavaMail {@link javax.mail.Session}，可以从应用程序服务器的JNDI环境中提取。</p>
<p><code>javaMailSenderImpl</code>中发送邮件需要的的一些方法实现，</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">   <span class="comment">//---------------------------------------------------------------------</span></span><br><span class="line">   <span class="comment">// Implementation of MailSender</span></span><br><span class="line">   <span class="comment">//---------------------------------------------------------------------</span></span><br><span class="line">   </span><br><span class="line"><span class="comment">//发送简单邮件消息</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">send</span><span class="params">(SimpleMailMessage simpleMessage)</span> <span class="keyword">throws</span> MailException </span>&#123;&#125;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">send</span><span class="params">(SimpleMailMessage... simpleMessages)</span> <span class="keyword">throws</span> MailException </span>&#123;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">//---------------------------------------------------------------------</span></span><br><span class="line">   <span class="comment">// Implementation of JavaMailSender</span></span><br><span class="line">   <span class="comment">//---------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">//返回一个MimeMessage类，此类用于定义发送邮件消息的相关信息</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> MimeMessage <span class="title">createMimeMessage</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> MimeMessage <span class="title">createMimeMessage</span><span class="params">(InputStream contentStream)</span> <span class="keyword">throws</span> MailException </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//发送复杂的邮件//包括支持html和可以发送附件，在使用时需要借助MimeMessageHelper类</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">send</span><span class="params">(MimeMessage mimeMessage)</span> <span class="keyword">throws</span> MailException </span>&#123;&#125;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">send</span><span class="params">(MimeMessage... mimeMessages)</span> <span class="keyword">throws</span> MailException </span>&#123;&#125;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">send</span><span class="params">(MimeMessagePreparator mimeMessagePreparator)</span> <span class="keyword">throws</span> MailException </span>&#123;&#125;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">send</span><span class="params">(MimeMessagePreparator... mimeMessagePreparators)</span> <span class="keyword">throws</span> MailException </span>&#123;&#125;</span><br></pre></td></tr></table></figure>



<h4 id="使用-2"><a href="#使用-2" class="headerlink" title="使用"></a>使用</h4><ul>
<li><p>导入坐标依赖</p>
</li>
<li><p>在yml文件中配置相关信息</p>
</li>
<li><p>编写邮件并发送</p>
</li>
</ul>
<p>坐标依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-mail<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>配置信息</p>
 <figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">mail:</span></span><br><span class="line">    <span class="attr">username:</span> <span class="number">13072667463</span><span class="string">@163.com</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">XYC123456</span></span><br><span class="line">    <span class="attr">host:</span> <span class="string">smtp.163.com</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#qq邮箱需要开启加密验证</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>使用</p>
<ol>
<li>实例化 JavaMailSenderImpl类</li>
<li>发送简单邮件时，实例化SimpleMailMessage对象，并在里面配置所发送邮件的相关信息</li>
<li>发送复杂邮件时，通过JavaMailSenderImp的实例化对象，调用createMimeMessage()方法创建MimeMessage对象，并通过MimeMessageHelper对象配置所发送邮件的相关信息</li>
<li>可以通过Ctrl+左键点击类中，来查看发送邮件信息所需要的配置</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xyc.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.mail.SimpleMailMessage;</span><br><span class="line"><span class="keyword">import</span> org.springframework.mail.javamail.JavaMailSenderImpl;</span><br><span class="line"><span class="keyword">import</span> org.springframework.mail.javamail.MimeMailMessage;</span><br><span class="line"><span class="keyword">import</span> org.springframework.mail.javamail.MimeMessageHelper;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.mail.Message;</span><br><span class="line"><span class="keyword">import</span> javax.mail.MessagingException;</span><br><span class="line"><span class="keyword">import</span> javax.mail.internet.MimeMessage;</span><br><span class="line"><span class="keyword">import</span> javax.xml.soap.MimeHeader;</span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 2020/5/4 10:20</span></span><br><span class="line"><span class="comment"> * 文件说明：</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> xyc</span></span><br><span class="line"><span class="comment"> * 梦可以到的地方，只要努力，总有一天，自己也可以达到！</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MailService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> JavaMailSenderImpl mailSender;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//简单的邮件</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">simpleSend</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="comment">//创建简单邮件信息</span></span><br><span class="line">        SimpleMailMessage simpleMailMessage =<span class="keyword">new</span> SimpleMailMessage();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//设置标题</span></span><br><span class="line">        simpleMailMessage.setSubject(<span class="string">&quot;你好啊！&quot;</span>);</span><br><span class="line">        <span class="comment">//设置内容</span></span><br><span class="line">        simpleMailMessage.setText(<span class="string">&quot;哈哈哈哈哈&quot;</span>);</span><br><span class="line">        simpleMailMessage.setTo(<span class="string">&quot;452662481@qq.com&quot;</span>);</span><br><span class="line">        simpleMailMessage.setFrom(<span class="string">&quot;13072667463@163.com&quot;</span>);</span><br><span class="line"></span><br><span class="line">        mailSender.send(simpleMailMessage);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">mimeSend</span><span class="params">()</span> <span class="keyword">throws</span> MessagingException </span>&#123;</span><br><span class="line">        MimeMessage mimeMessage = mailSender.createMimeMessage();</span><br><span class="line">        <span class="comment">// @param mimeMessage the mime message to work on</span></span><br><span class="line">        <span class="comment">// @param multipart whether to create a multipart message that</span></span><br><span class="line">        <span class="comment">//       supports alternative texts, inline elements and attachments</span></span><br><span class="line">        MimeMessageHelper messageHelper = <span class="keyword">new</span> MimeMessageHelper(mimeMessage,<span class="keyword">true</span>);</span><br><span class="line">        messageHelper.setSubject(<span class="string">&quot;你好啊&quot;</span>);</span><br><span class="line">        messageHelper.setText(<span class="string">&quot;&lt;p style=&#x27;color:red&#x27;&gt;薛云冲，&lt;br&gt;你订购的软件的验证码123123&lt;/p&gt;&quot;</span>,<span class="keyword">true</span>);</span><br><span class="line">        messageHelper.setTo(<span class="string">&quot;452662481@qq.com&quot;</span>);</span><br><span class="line">        messageHelper.setFrom(<span class="string">&quot;13072667463@163.com&quot;</span>);</span><br><span class="line">        <span class="comment">//添加附件</span></span><br><span class="line">        messageHelper.addAttachment(<span class="string">&quot;&quot;</span>,<span class="keyword">new</span> File(<span class="string">&quot;&quot;</span>));</span><br><span class="line">        mailSender.send(mimeMessage);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="十三、整合Redis"><a href="#十三、整合Redis" class="headerlink" title="十三、整合Redis"></a>十三、整合Redis</h2><p>springboot在 RedisAutoConfiguration 中为我们自动配置了Redis</p>
<p>RedisAutoConfiguration类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration(proxyBeanMethods = false)</span></span><br><span class="line"><span class="meta">@ConditionalOnClass(RedisOperations.class)</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties(RedisProperties.class)</span></span><br><span class="line"><span class="meta">@Import(&#123; LettuceConnectionConfiguration.class, JedisConnectionConfiguration.class &#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RedisAutoConfiguration</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Bean</span></span><br><span class="line">    <span class="comment">//当redisTemplate不存在时使用下面的配置，即当我们需要自己定制redisTemplate时，</span></span><br><span class="line">    <span class="comment">//可以自行定义redisTemplate来替换这个默认值</span></span><br><span class="line">   <span class="meta">@ConditionalOnMissingBean(name = &quot;redisTemplate&quot;)</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> RedisTemplate&lt;Object, Object&gt; <span class="title">redisTemplate</span><span class="params">(RedisConnectionFactory redisConnectionFactory)</span></span></span><br><span class="line"><span class="function">         <span class="keyword">throws</span> UnknownHostException </span>&#123;</span><br><span class="line">        <span class="comment">//默认的RedisTemplate没有过多的设置，redis对象都需要序列化</span></span><br><span class="line">        <span class="comment">//两个泛型都是Object，Object的类型，使用时需要强制类型转换&lt;String ,Object&gt;</span></span><br><span class="line">      RedisTemplate&lt;Object, Object&gt; template = <span class="keyword">new</span> RedisTemplate&lt;&gt;();</span><br><span class="line">      template.setConnectionFactory(redisConnectionFactory);</span><br><span class="line">      <span class="keyword">return</span> template;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Bean</span></span><br><span class="line">   <span class="meta">@ConditionalOnMissingBean</span> </span><br><span class="line">    <span class="comment">//由于string类型是redis最常用的类型，所以特别提出了一个类</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> StringRedisTemplate <span class="title">stringRedisTemplate</span><span class="params">(RedisConnectionFactory redisConnectionFactory)</span></span></span><br><span class="line"><span class="function">         <span class="keyword">throws</span> UnknownHostException </span>&#123;</span><br><span class="line">      StringRedisTemplate template = <span class="keyword">new</span> StringRedisTemplate();</span><br><span class="line">      template.setConnectionFactory(redisConnectionFactory);</span><br><span class="line">      <span class="keyword">return</span> template;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在<code>application.yml</code>配置文件中需要配置的相关属性在RedisProperties.class类中定义</p>
<p>RedisProperties.class类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;spring.redis&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RedisProperties</span> </span>&#123;</span><br><span class="line">   <span class="comment">/** Database index used by the connection factory.*/</span></span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">int</span> database = <span class="number">0</span>;</span><br><span class="line">   <span class="comment">/** Connection URL. Overrides host, port, and password. User is ignored. */</span></span><br><span class="line">   <span class="keyword">private</span> String url;</span><br><span class="line">   <span class="comment">/** Redis server host.*/</span></span><br><span class="line">   <span class="keyword">private</span> String host = <span class="string">&quot;localhost&quot;</span>;</span><br><span class="line">   <span class="comment">/** Login password of the redis server.*/</span></span><br><span class="line">   <span class="keyword">private</span> String password;</span><br><span class="line">   <span class="comment">/** Redis server port.*/</span></span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">int</span> port = <span class="number">6379</span>;</span><br><span class="line">   <span class="comment">/**Whether to enable SSL support.*/</span></span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">boolean</span> ssl;</span><br><span class="line">   <span class="comment">/** Connection timeout.*/</span></span><br><span class="line">   <span class="keyword">private</span> Duration timeout;</span><br><span class="line">   <span class="comment">/** Client name to be set on connections with CLIENT SETNAME.*/</span></span><br><span class="line">   <span class="keyword">private</span> String clientName;</span><br><span class="line">   <span class="keyword">private</span> Sentinel sentinel;</span><br><span class="line">   <span class="keyword">private</span> Cluster cluster;</span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">final</span> Jedis jedis = <span class="keyword">new</span> Jedis();</span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">final</span> Lettuce lettuce = <span class="keyword">new</span> Lettuce();</span><br></pre></td></tr></table></figure>



<h3 id="使用-3"><a href="#使用-3" class="headerlink" title="使用"></a>使用</h3><p>1、导入依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>2、配置连接</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="attr">host:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span></span><br><span class="line">    <span class="attr">post:</span> <span class="number">6379</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>3.测试</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line">  RedisTemplate redisTemplate;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">contextLoads</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="comment">// opsForValue()</span></span><br><span class="line">      <span class="comment">// opsForList()</span></span><br><span class="line">      <span class="comment">// opsForSet()</span></span><br><span class="line">      <span class="comment">// opsForHash()</span></span><br><span class="line">      <span class="comment">// opsForZSet()</span></span><br><span class="line">      <span class="comment">// opsForGeo()</span></span><br><span class="line">      <span class="comment">// opsForHyperLogLog()</span></span><br><span class="line">      redisTemplate.opsForValue().set(<span class="string">&quot;mykey&quot;</span>,<span class="string">&quot;myValue&quot;</span>);</span><br><span class="line">      System.out.println(redisTemplate.opsForValue().get(<span class="string">&quot;mykey&quot;</span>));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>







<h2 id="十四、消息队列"><a href="#十四、消息队列" class="headerlink" title="十四、消息队列"></a>十四、消息队列</h2><h3 id="rabbitmq简介"><a href="#rabbitmq简介" class="headerlink" title="rabbitmq简介"></a>rabbitmq简介</h3><p>RabbitMQ是一个erlang开发的AMQP（Advanved Message Queue Protoco）的开源实现</p>
<h3 id="核心概念"><a href="#核心概念" class="headerlink" title="核心概念"></a>核心概念</h3><p><strong>Message</strong>：消息，消息不是具体名，它是由消息头和消息体组成，消息体是不透明的，而消息头则是由一系列的可选的属性组成，这些属性包括routing-key（路由键）、priority（相对于其他消息的优先权）、delivery-mode（指出该消息可能需要持久性存储）等。</p>
<p><strong>Publisher</strong>：消息生产着，也是一个向交换器发布消息的客户端应用程序。</p>
<p><strong>Exchange</strong>：交换器，用来接收生产者发送的消息并将这些消息路由给服务器中的队列。</p>
<p>Exchange（四种类型）：1、direct（默认），fanout，topic，headers，不同类型的Exchange的转发消息的策略有区别</p>
<p><strong>Queue</strong>：消息队列，用来保存消息直到发送给消费者。它是消息的容器，也是消息的终点。一个消息可投入一个或多个队列。消息一直在队列里面，等待消费者连接到这个队列将其取走</p>
<p><strong>Binding</strong>：绑定，用于消息队列和交换器之间的关联。一个绑定就是基于路由键将交换器和消息队列连接起来的路由规则，所以可以将交换器理解成一个由绑定构成的路由表。</p>
<p>Exchange和Queue之间绑定是多对多的关系。</p>
<p><strong>Conection</strong>：网络连接</p>
<p><strong>Channel</strong>：信道，多路复用链接中的一条独立的双向数据流通道。信道是建立在真实的TCP连接内的虚拟连接，AMQP命令都是通过信道发出去的，不管是发布消息，订阅队列还是接受信息都是通过信道完成。</p>
<p><strong>Consumer</strong>：消息的消费者，表示一个从消息队列中取得消息的客户端应用程序</p>
<p><strong>Virtual Host</strong>：虚拟主机，表示一批交换器、消息队列和相关对象。虚拟主机是共享相同的身份认证和加密环境的独立服务器域。</p>
<p><strong>Broker</strong>：表示消息队列服务器实体</p>
<p>RabbitMQ运行图解</p>
<p><img src="/2021/04/24/springboot/image-20201027210425867.png" alt="image-20201027210425867"></p>
<p><strong>Exchange（四种类型）</strong></p>
<p>1、direct（默认）：（单播模式）完全匹配，点对点</p>
<p><img src="/2021/04/24/springboot/image-20201027213019929.png" alt="image-20201027213019929"></p>
<p>2、fanout：（广播模式，发布订阅）fanout交换器不会处理路由键，只是简单的将队列绑定到交换器上，每个发送到交换器的消息都会被转发到与该交换器绑定的所有队列上。</p>
<p><img src="/2021/04/24/springboot/image-20201027212925794.png" alt="image-20201027212925794"></p>
<p>3、topic：通过模式匹配分配消息的路由键属性，将路由键和某个模式进行匹配，此时队列需要绑定在一个模式上。他将路由键和绑定键的字符串分为多个单词，这些单词之间用点隔开。他同样也会识别两个通配符：符号<strong>“#”</strong>：匹配0个或多个单词，<strong>“*”</strong>匹配一个单词。</p>
<p><img src="/2021/04/24/springboot/image-20201027212956737.png" alt="image-20201027212956737"></p>
<p>4、headers，headers匹配的是消息头而不是路由键，和direct一样完全匹配，点对点，性能不行，不怎么用</p>
<h3 id="rabbitMQ使用"><a href="#rabbitMQ使用" class="headerlink" title="rabbitMQ使用"></a>rabbitMQ使用</h3><p><strong>使用Docker安装RabbitMQ</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 拉取镜像</span></span><br><span class="line">docker pull rabbitmq:3-management</span><br><span class="line"><span class="meta">#</span><span class="bash"> 启动镜像</span> </span><br><span class="line">docker run -d -p 5672:5672 -p 15672:15672 --name myrabbitmq 镜像id</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>可以通过 <strong>15672</strong>端口访问Web界面</p>
<p>Web界面的登录密码  默认用户：guest 密码：guest</p>
<h4 id="添加Exchange"><a href="#添加Exchange" class="headerlink" title="添加Exchange"></a>添加Exchange</h4><p><img src="/2021/04/24/springboot/image-20201020152225743.png" alt="image-20201020152225743"></p>
<h4 id="添加queue"><a href="#添加queue" class="headerlink" title="添加queue"></a>添加queue</h4><p><img src="/2021/04/24/springboot/image-20201020152351294.png" alt="image-20201020152351294"></p>
<h4 id="Exchange-bind-queue"><a href="#Exchange-bind-queue" class="headerlink" title="Exchange bind queue"></a>Exchange bind queue</h4><p><img src="/2021/04/24/springboot/image-20201020152559918.png" alt="image-20201020152559918"></p>
<h4 id="发送消息"><a href="#发送消息" class="headerlink" title="发送消息"></a>发送消息</h4><p><img src="/2021/04/24/springboot/image-20201028093309916.png" alt="image-20201028093309916"></p>
<h4 id="接收消息"><a href="#接收消息" class="headerlink" title="接收消息"></a>接收消息</h4><p><img src="/2021/04/24/springboot/image-20201028093459275.png" alt="image-20201028093459275"></p>
<h3 id="整合RabbitMQ"><a href="#整合RabbitMQ" class="headerlink" title="整合RabbitMQ"></a>整合RabbitMQ</h3><h4 id="自动装配"><a href="#自动装配" class="headerlink" title="自动装配"></a>自动装配</h4><blockquote>
<p><strong>探究Springboot自动装配RabbitMQ</strong></p>
</blockquote>
<p>我们先搜索 RabbitAutoConfiguration 该类为RabbitMQ自动配置类</p>
<p><img src="/2021/04/24/springboot/image-20201028110803902.png" alt="image-20201028110803902"></p>
<p>里面有三个静态内部类</p>
<p>1、<code>RabbitConnectionFactoryCreator</code>类中的<code>rabbitConnectionFactory</code>方法将rabbit的连接对象注入容器，<code>rabbitConnectionFactory</code>方法的参数<code>RabbitProperties</code>中封装了配置RabbitMQ的所有配置，即我们在配置文件中写的配置信息.</p>
<p><code>RabbitProperties</code>类,为获取配置文件内容的类</p>
<p><img src="/2021/04/24/springboot/image-20201028111302552.png" alt="image-20201028111302552"></p>
<p>2、<code>RabbitTemplateConfiguration</code>类中配置了<code>RabbitTemplate</code>，<code>amqpAdmin</code></p>
<ul>
<li><p>RabbitTemplate: RabbitMQ发送消息和接受消息</p>
</li>
<li><p>AmqpAdmin：RabbitMQ系统管理功能组件</p>
</li>
</ul>
<h4 id="使用-4"><a href="#使用-4" class="headerlink" title="使用"></a>使用</h4><p>1、导入pom依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-amqp<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>2、配置文件中配置rabbitmq</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">spring.rabbitmq.host</span>=<span class="string">47.94.45.85</span></span><br><span class="line"><span class="meta">spring.rabbitmq.port</span>=<span class="string">5672</span></span><br><span class="line"><span class="comment">#端口号不写默认是   5672</span></span><br><span class="line"><span class="comment">#用户密码不写，默认是   guest</span></span><br><span class="line"><span class="comment">#虚拟主机不写默认是   &quot;/&quot;</span></span><br></pre></td></tr></table></figure>



<p>3、测试使用</p>
<p><strong>发送信息</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Message需要自己构造一个:定义消息体和消息头</span></span><br><span class="line"><span class="comment">//rabbitTemplate.send(exchange,routeKey,message);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//object默认当做message，只需要传入要发送的对象，自动序列化发送给RabbitMQ</span></span><br><span class="line"><span class="comment">//rabbitTemplate.convertAndSend(exchange,routeKey,object);</span></span><br></pre></td></tr></table></figure>



<blockquote>
<p>单播模式（direct）</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line">    RabbitTemplate rabbitTemplate;</span><br><span class="line"></span><br><span class="line"> <span class="comment">/*</span></span><br><span class="line"><span class="comment">    * 1、单播（点对点）</span></span><br><span class="line"><span class="comment">    * */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">contextLoads</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       </span><br><span class="line">        Map&lt;String,Object&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        map.put(<span class="string">&quot;msg&quot;</span>,<span class="string">&quot;这是第一个&quot;</span>);</span><br><span class="line">        map.put(<span class="string">&quot;data&quot;</span>, Arrays.asList(<span class="string">&quot;helloworld&quot;</span>,<span class="number">123</span>,<span class="keyword">true</span>));</span><br><span class="line">        <span class="comment">//对象被默认序列化以后发送出去</span></span><br><span class="line">        rabbitTemplate.convertAndSend</span><br><span class="line">            (<span class="string">&quot;exchange.direct&quot;</span>,<span class="string">&quot;atguigu.news&quot;</span>,map);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>



<blockquote>
<p>广播模式（fanout）</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 广播</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">   <span class="meta">@Test</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sendMsg</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       HashMap&lt;String, Object&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">       map.put(<span class="string">&quot;msg&quot;</span>,<span class="string">&quot;这是第二个&quot;</span>);</span><br><span class="line">       map.put(<span class="string">&quot;name&quot;</span>,<span class="string">&quot;西游记&quot;</span>);</span><br><span class="line">       rabbitTemplate.convertAndSend(<span class="string">&quot;exchange.fanout&quot;</span>,<span class="string">&quot;&quot;</span>,map);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>



<p>此时，无论单播、广播，所使用的<code>MessageConverter</code>都是默认的，在序列化时使用的Java的序列化，在消息队列中的是通过Java的序列化编码的格式</p>
<p><img src="/2021/04/24/springboot/image-20201028112836390.png" alt="image-20201028112836390"></p>
<p>而我们一般都会发送Json格式的数据，此时就需要我们自己配置<code>MessageConverter</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyAmqpConfig</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 配置Json格式的MessageConverter</span></span><br><span class="line"><span class="comment">     * 当我们自己配置过MessageConverter之后，</span></span><br><span class="line"><span class="comment">     * 会使用我们配置的MessageConverter</span></span><br><span class="line"><span class="comment">    * */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> MessageConverter <span class="title">messageConverter</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Jackson2JsonMessageConverter();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>当我们配置好Json格式的MessageConverter之后，再发送消息</p>
<p><img src="/2021/04/24/springboot/image-20201028113132490.png" alt="image-20201028113132490"></p>
<p><strong>接受消息</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * 接受数据，</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"> <span class="meta">@Test</span></span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">receive</span><span class="params">()</span></span>&#123;</span><br><span class="line">     <span class="comment">//接受指定的消息队列中的消息，并返回一个Message</span></span><br><span class="line">     <span class="comment">//Message receive = rabbitTemplate.receive(&quot;atguigu.news&quot;);</span></span><br><span class="line">     Object o = rabbitTemplate.receiveAndConvert(<span class="string">&quot;atguigu.news&quot;</span>);</span><br><span class="line">     System.out.println(o.getClass());</span><br><span class="line">     System.out.println(o);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<p>结果：</p>
<p><img src="/2021/04/24/springboot/image-20201028121801004.png" alt="image-20201028121801004"></p>
<p><strong>消息监听</strong></p>
<blockquote>
<p>用来监听消息队列中收到的消息</p>
</blockquote>
<p>只需要两个注解<code>@EnableRabbit </code>+ <code>@RabbitListener </code>监听消息队列的内容</p>
<p><code>@EnableRabbit</code>；开启基于注解的RabbitMQ模式</p>
<p><code>@RabbitListener </code>：监听指定的消息队列</p>
<p>案例：</p>
<p>开启注解</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//开启基于注解的RabbitMQ模式</span></span><br><span class="line"><span class="meta">@EnableRabbit</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringbootAmqpApplication</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(SpringbootAmqpApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>启动监听</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BookService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RabbitListener(queues = &quot;atguigu.news&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">receive01</span><span class="params">(Book book)</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;收到消息：&quot;</span>+book);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RabbitListener(queues = &quot;atguigu&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">receive02</span><span class="params">(Message message)</span></span>&#123;</span><br><span class="line">        System.out.println(message.getBody());</span><br><span class="line">        System.out.println(message.getMessageProperties());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>当使用这两个注解之后，每次向指定该消息队列中发送消息时，这两个方法就会自动从该消息队列中获取消息。</p>
<p><strong>结果展示：</strong></p>
<p><img src="/2021/04/24/springboot/image-20201028142620846.png" alt="image-20201028142620846"></p>
<p><strong>管理RabbitMQ的组件</strong></p>
<blockquote>
<p><code>AmqpAdmin</code>：RabbitMQ系统管理功能组件,可以创建、删除 queue Exchange Binding</p>
</blockquote>
<p>使用案例</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line">   AmqpAdmin amqpAdmin;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Test</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">createExchange</span><span class="params">()</span></span>&#123;</span><br><span class="line">     </span><br><span class="line">       <span class="comment">//以declare***开头的 一般都是</span></span><br><span class="line">       amqpAdmin.declareExchange(<span class="keyword">new</span> DirectExchange(<span class="string">&quot;amqpadmin.exchange&quot;</span>));</span><br><span class="line">       System.out.println(<span class="string">&quot;创建成功&quot;</span>);</span><br><span class="line">       </span><br><span class="line">       amqpAdmin.declareQueue(<span class="keyword">new</span> Queue(<span class="string">&quot;amqpadmin.queue&quot;</span>,<span class="keyword">true</span>));</span><br><span class="line">       System.out.println(<span class="string">&quot;创建成功&quot;</span>);</span><br><span class="line"></span><br><span class="line">       amqpAdmin.declareBinding(<span class="keyword">new</span> Binding(<span class="string">&quot;amqpadmin.queue&quot;</span>, </span><br><span class="line">                             Binding.DestinationType.QUEUE,</span><br><span class="line">                             <span class="string">&quot;amqpadmin.exchange&quot;</span>,<span class="string">&quot;amqp.haha&quot;</span>,<span class="keyword">null</span>));</span><br><span class="line"></span><br><span class="line">      <span class="comment">//以delete或remove开头的一般都是删除</span></span><br><span class="line">       amqpAdmin.removeBinding(<span class="keyword">new</span> Binding(<span class="string">&quot;amqpadmin.queue&quot;</span>,        </span><br><span class="line">                               Binding.DestinationType.QUEUE,                                              <span class="string">&quot;amqpadmin.exchange&quot;</span>,<span class="string">&quot;amqp.haha&quot;</span>,<span class="keyword">null</span>));</span><br><span class="line">      </span><br><span class="line">       amqpAdmin.deleteQueue(<span class="string">&quot;amqpadmin.queue&quot;</span>);</span><br><span class="line">       amqpAdmin.deleteExchange(<span class="string">&quot;amqpadmin.exchange&quot;</span>);</span><br><span class="line">       </span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>



<h2 id="十五、ElasticSearch"><a href="#十五、ElasticSearch" class="headerlink" title="十五、ElasticSearch"></a>十五、ElasticSearch</h2><h3 id="Elasticsearch概述"><a href="#Elasticsearch概述" class="headerlink" title="Elasticsearch概述"></a>Elasticsearch概述</h3><p>Elasticsearch是一个分布式、高度可扩展的开源<strong>全文本搜索</strong>和<strong>分析引擎</strong>。它使您可以<strong>快速，近乎实时</strong>地<strong>存储，搜索和分析</strong>大量数据。它通常用作支持具有复杂搜索功能和要求的应用程序的基础引擎/技术。</p>
<p>Elasticsearch 是一个开源的搜索引擎，建立在一个全文搜索引擎库 Apache Lucene基础之上,Lucene 仅仅只是一个库。</p>
<p><strong>Elasticsearch 不仅仅是 Lucene，并且也不仅仅只是一个全文搜索引擎,</strong></p>
<p>Elasticsearch 是</p>
<ul>
<li>一个分布式的实时文档存储，<em>每个字段</em> 可以被索引与搜索</li>
<li>一个分布式实时分析搜索引擎</li>
<li>能胜任上百个服务节点的扩展，并支持 PB 级别的结构化或者非结构化数据</li>
</ul>
<h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 拉取镜像</span><br><span class="line">docker pull docker.elastic.co&#x2F;elasticsearch&#x2F;elasticsearch:7.9.3</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 运行</span><br><span class="line">docker run -d -p 9200:9200 -p 9300:9300 -e ES_JAVA_OPTS&#x3D;&quot;-Xms512m -Xmx512m&quot; -e -Des.scripting.exception_for_missing_value&#x3D;true   --name elasticsearch 镜像ID</span><br></pre></td></tr></table></figure>

<p><strong>安装成功标志</strong></p>
<p><img src="/2021/04/24/springboot/image-20201102165956631.png" alt="image-20201102165956631"></p>
<h3 id="简介-1"><a href="#简介-1" class="headerlink" title="简介"></a>简介</h3><p>Elasticsearch 是 <em>面向文档</em> 的，意味着它存储整个对象或 <em>文档</em>。Elasticsearch 不仅存储文档，而且 <em>索引</em> 每个文档的内容，使之可以被检索。在 Elasticsearch 中，我们对文档进行索引、检索、排序和过滤—而不是对行列数据。</p>
<p>Elasticsearch 使用 JSON 作为文档的序列化格式。</p>
<p>例：这就代表一个User对象</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;email&quot;</span>:      <span class="string">&quot;john@smith.com&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;first_name&quot;</span>: <span class="string">&quot;John&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;last_name&quot;</span>:  <span class="string">&quot;Smith&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;info&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;bio&quot;</span>:         <span class="string">&quot;Eco-warrior and defender of the weak&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;age&quot;</span>:         <span class="number">25</span>,</span><br><span class="line">        <span class="attr">&quot;interests&quot;</span>: [ <span class="string">&quot;dolphins&quot;</span>, <span class="string">&quot;whales&quot;</span> ]</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">&quot;join_date&quot;</span>: <span class="string">&quot;2014/05/01&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>一个 <strong>Elasticsearch 集群</strong>可以 包含多个 <em><strong>索引</strong></em> ，相应的每个索引可以包含多个 <em><strong>类型</strong></em> 。 这些不同的类型存储着多个 <em><strong>文档</strong></em> ，每个文档又有 多个 <em><strong>属性</strong></em> 。</p>
<blockquote>
<p>索引（名词）：如前所述，一个 <em>索引</em> 类似于传统关系数据库中的一个 <em>数据库</em> ，是一个存储关系型文档的地方。 <em>索引</em> (<em>index</em>) 的复数词为 <em>indices</em> 或 <em>indexes</em> 。</p>
<p>索引（动词）：<strong>索引一个文档</strong> 就是存储一个文档到一个 <strong>索引</strong> （名词）中以便被检索和查询。这非常类似于 SQL 语句中的 <code>INSERT</code> 关键词，除了文档已存在时，新文档会替换旧文档情况之外。</p>
</blockquote>
<p><img src="/2021/04/24/springboot/image-20201102171507628.png" alt="image-20201102171507628"></p>
<h3 id="入门使用"><a href="#入门使用" class="headerlink" title="入门使用"></a>入门使用</h3><h4 id="新增（索引）员工"><a href="#新增（索引）员工" class="headerlink" title="新增（索引）员工"></a>新增（索引）员工</h4><p><strong>PUT请求</strong></p>
<p><img src="/2021/04/24/springboot/image-20201102172730761.png" alt="image-20201102172730761"></p>
<p>==注意：==</p>
<p><strong>新增是发PUT请求</strong></p>
<p>路径 <code>/megacorp/employee/1</code> 包含了三部分的信息：</p>
<ul>
<li><p><strong><code>megacorp</code></strong></p>
<p>索引名称</p>
</li>
<li><p><strong><code>employee</code></strong></p>
<p>类型名称</p>
</li>
<li><p><strong><code>1</code></strong></p>
<p>特定雇员的ID</p>
</li>
</ul>
<p><strong>请求体</strong> —— JSON 文档 —— 包含了这位员工的所有详细信息，</p>
<p>他的名字叫 John Smith ，今年 25 岁，喜欢攀岩。</p>
<p><strong>响应</strong></p>
<p><img src="/2021/04/24/springboot/image-20201102172758105.png" alt="image-20201102172758105"></p>
<h4 id="修改员工"><a href="#修改员工" class="headerlink" title="修改员工"></a>修改员工</h4><p>和新增时的操作是一样的，都是<strong>PUT请求</strong></p>
<p>此次对<strong>ID为1</strong>的员工进行修改</p>
<p><img src="/2021/04/24/springboot/image-20201102191049473.png" alt="image-20201102191049473"></p>
<p><strong>响应结果：</strong></p>
<p><img src="/2021/04/24/springboot/image-20201102191302809.png" alt="image-20201102191302809"></p>
<p>==注意==：和上面 第一次添加时进行对比，可以发现<code>_version</code>变为了  2</p>
<h4 id="检索（查找）员工"><a href="#检索（查找）员工" class="headerlink" title="检索（查找）员工"></a>检索（查找）员工</h4><p><strong>get请求</strong></p>
<p><img src="/2021/04/24/springboot/image-20201102173519534.png" alt="image-20201102173519534"></p>
<p><strong>响应</strong></p>
<p>查找成功</p>
<p><img src="/2021/04/24/springboot/image-20201102173716577.png" alt="image-20201102173716577"></p>
<p>查找失败</p>
<p><img src="/2021/04/24/springboot/image-20201102173809047.png" alt="image-20201102173809047"></p>
<h4 id="轻量搜索数据"><a href="#轻量搜索数据" class="headerlink" title="轻量搜索数据"></a>轻量搜索数据</h4><p>依然是<strong>get请求</strong>，但是此时并没有指定文档ID，而是使用<code>_search</code>.返回结果放在一个<strong>hits数组</strong>中，<strong>默认一个搜索返回十条数据</strong></p>
<h5 id="search-无参数"><a href="#search-无参数" class="headerlink" title="_search  无参数"></a>_search  无参数</h5><p>返回结果放在一个<strong>hits数组</strong>中，<strong>默认一个搜索返回十条数据</strong></p>
<p><img src="/2021/04/24/springboot/image-20201102174231092.png" alt="image-20201102174231092"></p>
<h5 id="search-带参数"><a href="#search-带参数" class="headerlink" title="_search 带参数"></a>_search 带参数</h5><p><img src="/2021/04/24/springboot/image-20201102183752293.png" alt="image-20201102183752293"></p>
<p>将查询本身赋值给参数<code>q=</code>，返回所有last_name为Smith的员工</p>
<h4 id="查询表达式搜索"><a href="#查询表达式搜索" class="headerlink" title="查询表达式搜索"></a>查询表达式搜索</h4><p><em>领域特定语言</em> （DSL）， 使用 JSON 构造了一个请求。</p>
<p><strong>案例1</strong></p>
<p><img src="/2021/04/24/springboot/image-20201102184737656.png" alt="image-20201102184737656"></p>
<p>响应和上面查询的结果一样</p>
<p><strong>案例2</strong></p>
<p>查询姓氏为Smith ，年龄大于30 的员工</p>
<p><img src="/2021/04/24/springboot/image-20201102185221048.png" alt="image-20201102185221048"></p>
<h4 id="全文搜索"><a href="#全文搜索" class="headerlink" title="全文搜索"></a>全文搜索</h4><p>查询所有喜欢攀岩（rock climbing）的员工</p>
<p><img src="/2021/04/24/springboot/image-20201102185958957.png" alt="image-20201102185958957"></p>
<p>响应结果：</p>
<p><img src="/2021/04/24/springboot/image-20201102190143443.png" alt="image-20201102190143443"></p>
<p>查询结果不但返回了John Smith 还返回了Jane Smith ，Jane Smith的about中只有rock albums 而没有 rock climbing 。</p>
<p><strong>原因</strong></p>
<p>Elasticsearch 默认按照相关性得分排序，即每个文档跟查询的匹配程度。</p>
<h4 id="短语搜索"><a href="#短语搜索" class="headerlink" title="短语搜索"></a>短语搜索</h4><p>找出一个属性中的独立单词是没有问题的，但有时候想要精确匹配一系列单词或者_短语_ 。 为此对 <code>match</code> 查询稍作调整，使用一个叫做 <code>match_phrase</code> 的查询</p>
<p><img src="/2021/04/24/springboot/image-20201102185724355.png" alt="image-20201102185724355"></p>
<h4 id="高亮查询"><a href="#高亮查询" class="headerlink" title="高亮查询"></a>高亮查询</h4><p>在查询时，增加一个新的 <code>highlight</code> 参数</p>
<p><img src="/2021/04/24/springboot/image-20201102190612502.png" alt="image-20201102190612502"></p>
<p><strong>响应</strong></p>
<p>当执行该查询时，返回结果与之前一样，与此同时结果中还多了一个叫做 <code>highlight</code> 的部分。这个部分包含了 <code>about</code> 属性匹配的文本片段，并以 HTML 标签 <code>&lt;em&gt;&lt;/em&gt;</code> 封装：</p>
<p><img src="/2021/04/24/springboot/image-20201102190649370.png" alt="image-20201102190649370"></p>
<h3 id="深入学习"><a href="#深入学习" class="headerlink" title="深入学习"></a>深入学习</h3><p>《Elasticsearch: 权威指南》</p>
<p><a target="_blank" rel="noopener" href="https://www.elastic.co/guide/cn/elasticsearch/guide/current/index.html">https://www.elastic.co/guide/cn/elasticsearch/guide/current/index.html</a></p>

            <div class="post-copyright">
    <div class="content">
        <p>最后更新： 2021年04月23日 17:13</p>
        <p>原始链接： <a class="post-url" href="/2021/04/24/springboot/" title="springboot零基础入门篇">http://javacoderx.github.io/2021/04/24/springboot/</a></p>
        <footer>
            <a href="http://javacoderx.github.io">
                <img src="/images/logo.png" alt="xyc">
                xyc
            </a>
        </footer>
    </div>
</div>

      
        
            
<div class="page-reward">
    <a id="rewardBtn" href="javascript:;">赏</a>
</div>

<div id="reward" class="post-modal reward-lay">
    <a class="close" href="javascript:;" id="reward-close">×</a>
    <span class="reward-title">
        <i class="icon icon-quote-left"></i>
        请我吃糖~
        <i class="icon icon-quote-right"></i>
    </span>
    <div class="reward-content">
        
        <div class="reward-code">
            <img id="rewardCode" src="/images/wechat_code.jpg" alt="打赏二维码">
        </div>
        <div class="reward-select">
            
            <label class="reward-select-item checked" data-id="wechat" data-wechat="/images/wechat_code.jpg">
                <img class="reward-select-item-wechat" src="/images/wechat.png" alt="微信">
            </label>
            
            
            <label class="reward-select-item" data-id="alipay" data-alipay="/images/alipay_code.jpg">
                <img class="reward-select-item-alipay" src="/images/alipay.png" alt="支付宝">
            </label>
            
        </div>
    </div>
</div>


        
    </div>
    <footer class="article-footer">
        
        
<div class="post-share">
    <a href="javascript:;" id="share-sub" class="post-share-fab">
        <i class="fa fa-share-alt"></i>
    </a>
    <div class="post-share-list" id="share-list">
        <ul class="share-icons">
          <li>
            <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://javacoderx.github.io/2021/04/24/springboot/&title=《springboot零基础入门篇》 — 太阳以西？&pic=http://javacoderx.github.ioimages/logo.png" data-title="微博">
              <i class="fa fa-weibo"></i>
            </a>
          </li>
          <li>
            <a class="weixin share-sns" id="wxFab" href="javascript:;" data-title="微信">
              <i class="fa fa-weixin"></i>
            </a>
          </li>
          <li>
            <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://javacoderx.github.io/2021/04/24/springboot/&title=《springboot零基础入门篇》 — 太阳以西？&source=专注 WEB 开发的技术博客" data-title="QQ">
              <i class="fa fa-qq"></i>
            </a>
          </li>
          <li>
            <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://javacoderx.github.io/2021/04/24/springboot/" data-title="Facebook">
              <i class="fa fa-facebook"></i>
            </a>
          </li>
          <li>
            <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《springboot零基础入门篇》 — 太阳以西？&url=http://javacoderx.github.io/2021/04/24/springboot/&via=http://javacoderx.github.io" data-title="Twitter">
              <i class="fa fa-twitter"></i>
            </a>
          </li>
          <li>
            <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://javacoderx.github.io/2021/04/24/springboot/" data-title="Google+">
              <i class="fa fa-google-plus"></i>
            </a>
          </li>
        </ul>
     </div>
</div>
<div class="post-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;" id="wxShare-close">×</a>
    <p>扫一扫，分享到微信</p>
    <img src="//api.qrserver.com/v1/create-qr-code/?data=http://javacoderx.github.io/2021/04/24/springboot/" alt="微信分享二维码">
</div>

<div class="mask"></div>

        
        <ul class="article-footer-menu">
            
            
  <li class="article-footer-tags">
    <i class="fa fa-tags"></i>
      
    <a href="/tags/springboot/" class="color1">springboot</a>
      
  </li>

        </ul>
        
    </footer>
  </div>
</article>


    <aside class="post-toc-pos post-toc-top" id="post-toc">
        <nav class="post-toc-wrap" style="overflow:scroll">
            <ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E4%B8%80%E3%80%81SpringBoot%E5%85%A5%E9%97%A8"><span class="post-toc-text">一、SpringBoot入门</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#1-1%E3%80%81springboot-%E7%AE%80%E4%BB%8B"><span class="post-toc-text">1.1、springboot 简介</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#1-2%E3%80%81%E5%BE%AE%E6%9C%8D%E5%8A%A1"><span class="post-toc-text">1.2、微服务</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#1-3%E3%80%81%E5%BF%AB%E9%80%9F%E5%BC%80%E5%A7%8B"><span class="post-toc-text">1.3、快速开始</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E4%BA%8C%E3%80%81%E8%87%AA%E5%8A%A8%E8%A3%85%E9%85%8D%E5%8E%9F%E7%90%86"><span class="post-toc-text">二、自动装配原理</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#2-1%E3%80%81POM%E6%96%87%E4%BB%B6%E5%88%86%E6%9E%90"><span class="post-toc-text">2.1、POM文件分析</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#2-2%E3%80%81%E5%90%AF%E5%8A%A8%E5%99%A8"><span class="post-toc-text">2.2、启动器</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#2-3%E3%80%81%E4%B8%BB%E7%A8%8B%E5%BA%8F%E7%B1%BB"><span class="post-toc-text">2.3、主程序类</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#2-4%E3%80%81Run"><span class="post-toc-text">2.4、Run</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#2-5%E3%80%81SpringApplication"><span class="post-toc-text">2.5、SpringApplication</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E4%B8%89%E3%80%81%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="post-toc-text">三、配置文件</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#3-1%E3%80%81%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="post-toc-text">3.1、配置文件</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#3-2%E3%80%81yaml"><span class="post-toc-text">3.2、yaml</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#3-3%E3%80%81%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E5%8D%A0%E4%BD%8D%E7%AC%A6"><span class="post-toc-text">3.3、配置文件占位符</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#3-4%E3%80%81%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E5%80%BC%E7%9A%84%E6%B3%A8%E5%85%A5"><span class="post-toc-text">3.4、配置文件值的注入</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#3-5%E3%80%81%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E7%9A%84%E5%8A%A0%E8%BD%BD%E4%BD%8D%E7%BD%AE"><span class="post-toc-text">3.5、配置文件的加载位置</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#3-6%E3%80%81%E5%8A%A0%E8%BD%BD%E6%8C%87%E5%AE%9A%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="post-toc-text">3.6、加载指定配置文件</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E5%9B%9B%E3%80%81%E6%97%A5%E5%BF%97"><span class="post-toc-text">四、日志</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#4-1%E3%80%81%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6"><span class="post-toc-text">4.1、日志框架</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#4-2%E3%80%81SLF4j%E4%BD%BF%E7%94%A8"><span class="post-toc-text">4.2、SLF4j使用</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#4-3%E3%80%81%E6%97%A5%E5%BF%97%E5%85%B3%E7%B3%BB"><span class="post-toc-text">4.3、日志关系</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#4-4%E3%80%81%E6%97%A5%E5%BF%97%E4%BD%BF%E7%94%A8"><span class="post-toc-text">4.4、日志使用</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#4-5%E3%80%81%E5%88%87%E6%8D%A2%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6"><span class="post-toc-text">4.5、切换日志框架</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E4%BA%94%E3%80%81Web%E5%BC%80%E5%8F%91"><span class="post-toc-text">五、Web开发</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#5-1%E3%80%81%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E6%98%A0%E5%B0%84"><span class="post-toc-text">5.1、静态资源映射</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#5-2%E3%80%81%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E"><span class="post-toc-text">5.2、模板引擎</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#%E5%BC%95%E5%85%A5thymeleaf"><span class="post-toc-text">引入thymeleaf</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#thymeleaf%E4%BD%BF%E7%94%A8"><span class="post-toc-text">thymeleaf使用</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#%E8%AF%AD%E6%B3%95%E8%A7%84%E5%88%99"><span class="post-toc-text">语法规则</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#5-3%E3%80%81SpringMVC-%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE"><span class="post-toc-text">5.3、SpringMVC 自动配置</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#auto-configuration"><span class="post-toc-text">auto-configuration</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#%E6%89%A9%E5%B1%95SpringMVC"><span class="post-toc-text">扩展SpringMVC</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#5-4%E3%80%81%E4%BF%AE%E6%94%B9springboot%E9%BB%98%E8%AE%A4%E9%85%8D%E7%BD%AE"><span class="post-toc-text">5.4、修改springboot默认配置</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#5-5%E3%80%81CRUD%E6%93%8D%E4%BD%9C"><span class="post-toc-text">5.5、CRUD操作</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#5-6%E3%80%81%E5%9B%BD%E9%99%85%E5%8C%96"><span class="post-toc-text">5.6、国际化</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#5-7%E3%80%81%E6%8B%A6%E6%88%AA%E5%99%A8"><span class="post-toc-text">5.7、拦截器</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#5-8%E3%80%81%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86%E6%9C%BA%E5%88%B6"><span class="post-toc-text">5.8、错误处理机制</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#5-8-1%E3%80%81%E9%BB%98%E8%AE%A4%E7%9A%84%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86%E6%9C%BA%E5%88%B6"><span class="post-toc-text">5.8.1、默认的错误处理机制</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#%E9%BB%98%E8%AE%A4%E6%95%88%E6%9E%9C%EF%BC%9A"><span class="post-toc-text">默认效果：</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#%E5%8E%9F%E7%90%86"><span class="post-toc-text">原理</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#%E6%AD%A5%E9%AA%A4"><span class="post-toc-text">步骤</span></a></li></ol></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#5-8-2%E3%80%81%E5%AE%9A%E5%88%B6%E9%94%99%E8%AF%AF%E5%93%8D%E5%BA%94%EF%BC%9A"><span class="post-toc-text">5.8.2、定制错误响应：</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#%E5%AE%9A%E5%88%B6%E9%94%99%E8%AF%AF%E7%9A%84%E9%A1%B5%E9%9D%A2%EF%BC%9B"><span class="post-toc-text">定制错误的页面；</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#%E5%AE%9A%E5%88%B6%E9%94%99%E8%AF%AF%E7%9A%84json%E6%95%B0%E6%8D%AE%EF%BC%9B"><span class="post-toc-text">定制错误的json数据；</span></a></li></ol></li></ol></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E5%85%AD%E3%80%81%E6%95%B4%E5%90%88JDBC"><span class="post-toc-text">六、整合JDBC</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E9%85%8D%E7%BD%AE"><span class="post-toc-text">配置</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E4%BD%BF%E7%94%A8"><span class="post-toc-text">使用</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E4%B8%83%E3%80%81%E6%95%B4%E5%90%88Druid%E6%95%B0%E6%8D%AE%E6%BA%90"><span class="post-toc-text">七、整合Druid数据源</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E5%AF%BC%E5%85%A5%E4%BE%9D%E8%B5%96"><span class="post-toc-text">导入依赖</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E9%85%8D%E7%BD%AE%E6%95%B0%E6%8D%AE%E6%BA%90"><span class="post-toc-text">配置数据源</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E9%85%8D%E7%BD%AEDruid%E6%95%B0%E6%8D%AE%E7%9B%91%E6%8E%A7"><span class="post-toc-text">配置Druid数据监控</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E5%85%AB%E3%80%81%E6%95%B4%E5%90%88Mybatis"><span class="post-toc-text">八、整合Mybatis</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#1-%E5%AF%BC%E5%85%A5%E6%95%B4%E5%90%88mybatis%E6%89%80%E9%9C%80%E4%BE%9D%E8%B5%96"><span class="post-toc-text">1.导入整合mybatis所需依赖</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#2-%E9%85%8D%E7%BD%AE%E6%95%B0%E6%8D%AE%E6%BA%90"><span class="post-toc-text">2.配置数据源</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#3-%E6%95%B4%E5%90%88Mybatis"><span class="post-toc-text">3.整合Mybatis</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#4-%E5%88%9B%E5%BB%BA%E5%AE%9E%E4%BD%93%E7%B1%BB%EF%BC%9A"><span class="post-toc-text">4.创建实体类：</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#5-%E9%85%8D%E7%BD%AEMapper%E6%8E%A5%E5%8F%A3%E7%B1%BB"><span class="post-toc-text">5.配置Mapper接口类</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#6-Mapper%E6%98%A0%E5%B0%84%E6%96%87%E4%BB%B6"><span class="post-toc-text">6.Mapper映射文件</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E4%B9%9D%E3%80%81springSecurity"><span class="post-toc-text">九、springSecurity</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#1%E3%80%81SpringSecurity%E7%AE%80%E4%BB%8B"><span class="post-toc-text">1、SpringSecurity简介</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#1-1%E3%80%81%E5%AE%89%E5%85%A8%E6%A1%86%E6%9E%B6%E6%A6%82%E8%BF%B0"><span class="post-toc-text">1.1、安全框架概述</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#1-2%E3%80%81%E5%B8%B8%E7%94%A8%E5%AE%89%E5%85%A8%E6%A1%86%E6%9E%B6"><span class="post-toc-text">1.2、常用安全框架</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#1-3%E3%80%81%E7%AE%80%E4%BB%8B"><span class="post-toc-text">1.3、简介</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#2%E3%80%81%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8"><span class="post-toc-text">2、简单使用</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#3%E3%80%81UserDetailsService"><span class="post-toc-text">3、UserDetailsService</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#3-1%E3%80%81%E8%BF%94%E5%9B%9E%E5%80%BC"><span class="post-toc-text">3.1、返回值</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#3-2%E3%80%81%E6%96%B9%E6%B3%95%E5%8F%82%E6%95%B0"><span class="post-toc-text">3.2、方法参数</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#3-3%E3%80%81%E5%BC%82%E5%B8%B8"><span class="post-toc-text">3.3、异常</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#3-4%E3%80%81%E5%AE%9E%E7%8E%B0%E6%A1%88%E4%BE%8B"><span class="post-toc-text">3.4、实现案例</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#4%E3%80%81PasswordEncoder"><span class="post-toc-text">4、PasswordEncoder</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#5%E3%80%81%E8%87%AA%E5%AE%9A%E4%B9%89%E7%99%BB%E5%BD%95%E9%80%BB%E8%BE%91"><span class="post-toc-text">5、自定义登录逻辑</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#5-1%E3%80%81%E9%85%8D%E7%BD%AE%E7%B1%BB"><span class="post-toc-text">5.1、配置类</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#5-2%E3%80%81%E8%87%AA%E5%AE%9A%E4%B9%89%E9%80%BB%E8%BE%91"><span class="post-toc-text">5.2、自定义逻辑</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#6%E3%80%81%E8%87%AA%E5%AE%9A%E4%B9%89%E7%99%BB%E5%BD%95%E7%95%8C%E9%9D%A2"><span class="post-toc-text">6、自定义登录界面</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#6-1%E3%80%81%E4%BF%AE%E6%94%B9%E9%85%8D%E7%BD%AE%E7%B1%BB"><span class="post-toc-text">6.1、修改配置类</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#7%E3%80%81%E8%AE%A4%E8%AF%81%E8%BF%87%E7%A8%8B%E4%B8%AD%E5%85%B6%E4%BB%96%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE"><span class="post-toc-text">7、认证过程中其他常用配置</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#7-1%E3%80%81%E5%A4%B1%E8%B4%A5%E8%B7%B3%E8%BD%AC"><span class="post-toc-text">7.1、失败跳转</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#7-2%E3%80%81%E8%AE%BE%E7%BD%AE%E8%AF%B7%E6%B1%82%E8%B4%A6%E6%88%B7%E5%92%8C%E5%AF%86%E7%A0%81%E7%9A%84%E5%8F%82%E6%95%B0%E5%90%8D"><span class="post-toc-text">7.2、设置请求账户和密码的参数名</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#7-3%E3%80%81%E8%87%AA%E5%AE%9A%E4%B9%89%E7%99%BB%E5%BD%95%E6%88%90%E5%8A%9F%E5%A4%84%E7%90%86%E5%99%A8"><span class="post-toc-text">7.3、自定义登录成功处理器</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#7-4%E3%80%81%E8%87%AA%E5%AE%9A%E4%B9%89%E7%99%BB%E5%BD%95%E5%A4%B1%E8%B4%A5%E5%A4%84%E7%90%86%E5%99%A8"><span class="post-toc-text">7.4、自定义登录失败处理器</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#8%E3%80%81%E8%AE%BF%E9%97%AE%E6%8E%A7%E5%88%B6url%E5%8C%B9%E9%85%8D"><span class="post-toc-text">8、访问控制url匹配</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#8-1%E3%80%81anyRequest"><span class="post-toc-text">8.1、anyRequest()</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#8-2%E3%80%81antMatcher"><span class="post-toc-text">8.2、antMatcher()</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#8-3%E3%80%81regexMatchers"><span class="post-toc-text">8.3、regexMatchers()</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#8-4%E3%80%81mvcMatchers"><span class="post-toc-text">8.4、mvcMatchers()</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#9%E3%80%81%E5%86%85%E7%BD%AE%E8%AE%BF%E9%97%AE%E6%8E%A7%E5%88%B6%E6%96%B9%E6%B3%95"><span class="post-toc-text">9、内置访问控制方法</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#9-1%E3%80%81permitAll"><span class="post-toc-text">9.1、permitAll()</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#9-2%E3%80%81authenticated"><span class="post-toc-text">9.2、authenticated()</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#9-3%E3%80%81anonymous"><span class="post-toc-text">9.3、anonymous()</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#9-4%E3%80%81denyAll"><span class="post-toc-text">9.4、denyAll()</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#9-5%E3%80%81rememberMe"><span class="post-toc-text">9.5、rememberMe()</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#9-6%E3%80%81fullyAuthenticated"><span class="post-toc-text">9.6、fullyAuthenticated()</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#10%E3%80%81%E8%A7%92%E8%89%B2%E6%9D%83%E9%99%90%E5%88%A4%E6%96%AD"><span class="post-toc-text">10、角色权限判断</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#10-1%E3%80%81hasAuthority-String"><span class="post-toc-text">10.1、hasAuthority(String)</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#10-2%E3%80%81hasAnyAuthority-String-%E2%80%A6"><span class="post-toc-text">10.2、hasAnyAuthority(String …)</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#10-3%E3%80%81hasRole-String"><span class="post-toc-text">10.3、hasRole(String)</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#10-4%E3%80%81hasAnyRole-String-%E2%80%A6"><span class="post-toc-text">10.4、hasAnyRole(String …)</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#10-5%E3%80%81hasIpAddress-String"><span class="post-toc-text">10.5、hasIpAddress(String)</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#11%E3%80%81%E8%87%AA%E5%AE%9A%E4%B9%89403%E5%A4%84%E7%90%86%E6%96%B9%E6%A1%88"><span class="post-toc-text">11、自定义403处理方案</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#12%E3%80%81%E5%9F%BA%E4%BA%8E%E8%A1%A8%E8%BE%BE%E5%BC%8F%E7%9A%84%E8%AE%BF%E9%97%AE%E6%8E%A7%E5%88%B6"><span class="post-toc-text">12、基于表达式的访问控制</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#12-1%E3%80%81access"><span class="post-toc-text">12.1、access()</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#12-2%E3%80%81%E4%BD%BF%E7%94%A8%E8%87%AA%E5%AE%9A%E4%B9%89%E6%96%B9%E6%B3%95"><span class="post-toc-text">12.2、使用自定义方法</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#13%E3%80%81%E5%9F%BA%E4%BA%8E%E6%B3%A8%E8%A7%A3%E7%9A%84%E8%AE%BF%E9%97%AE%E6%8E%A7%E5%88%B6"><span class="post-toc-text">13、基于注解的访问控制</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#13-1%E3%80%81-Secured"><span class="post-toc-text">13.1、@Secured</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#13-2%E3%80%81-PreAuthorize-PostAuthorize"><span class="post-toc-text">13.2、@PreAuthorize&#x2F;@PostAuthorize</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#14%E3%80%81RememberMe%E5%8A%9F%E8%83%BD%E5%AE%9E%E7%8E%B0"><span class="post-toc-text">14、RememberMe功能实现</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#15%E3%80%81Thymeleaf%E4%B8%ADSpringSecurity%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="post-toc-text">15、Thymeleaf中SpringSecurity的使用</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#16%E3%80%81%E9%80%80%E5%87%BA%E7%99%BB%E5%BD%95"><span class="post-toc-text">16、退出登录</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#17%E3%80%81SpringSecurity%E4%B8%AD%E7%9A%84CSRF"><span class="post-toc-text">17、SpringSecurity中的CSRF</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#17-1%E3%80%81%E4%BB%80%E4%B9%88%E6%98%AFCSRF%EF%BC%9F"><span class="post-toc-text">17.1、什么是CSRF？</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#17-2%E3%80%81Spring-Security%E4%B8%AD%E7%9A%84CSRF"><span class="post-toc-text">17.2、Spring Security中的CSRF</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#18%E3%80%81Oauth2%E8%AE%A4%E8%AF%81"><span class="post-toc-text">18、Oauth2认证</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#19%E3%80%81Spring-Security-Oauth2"><span class="post-toc-text">19、Spring Security Oauth2</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#%E4%BD%BF%E7%94%A8-%E6%8E%88%E6%9D%83%E6%A8%A1%E5%BC%8F"><span class="post-toc-text">使用 授权模式</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#Spring-Security-Oauth2-%E5%AF%86%E7%A0%81%E6%A8%A1%E5%BC%8F"><span class="post-toc-text">Spring Security Oauth2 密码模式</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#redis%E4%B8%AD%E5%AD%98%E5%82%A8token"><span class="post-toc-text">redis中存储token</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#20%E3%80%81JWT"><span class="post-toc-text">20、JWT</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#%E5%B8%B8%E8%A7%81%E7%9A%84%E8%AE%A4%E8%AF%81%E6%9C%BA%E5%88%B6"><span class="post-toc-text">常见的认证机制</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#JWT%E7%AE%80%E4%BB%8B"><span class="post-toc-text">JWT简介</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#%E7%BB%84%E6%88%90"><span class="post-toc-text">组成</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#%E4%BD%BF%E7%94%A8-1"><span class="post-toc-text">使用</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#21%E3%80%81Spring-Security-Oauth2-%E6%95%B4%E5%90%88JWT"><span class="post-toc-text">21、Spring Security Oauth2 整合JWT</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#22%E3%80%81Spring-Security-Oauth2-%E6%95%B4%E5%90%88%E5%8D%95%E7%82%B9%E7%99%BB%E5%BD%95%EF%BC%88SSO%EF%BC%89"><span class="post-toc-text">22、Spring Security Oauth2 整合单点登录（SSO）</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E5%8D%81%E3%80%81%E6%95%B4%E5%90%88Shiro%E5%AE%89%E5%85%A8%E6%A1%86%E6%9E%B6"><span class="post-toc-text">十、整合Shiro安全框架</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E6%95%B4%E5%90%88-Shiro-%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA"><span class="post-toc-text">整合 Shiro 环境搭建</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E5%AE%9E%E7%8E%B0%E7%99%BB%E5%BD%95%E6%8B%A6%E6%88%AA"><span class="post-toc-text">实现登录拦截</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E5%AE%9E%E7%8E%B0%E7%94%A8%E6%88%B7%E8%AE%A4%E8%AF%81"><span class="post-toc-text">实现用户认证</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E6%95%B4%E5%90%88mybatis%E7%9A%84%E8%AE%A4%E8%AF%81"><span class="post-toc-text">整合mybatis的认证</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E5%AE%9E%E7%8E%B0%E6%9D%83%E9%99%90%E8%AE%BE%E7%BD%AE"><span class="post-toc-text">实现权限设置</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E5%AE%9E%E7%8E%B0%E7%94%A8%E6%88%B7%E6%8E%88%E6%9D%83"><span class="post-toc-text">实现用户授权</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#shiro%E6%95%B4%E5%90%88thymeleaf"><span class="post-toc-text">shiro整合thymeleaf</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E5%8D%81%E4%B8%80%E3%80%81%E6%95%B4%E5%90%88Swagger"><span class="post-toc-text">十一、整合Swagger</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E7%AE%80%E4%BB%8B"><span class="post-toc-text">简介</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#springboot%E9%9B%86%E6%88%90Swagger"><span class="post-toc-text">springboot集成Swagger</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E9%85%8D%E7%BD%AESwagger"><span class="post-toc-text">配置Swagger</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E5%8D%81%E4%BA%8C%E3%80%81%E4%BB%BB%E5%8A%A1"><span class="post-toc-text">十二、任务</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#1%E3%80%81%E5%BC%82%E6%AD%A5%E4%BB%BB%E5%8A%A1"><span class="post-toc-text">1、异步任务</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#2%E3%80%81%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1"><span class="post-toc-text">2、定时任务</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#3%E3%80%81%E9%82%AE%E4%BB%B6%E4%BB%BB%E5%8A%A1"><span class="post-toc-text">3、邮件任务</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#%E4%BD%BF%E7%94%A8-2"><span class="post-toc-text">使用</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E5%8D%81%E4%B8%89%E3%80%81%E6%95%B4%E5%90%88Redis"><span class="post-toc-text">十三、整合Redis</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E4%BD%BF%E7%94%A8-3"><span class="post-toc-text">使用</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E5%8D%81%E5%9B%9B%E3%80%81%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97"><span class="post-toc-text">十四、消息队列</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#rabbitmq%E7%AE%80%E4%BB%8B"><span class="post-toc-text">rabbitmq简介</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5"><span class="post-toc-text">核心概念</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#rabbitMQ%E4%BD%BF%E7%94%A8"><span class="post-toc-text">rabbitMQ使用</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#%E6%B7%BB%E5%8A%A0Exchange"><span class="post-toc-text">添加Exchange</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#%E6%B7%BB%E5%8A%A0queue"><span class="post-toc-text">添加queue</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#Exchange-bind-queue"><span class="post-toc-text">Exchange bind queue</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#%E5%8F%91%E9%80%81%E6%B6%88%E6%81%AF"><span class="post-toc-text">发送消息</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#%E6%8E%A5%E6%94%B6%E6%B6%88%E6%81%AF"><span class="post-toc-text">接收消息</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E6%95%B4%E5%90%88RabbitMQ"><span class="post-toc-text">整合RabbitMQ</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#%E8%87%AA%E5%8A%A8%E8%A3%85%E9%85%8D"><span class="post-toc-text">自动装配</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#%E4%BD%BF%E7%94%A8-4"><span class="post-toc-text">使用</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E5%8D%81%E4%BA%94%E3%80%81ElasticSearch"><span class="post-toc-text">十五、ElasticSearch</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Elasticsearch%E6%A6%82%E8%BF%B0"><span class="post-toc-text">Elasticsearch概述</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E5%AE%89%E8%A3%85"><span class="post-toc-text">安装</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E7%AE%80%E4%BB%8B-1"><span class="post-toc-text">简介</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E5%85%A5%E9%97%A8%E4%BD%BF%E7%94%A8"><span class="post-toc-text">入门使用</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#%E6%96%B0%E5%A2%9E%EF%BC%88%E7%B4%A2%E5%BC%95%EF%BC%89%E5%91%98%E5%B7%A5"><span class="post-toc-text">新增（索引）员工</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#%E4%BF%AE%E6%94%B9%E5%91%98%E5%B7%A5"><span class="post-toc-text">修改员工</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#%E6%A3%80%E7%B4%A2%EF%BC%88%E6%9F%A5%E6%89%BE%EF%BC%89%E5%91%98%E5%B7%A5"><span class="post-toc-text">检索（查找）员工</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#%E8%BD%BB%E9%87%8F%E6%90%9C%E7%B4%A2%E6%95%B0%E6%8D%AE"><span class="post-toc-text">轻量搜索数据</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#search-%E6%97%A0%E5%8F%82%E6%95%B0"><span class="post-toc-text">_search  无参数</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#search-%E5%B8%A6%E5%8F%82%E6%95%B0"><span class="post-toc-text">_search 带参数</span></a></li></ol></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#%E6%9F%A5%E8%AF%A2%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%90%9C%E7%B4%A2"><span class="post-toc-text">查询表达式搜索</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#%E5%85%A8%E6%96%87%E6%90%9C%E7%B4%A2"><span class="post-toc-text">全文搜索</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#%E7%9F%AD%E8%AF%AD%E6%90%9C%E7%B4%A2"><span class="post-toc-text">短语搜索</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#%E9%AB%98%E4%BA%AE%E6%9F%A5%E8%AF%A2"><span class="post-toc-text">高亮查询</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E6%B7%B1%E5%85%A5%E5%AD%A6%E4%B9%A0"><span class="post-toc-text">深入学习</span></a></li></ol></li></ol>
        </nav>
    </aside>
    

<nav id="article-nav">
  
  
    <a href="/2021/04/23/docker/" id="article-nav-older" class="article-nav-link-wrap">
      <span class="article-nav-title">docker</span>
      <i class="fa fa-hand-o-right" aria-hidden="true"></i>
    </a>
  
</nav>



    
</section>
        
      </div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info" class="inner">
      
<p>
    <span id="busuanzi_container_site_uv" style='display:none'>
        总访客数：<span id="busuanzi_value_site_uv"></span>
    </span>
    <span id="busuanzi_container_site_pv" style='display:none'>
        总访问量：<span id="busuanzi_value_site_pv"></span>
    </span>
</p>


      <p>
        Powered by  <a href="http://hexo.io/" target="_blank">Hexo</a>
        Theme <a href="//github.com/wongminho/hexo-theme-miho" target="_blank">MiHo</a>
      &copy; 2021 xyc<br>
      </p>
    </div>
  </div>
</footer>
    <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<script src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
<script>
  var mihoConfig = {
      root: "http://javacoderx.github.io",
      animate: true,
      isHome: false,
      share: true,
      reward: 1
  }
</script>
<div class="sidebar">
    <div id="sidebar-search" title="Search">
        <i class="fa fa-search"></i>
    </div>
    <div id="sidebar-category" title="Categories">
        <i class="fa fa-book"></i>
    </div>
    <div id="sidebar-tag" title="Tags">
        <i class="fa fa-tags"></i>
    </div>
    <div id="sidebar-top">
        <span class="sidebar-top-icon"><i class="fa fa-angle-up"></i></span>
    </div>
</div>
<div class="sidebar-menu-box" id="sidebar-menu-box">
    <div class="sidebar-menu-box-container">
        <div id="sidebar-menu-box-categories">
            <a class="category-link" href="/categories/docker/">docker</a><a class="category-link" href="/categories/springboot/">springboot</a>
        </div>
        <div id="sidebar-menu-box-tags">
            <a href="/tags/docker/" style="font-size: 10px;">docker</a> <a href="/tags/spring/" style="font-size: 10px;">spring</a> <a href="/tags/springboot/" style="font-size: 10px;">springboot</a>
        </div>
    </div>
    <a href="javascript:;" class="sidebar-menu-box-close">&times;</a>
</div>
<div class="mobile-header-menu-nav" id="mobile-header-menu-nav">
    <div class="mobile-header-menu-container">
        <span class="title">Menus</span>
        <ul class="mobile-header-menu-navbar">
            
            <li>
                <a  href="/">
                    <i class="fa fa-home"></i><span>Home</span>
                </a>
            </li>
            
            <li>
                <a  href="/archives">
                    <i class="fa fa-archive"></i><span>Archives</span>
                </a>
            </li>
            
            <li>
                <a  href="/about">
                    <i class="fa fa-user"></i><span>About</span>
                </a>
            </li>
            
        </ul>
    </div>
    <div class="mobile-header-tag-container">
        <span class="title">Tags</span>
        <div id="mobile-header-container-tags">
            <a href="/tags/docker/" style="font-size: 10px;">docker</a> <a href="/tags/spring/" style="font-size: 10px;">spring</a> <a href="/tags/springboot/" style="font-size: 10px;">springboot</a>
        </div>
    </div>
</div>
<div class="search-wrap">
    <span class="search-close">&times;</span>
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
            <i class="icon icon-lg icon-chevron-left"></i>
        </a>
        <input class="search-field" placeholder="Search..." id="keywords">
        <a id="search-submit" href="javascript:;">
            <i class="fa fa-search"></i>
        </a>
    <div class="search-container" id="search-container">
        <ul class="search-result" id="search-result">
        </ul>
    </div>
</div>

<div id="search-tpl">
    <li class="search-result-item">
        <a href="{url}" class="search-item-li">
            <span class="search-item-li-title" title="{title}">{title}</span>
        </a>
    </li>
</div>

<script src="/js/search.js"></script>


<script src="/js/main.js"></script>



  <script src="//cdn.bootcss.com/particles.js/2.0.0/particles.min.js"></script>
  <div id="particles"></div>
  
<script src="/js/particles.js"></script>








  
<link rel="stylesheet" href="//cdn.bootcss.com/animate.css/3.5.0/animate.min.css">

  <script src="//cdn.bootcss.com/scrollReveal.js/3.0.5/scrollreveal.js"></script>
  
<script src="/js/animate.js"></script>



  
<script src="/js/pop-img.js"></script>

  <script>
     $(".article-entry p img").popImg();
  </script>

  </div>
</body>
</html>